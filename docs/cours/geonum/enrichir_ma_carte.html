<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Enrichir ma carte en fonctionnalit√©s</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<link href="../../static/logo.png" rel="icon" type="image/png">
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Accueil</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-cours" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Cours</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-cours">    
        <li>
    <a class="dropdown-item" href="../../cours/geonum/introduction.html">
 <span class="dropdown-text">GeoNum</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../cours/geonum/enrichir_ma_carte.html">Enrichir ma carte en fonctionnalit√©s</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../cours/geonum/introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../cours/geonum/serveurs_carto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Serveurs cartographiques</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../cours/geonum/openlayers_geoserver.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">OpenLayers &amp; GeoServer</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../cours/geonum/enrichir_ma_carte.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Enrichir ma carte en fonctionnalit√©s</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../cours/geonum/evaluation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">√âvaluation</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#objectifs" id="toc-objectifs" class="nav-link active" data-scroll-target="#objectifs">Objectifs</a></li>
  <li><a href="#cours" id="toc-cours" class="nav-link" data-scroll-target="#cours">Cours</a></li>
  <li><a href="#tp---faire-une-carte-interactive-sur-le-th√®me-de-lexploitation-mini√®re-et-ses-impacts-n√©gatifs-sur-les-populations-locales" id="toc-tp---faire-une-carte-interactive-sur-le-th√®me-de-lexploitation-mini√®re-et-ses-impacts-n√©gatifs-sur-les-populations-locales" class="nav-link" data-scroll-target="#tp---faire-une-carte-interactive-sur-le-th√®me-de-lexploitation-mini√®re-et-ses-impacts-n√©gatifs-sur-les-populations-locales">TP - Faire une carte interactive sur le th√®me de l‚Äôexploitation mini√®re et ses impacts n√©gatifs sur les populations locales</a>
  <ul class="collapse">
  <li><a href="#cr√©er-un-menu-daffichage-des-couches" id="toc-cr√©er-un-menu-daffichage-des-couches" class="nav-link" data-scroll-target="#cr√©er-un-menu-daffichage-des-couches">Cr√©er un menu d‚Äôaffichage des couches</a></li>
  <li><a href="#interroger-une-couche-wms-et-afficher-les-r√©sultats" id="toc-interroger-une-couche-wms-et-afficher-les-r√©sultats" class="nav-link" data-scroll-target="#interroger-une-couche-wms-et-afficher-les-r√©sultats">Interroger une couche WMS et afficher les r√©sultats</a></li>
  <li><a href="#filtrer-des-couches-wms" id="toc-filtrer-des-couches-wms" class="nav-link" data-scroll-target="#filtrer-des-couches-wms">Filtrer des couches WMS</a></li>
  <li><a href="#des-cercles-proportionnels-avec-un-flux-wfs" id="toc-des-cercles-proportionnels-avec-un-flux-wfs" class="nav-link" data-scroll-target="#des-cercles-proportionnels-avec-un-flux-wfs">Des cercles proportionnels avec un flux WFS</a></li>
  </ul></li>
  <li><a href="#l√©tape-finale" id="toc-l√©tape-finale" class="nav-link" data-scroll-target="#l√©tape-finale">L‚Äô√©tape finale&nbsp;!</a></li>
  <li><a href="#jai-fini-en-avance-quest-ce-que-je-fais" id="toc-jai-fini-en-avance-quest-ce-que-je-fais" class="nav-link" data-scroll-target="#jai-fini-en-avance-quest-ce-que-je-fais">J‚Äôai fini en avance, qu‚Äôest-ce que je fais&nbsp;?</a></li>
  <li><a href="#rajout√©-√†-la-fin-mais-√†-faire-quand-m√™me-une-table-attributaire-personnalis√©e" id="toc-rajout√©-√†-la-fin-mais-√†-faire-quand-m√™me-une-table-attributaire-personnalis√©e" class="nav-link" data-scroll-target="#rajout√©-√†-la-fin-mais-√†-faire-quand-m√™me-une-table-attributaire-personnalis√©e">Rajout√© √† la fin MAIS √Ä FAIRE QUAND M√äME&nbsp;: une table attributaire personnalis√©e</a></li>
  <li><a href="#jai-fini-√ßa-aussi" id="toc-jai-fini-√ßa-aussi" class="nav-link" data-scroll-target="#jai-fini-√ßa-aussi">J‚Äôai fini √ßa aussi&nbsp;!</a></li>
  <li><a href="#bon-ben-jai-aussi-une-√©chelle-sur-ma-carte" id="toc-bon-ben-jai-aussi-une-√©chelle-sur-ma-carte" class="nav-link" data-scroll-target="#bon-ben-jai-aussi-une-√©chelle-sur-ma-carte">Bon, ben j‚Äôai AUSSI une √©chelle sur ma carte‚Ä¶</a></li>
  <li><a href="#cette-fois-cest-vraiment-fini" id="toc-cette-fois-cest-vraiment-fini" class="nav-link" data-scroll-target="#cette-fois-cest-vraiment-fini">Cette fois, c‚Äôest vraiment fini&nbsp;!</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Enrichir ma carte en fonctionnalit√©s</h1>
<p class="subtitle lead">Enrichir ma carte OpenLayers en fonctionnalit√©s en utilisant les capabilities de GeoServer et plus de fonctions et objets OpenLayers.</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="objectifs" class="level2">
<h2 class="anchored" data-anchor-id="objectifs">Objectifs</h2>
<ul>
<li>Cr√©er un menu d‚Äôaffichage des couches</li>
<li>Interroger une couche WMS et afficher les r√©sultats</li>
<li>Filtrer une couche WMS</li>
<li>Lire un flux WFS et afficher la g√©om√©trie</li>
<li>Cr√©er un curseur d‚Äô√©volution temporelle</li>
<li>Ajouter une √©chelle √† la carte</li>
<li>Polir un peu l‚Äôinterface de l‚Äôapplication avec du CSS</li>
<li>Pour aller plus loin, apprendre √† utiliser des plugins OpenLayers</li>
</ul>
</section>
<section id="cours" class="level2">
<h2 class="anchored" data-anchor-id="cours">Cours</h2>
<p>Aujourd‚Äôhui, c‚Äôest de la pratique. M‚Äôentendre parler pendant des heures, c‚Äôest fini&nbsp;!</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://kaamelott-gifboard.fr/gifs/on-en-a-gros.gif" class="img-fluid quarto-figure quarto-figure-center figure-img" alt="GIF : Kaamelott on en a gros" width="427"></p>
</figure>
</div>
</section>
<section id="tp---faire-une-carte-interactive-sur-le-th√®me-de-lexploitation-mini√®re-et-ses-impacts-n√©gatifs-sur-les-populations-locales" class="level2">
<h2 class="anchored" data-anchor-id="tp---faire-une-carte-interactive-sur-le-th√®me-de-lexploitation-mini√®re-et-ses-impacts-n√©gatifs-sur-les-populations-locales">TP - Faire une carte interactive sur le th√®me de l‚Äôexploitation mini√®re et ses impacts n√©gatifs sur les populations locales</h2>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Ce TP se base sur l‚Äôarchitecture d√©ploy√©e et le code √©crit au cours du TP ‚ÄúOpenLayers &amp; GeoServer‚Äù.</p>
</div>
</div>
<p>C‚Äôest un titre √† rallonge, mais voici en gros dans quelle direction la donn√©e de la Land Matrix va nous permettre de partir. Nous allons nous baser sur tout ce qui a √©t√© cr√©√© lors du TD ‚ÄúOpenLayers &amp; GeoServer‚Äù. Si vous n‚Äôavez pas pu suivre le TD ou que vous avez √©gar√© vos fichiers, merci de le signaler maintenant.</p>
<section id="cr√©er-un-menu-daffichage-des-couches" class="level3">
<h3 class="anchored" data-anchor-id="cr√©er-un-menu-daffichage-des-couches">Cr√©er un menu d‚Äôaffichage des couches</h3>
<p>Si jamais vous n‚Äôaviez pas eu le temps d‚Äôafficher plus d‚Äôune couche, voici le code avec lequel j‚Äôai commenc√© ce TP. <strong>N‚Äôoubliez pas de remplacer les √©l√©ments comme l‚Äôadresse de votre GeoServer&nbsp;!</strong> Et si votre application affiche d√©j√† la couche ‚Äúdeals‚Äù et ‚Äúdeals_by_country‚Äù, inutile de copier mon code, c‚Äôest plus int√©ressant de repartir du votre.</p>
<p><strong>index.html</strong></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;!DOCTYPE</span> html<span class="dt">&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">html</span><span class="ot"> lang</span><span class="op">=</span><span class="st">"en"</span><span class="dt">&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">meta</span><span class="ot"> charset</span><span class="op">=</span><span class="st">"UTF-8"</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> rel</span><span class="op">=</span><span class="st">"icon"</span><span class="ot"> type</span><span class="op">=</span><span class="st">"image/x-icon"</span><span class="ot"> href</span><span class="op">=</span><span class="st">"https://openlayers.org/favicon.ico"</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">meta</span><span class="ot"> name</span><span class="op">=</span><span class="st">"viewport"</span><span class="ot"> content</span><span class="op">=</span><span class="st">"width=device-width, initial-scale=1.0"</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">title</span><span class="dt">&gt;</span>Transition Minerals<span class="dt">&lt;/</span><span class="kw">title</span><span class="dt">&gt;</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> id</span><span class="op">=</span><span class="st">"map"</span><span class="dt">&gt;&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> type=</span><span class="st">"module"</span><span class="ot"> src</span><span class="op">=</span><span class="st">"./main.js"</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">html</span><span class="dt">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>style.css</strong></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">@import</span> <span class="st">"node_modules/ol/ol.css"</span><span class="op">;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>html<span class="op">,</span> body {</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">margin</span><span class="ch">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">height</span><span class="ch">:</span> <span class="dv">100</span><span class="dt">%</span><span class="op">;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#map</span> {</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">position</span><span class="ch">:</span> <span class="dv">absolute</span><span class="op">;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">top</span><span class="ch">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">bottom</span><span class="ch">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">width</span><span class="ch">:</span> <span class="dv">100</span><span class="dt">%</span><span class="op">;</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>main.js</strong></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="st">'./style.css'</span><span class="op">;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> {<span class="bu">Map</span><span class="op">,</span> View} <span class="im">from</span> <span class="st">'ol'</span><span class="op">;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { ImageWMS } <span class="im">from</span> <span class="st">'ol/source'</span><span class="op">;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> TileLayer <span class="im">from</span> <span class="st">'ol/layer/Tile'</span><span class="op">;</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ImageLayer <span class="im">from</span> <span class="st">'ol/layer/Image'</span><span class="op">;</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> OSM <span class="im">from</span> <span class="st">'ol/source/OSM'</span><span class="op">;</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">// WMS de mon GeoServer</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> geoserverWms <span class="op">=</span> <span class="st">'http://localhost:8080/geoserver/land_matrix/wms'</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co">// Layer: Fond de carte OSM</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> layerOsm <span class="op">=</span> <span class="kw">new</span> <span class="fu">TileLayer</span>({ <span class="dt">source</span><span class="op">:</span> <span class="kw">new</span> <span class="fu">OSM</span>() })<span class="op">;</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co">// Layer: deals by country</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> layerDealsByCountry <span class="op">=</span> <span class="kw">new</span> <span class="fu">ImageLayer</span>({</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="dt">source</span><span class="op">:</span> <span class="kw">new</span> <span class="fu">ImageWMS</span>({</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">url</span><span class="op">:</span> geoserverWms<span class="op">,</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">params</span><span class="op">:</span> { <span class="st">'LAYERS'</span> <span class="op">:</span> <span class="st">'land_matrix:deals_by_country'</span> }<span class="op">,</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">serverType</span><span class="op">:</span> <span class="st">'geoserver'</span><span class="op">,</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="co">// Layer: deals</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> sourceDeals <span class="op">=</span> <span class="kw">new</span> <span class="fu">ImageWMS</span>({</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  <span class="dt">url</span><span class="op">:</span> geoserverWms<span class="op">,</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  <span class="dt">params</span><span class="op">:</span> { <span class="st">'LAYERS'</span> <span class="op">:</span> <span class="st">'land_matrix:deals'</span> }<span class="op">,</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  <span class="dt">serverType</span><span class="op">:</span> <span class="st">'geoserver'</span><span class="op">,</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> layerDeals <span class="op">=</span> <span class="kw">new</span> <span class="fu">ImageLayer</span>({</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>  <span class="dt">source</span><span class="op">:</span> sourceDeals</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="co">// Map</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> map <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>({</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>  <span class="dt">target</span><span class="op">:</span> <span class="st">'map'</span><span class="op">,</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>  <span class="dt">layers</span><span class="op">:</span> [ layerOsm<span class="op">,</span> layerDealsByCountry<span class="op">,</span> layerDeals ]<span class="op">,</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>  <span class="dt">view</span><span class="op">:</span> <span class="kw">new</span> <span class="fu">View</span>({</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>    <span class="dt">center</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>]<span class="op">,</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>    <span class="dt">zoom</span><span class="op">:</span> <span class="dv">2</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>On souhaite maintenant cr√©er un menu avec des cases de type ‚Äúcheckbox‚Äù qui vont nous permettre de choisir si on veut afficher ou masquer une couche. On doit commencer par cr√©er cet √©l√©ment dans l‚Äôinterface en modifiant <code>index.html</code>.</p>
<ul>
<li><p>D√©finissez une <code>&lt;div&gt;</code> dans laquelle on souhaite afficher notre menu de couches et positionnez-la avec du CSS</p></li>
<li><p>Ajoutez √† l‚Äôint√©rieur un input de type checkbox avec la balise <code>&lt;input type="checkbox"/&gt;</code> et donnez lui un label avec le nom de la couche</p></li>
</ul>
<p>Comme c‚Äôest la premi√®re fois qu‚Äôon doit √©crire du HTML ensemble, je vous guide pas √† pas. Commencez par ouvrir <code>index.html</code> et ajouter sous la <code>div</code> de votre carte (la div <code>map</code>) une autre div, comme ceci&nbsp;:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> id</span><span class="op">=</span><span class="st">"layers"</span><span class="ot"> class</span><span class="op">=</span><span class="st">"menu"</span><span class="dt">&gt;&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>On cr√©e une nouvelle <code>div</code> dont l‚Äôidentifiant est <code>layers</code>, ce qui nous permettra de la retrouver par la suite. On lui a aussi ajout√© une classe qu‚Äôon appelle <code>menu</code> et qui nous permettra d‚Äôappliquer un seul style √† tous nos √©l√©ments de menu. Si c‚Äôest un peu flou maintenant, vous comprendrez plus tard en ajoutant d‚Äôautres menus.</p>
<p>Comme notre <code>div</code> est vide, on ne la voit pas. √áa va √™tre difficile de la positionner ailleurs sur la carte. J‚Äôai l‚Äôhabitude de mettre un peu n‚Äôimporte quoi √† l‚Äôint√©rieur, juste le temps de r√©gler mon CSS correctement. Ma div ressemble donc √†&nbsp;:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> id</span><span class="op">=</span><span class="st">"layers"</span><span class="ot"> class</span><span class="op">=</span><span class="st">"menu"</span><span class="dt">&gt;</span>cthulhu fhtagn<span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>On pourra retirer le texte apr√®s. Vous remarquerez qu‚Äôon ne voit toujours pas notre texte. Essayez de rafra√Æchir la page - vous devriez le voir tout en haut √† gauche de l‚Äô√©cran avant que la carte ne le recouvre&nbsp;! C‚Äôest normal, nous n‚Äôavons pas ‚Äúpositionn√©‚Äù notre √©l√©ment. Ce n‚Äôest pas un cours de CSS donc on ne rentrera pas dans les d√©tails. Ouvrez <code>styles.css</code> et ajoutez le code suivant&nbsp;:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">.menu</span> {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">position</span><span class="ch">:</span> <span class="dv">absolute</span><span class="op">;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>On s√©lectionne toutes les balises html avec la classe <code>menu</code> et on leur applique un positionnement absolu. Sauvegardez et vous devriez voir appara√Ætre le texte. Super&nbsp;! Mais‚Ä¶ c‚Äôest moche et √ßa ne ressemble pas DU TOUT √† un menu. Pas de souci, on y arrive. Ajoutez les √©l√©ments suivants (j‚Äôai comment√© le code pour vous aider √† comprendre)&nbsp;:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">.menu</span> {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Positionnement dans le body */</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">position</span><span class="ch">:</span> <span class="dv">absolute</span><span class="op">;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">top</span><span class="ch">:</span> <span class="dv">20</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">right</span><span class="ch">:</span> <span class="dv">20</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Padding */</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">padding</span><span class="ch">:</span> <span class="dv">8</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Dimensions minimales */</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">min-height</span><span class="ch">:</span> <span class="dv">80</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">min-width</span><span class="ch">:</span> <span class="dv">160</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Rectangle blanc avec coins arrondis */</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">background-color</span><span class="ch">:</span> <span class="cn">white</span><span class="op">;</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">border-radius</span><span class="ch">:</span> <span class="dv">8</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Ah, c‚Äôest d√©j√† plus sympa&nbsp;! On va m√™me pouvoir supprimer le texte de notre balise HTML dans <code>index.html</code>. En gros, voil√† ce que je fais avec ce code CSS&nbsp;:</p>
<ul>
<li><p>J‚Äôindique que l‚Äô√©l√©ment a une position absolue dans le body (donc pas relative √† un √©l√©ment) et qu‚Äôil doit se trouver √† 20 pixels du haut (<code>top</code>) et 20 pixels de la droite (<code>right</code>) de l‚Äô√©cran.</p></li>
<li><p>Je donne un <em>padding</em>, une marge int√©rieur, √† mon √©l√©ment de menu. Pour mieux comprendre, essayez de supprimer cette ligne et regardez ce qui change.</p></li>
<li><p>Je donne une hauteur et une largeur minimales √† mon √©l√©ment pour √©viter qu‚Äôil ne dispara√Æsse quand il est vide. Par d√©faut, mon √©l√©ment aurait grandi et r√©tr√©ci avec son contenu.</p></li>
<li><p>J‚Äôai donn√© un peu de style √† mon menu en lui donnant un fond blanc et des coins arrondis.</p></li>
</ul>
<p>Voil√† globalement le niveau maximum de difficult√© du CSS que je vais vous demander pour styliser votre application, mais vous pouvez √©videmment allez plus loin&nbsp;!</p>
<p>Maintenant qu‚Äôon a un menu, il va falloir ajouter la checkbox qui permettra d‚Äôafficher ou masquer ma couche. Retournez dans <code>index.html</code> et ajoutez la balise <code>&lt;input&gt;</code> et son <code>&lt;label&gt;</code> dans notre <code>&lt;div id="layers&gt;</code>, comme ceci&nbsp;:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> id</span><span class="op">=</span><span class="st">"layers"</span><span class="ot"> class</span><span class="op">=</span><span class="st">"menu"</span><span class="dt">&gt;</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">input</span><span class="ot"> type</span><span class="op">=</span><span class="st">"checkbox"</span><span class="ot"> id</span><span class="op">=</span><span class="st">"checkbox-countries"</span><span class="ot"> name</span><span class="op">=</span><span class="st">"checkbox-countries"</span><span class="ot"> checked </span><span class="dt">/&gt;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">label</span><span class="ot"> for</span><span class="op">=</span><span class="st">"checkbox-countries"</span><span class="dt">&gt;</span>Deals by countries<span class="dt">&lt;/</span><span class="kw">label</span><span class="dt">&gt;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>V√©rifiez que vous pouvez cliquer sur la checkbox pour la cocher/d√©cocher. L‚Äôinterface est pr√™te&nbsp;! Il faut maintenant qu‚Äôon parvienne √† dire √† notre application qu‚Äôil faut afficher ou masquer la couche deals_by_country en fonction.</p>
<p>ü§î <strong>On doit d‚Äôabord se demander comment s‚Äôy prendre pour masquer une couche dans OpenLayers.</strong></p>
<p>On va se servir des m√©thodes qui sont disponibles pour tous les objets <code>Layer</code> de OpenLayers. La <a href="https://openlayers.org/en/latest/apidoc/module-ol_layer_Base-BaseLayer.html#setVisible">documentation</a> nous apprend l‚Äôexistence de la m√©thode <code>setVisible()</code>. Voil√† ce qu‚Äôon nous en dit&nbsp;:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="media/set_visible_ol.png" class="img-fluid quarto-figure quarto-figure-center figure-img" alt="Documentation de la m√©thode setVisible() OpenLayers"></p>
</figure>
</div>
<p>La m√©thode <code>setVisible()</code> prend un argument <code>visible</code>. Cet argument est de type ‚Äúboolean‚Äù, il peut donc prendre la valeur <code>true</code> ou <code>false</code>. On va faire le test et utiliser cette fonction pour faire dispara√Ætre notre couche. Allez dans <code>main.js</code> et ajouter cette ligne √† la fin de votre script&nbsp;:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>layer_deals_by_country<span class="op">.</span><span class="fu">setVisible</span>(<span class="kw">false</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Attention&nbsp;!</strong> <code>layer_deals_by_country</code> est le nom de la variable dans laquelle j‚Äôai cr√©√© ma couche ‚Äúdeals_by_country‚Äù. Si vous avez nomm√© votre couche diff√©remment, n‚Äôoubliez pas de changer le nom&nbsp;!</p>
<p>Normalement, la couche ne devrait plus √™tre visible sur la carte. Super, la m√©thode a fonctionn√©&nbsp;! Il ne nous reste plus qu‚Äô√† ‚Äúconnecter‚Äù cette m√©thode √† notre √©l√©ment checkbox.</p>
<p>On l‚Äôa d√©j√† vu dans le TP Serveurs cartographiques (lorsqu‚Äôon affichait la l√©gende des couches), il est possible de trouver un √©l√©ment HTML et de le modifier en utilisant du JavaScript. Pour trouver un √©l√©ment, le plus facile est de rechercher son identifiant <code>id</code>. Ajoutez en bas de <code>main.js</code>&nbsp;:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> checkbox_countries <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">'checkbox-countries'</span>)<span class="op">;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(checkbox_countries)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Sauvegardez et allez dans la console de votre navigateur. Vous devriez voir appara√Ætre votre tag <code>&lt;input&gt;</code> dans la console. Si vous le survolez avec la souris, la checkbox devrait √™tre pass√©e en surbrillance. Si √ßa fonctionne, parfait ! √áa veut dire qu‚Äôon arrive bien √† r√©cup√©rer notre √©l√©ment de checkbox. Maintenant, on souhaite ex√©cuter du code lorsque son statut ‚Äúchecked‚Äù change. Pour cela, on doit ‚Äú√©couter‚Äù la checkbox pour savoir si l‚Äô√©v√®nement ‚Äúchange‚Äù a eu lieu.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> checkboxCountries <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">'checkbox-countries'</span>)<span class="op">;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>checkboxCountries<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">'change'</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="bu">event</span><span class="op">.</span><span class="at">currentTarget</span><span class="op">.</span><span class="at">checked</span>) {</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// On fait des trucs quand la checkbox est check√©e</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"Checked"</span>)<span class="op">;</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// On fait des trucs quand la checkbox n‚Äôest PAS check√©e</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"Pas checked"</span>)<span class="op">;</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><p><code>addEventListener</code> indique qu‚Äôon souhaite ‚Äú√©couter‚Äù les √©v√®nements de notre checkbox. On pr√©cise le type d‚Äô√©v√®nement avec le premier param√®tre, <code>'change'</code>.</p></li>
<li><p>La condition <code>if</code> v√©rifie si notre checkbox est check√©e ou non. On r√©cup√®re cette information gr√¢ce √† <code>event.current.checked</code>. Si cette condition est <code>true</code>, on affiche ‚ÄúChecked‚Äù dans la console. Si cette condition est <code>false</code>, on affiche ‚ÄúPas checked‚Äù.</p></li>
</ul>
<p>Essayez&nbsp;! Cliquez sur la checkbox et surveillez votre console. On voit bien s‚Äôafficher les messages. On y est presque&nbsp;! Maintenant, au lieu d‚Äôafficher du texte, on souhaite afficher la couche quand la condition est <code>true</code> et la masquer quand la condition est <code>false</code>.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> checkboxCountries <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">'checkbox-countries'</span>)<span class="op">;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>checkboxCountries<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">'change'</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="bu">event</span><span class="op">.</span><span class="at">currentTarget</span><span class="op">.</span><span class="at">checked</span>) {</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// On fait des trucs quand la checkbox est check√©e</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    layer_deals_by_country<span class="op">.</span><span class="fu">setVisible</span>(<span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// On fait des trucs quand la checkbox n‚Äôest PAS check√©e</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    layer_deals_by_country<span class="op">.</span><span class="fu">setVisible</span>(<span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Pensez bien √†‚Ä¶
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><p>Changer le nom de la couche <code>layer_deals_by_country</code> si vous n‚Äôavez pas appel√© votre couche comme √ßa.</p></li>
<li><p>Supprimer la ligne <code>layer_deals_by_country.setVisible(false);</code> toute seule au dessus ou votre couche sera masqu√©e par d√©faut au moment de charger la carte.</p></li>
</ul>
</div>
</div>
<p>Voil√†, on peut d√©sormais afficher et masquer la couche √† volont√©&nbsp;!</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://media1.tenor.com/m/wn2_Qq6flogAAAAC/magical-magic.gif" class="img-fluid quarto-figure quarto-figure-center figure-img" alt="GIF : Magic" width="435"></p>
</figure>
</div>
<p>√Ä vous&nbsp;! Cr√©ez une autre checkbox qui permet d‚Äôafficher ou masquer la couche deals. J‚Äôaimerais que cette checkbox soit <strong>au-dessus</strong> de la premi√®re&nbsp;!</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Sauf indication contraire (via du CSS), les √©l√©ments HTML sont affich√©s dans l‚Äôordre dans lequel ils sont d√©clar√©s.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> id</span><span class="op">=</span><span class="st">"2"</span><span class="dt">&gt;&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> id</span><span class="op">=</span><span class="st">"1"</span><span class="dt">&gt;&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Dans cet exemple, ma div 1 sera plus bas que ma div 2. √áa devrait vous aider !</p>
</div>
</div>
</section>
<section id="interroger-une-couche-wms-et-afficher-les-r√©sultats" class="level3">
<h3 class="anchored" data-anchor-id="interroger-une-couche-wms-et-afficher-les-r√©sultats">Interroger une couche WMS et afficher les r√©sultats</h3>
<p>On souhaite maintenant interroger la couche deals en cliquant dessus. Cette √©tape est plus compliqu√©e que la pr√©c√©dente car elle va nous demander d‚Äôutiliser <code>fetch()</code>, on va donc l√†-aussi proc√©der petit √† petit pour bien comprendre ce qu‚Äôon fait. Ouvrez l‚Äôexemple OpenLayers <a href="https://openlayers.org/en/latest/examples/getfeatureinfo-image.html">WMS GetFeatureInfo (Image Layer)</a>.</p>
<p>Commen√ßons par s‚Äôint√©resser √† cette partie du code&nbsp;:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>map<span class="op">.</span><span class="fu">on</span>(<span class="st">'singleclick'</span><span class="op">,</span> <span class="kw">function</span> (evt) {</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">'info'</span>)<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="st">''</span><span class="op">;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> viewResolution <span class="op">=</span> <span class="co">/** </span><span class="an">@type</span><span class="co"> {number} */</span> (view<span class="op">.</span><span class="fu">getResolution</span>())<span class="op">;</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> url <span class="op">=</span> wmsSource<span class="op">.</span><span class="fu">getFeatureInfoUrl</span>(</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    evt<span class="op">.</span><span class="at">coordinate</span><span class="op">,</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    viewResolution<span class="op">,</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'EPSG:3857'</span><span class="op">,</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    {<span class="st">'INFO_FORMAT'</span><span class="op">:</span> <span class="st">'text/html'</span>}<span class="op">,</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (url) {</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fetch</span>(url)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">then</span>((response) <span class="kw">=&gt;</span> response<span class="op">.</span><span class="fu">text</span>())</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">then</span>((html) <span class="kw">=&gt;</span> {</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>        <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">'info'</span>)<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> html<span class="op">;</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><p><code>.on('singleclick')</code> permet d‚Äôex√©cuter une fonction lorsqu‚Äôon clique sur la carte.</p></li>
<li><p><code>document.getElementById()</code> r√©cup√®re l‚Äô√©l√©ment ‚Äòinfo‚Äô dans lequel ils affichent leurs r√©sultats.</p></li>
<li><p>On r√©cup√®re la r√©solution de la vue de la carte gr√¢ce √† la m√©thode dans <code>viewResolution</code>. On a besoin de passer cette r√©solution dans la fonction suivante.</p></li>
<li><p>On r√©cup√®re l‚Äôurl qui contient les informations de l‚Äô√©l√©ment cliqu√© avec la m√©thode <code>getFeatureInfoUrl()</code> de la source de donn√©es.</p></li>
<li><p>Si notre url est d√©finie, alors on utilise la fonction <code>fetch()</code> pour r√©cup√©rer la donn√©e √† partir de cette adresse.</p></li>
<li><p><code>document.getElementById()</code> r√©cup√®re √† nouveau l‚Äô√©l√©ment ‚Äòinfo‚Äô et d√©finir la valeur de son <code>innerHTML</code> pour pouvoir afficher les r√©sultats.</p></li>
</ul>
<p>Compliqu√©&nbsp;? Non, √ßa va aller&nbsp;! On va tranquillement r√©√©crire cette fonction pour la couche <code>deals</code>. Pour rappel, voici comment j‚Äôappelle la couche <code>deals</code> dans mon code&nbsp;:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> sourceDeals <span class="op">=</span> <span class="kw">new</span> <span class="fu">ImageWMS</span>({</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">url</span><span class="op">:</span> geoserverWms<span class="op">,</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">params</span><span class="op">:</span> { <span class="st">'LAYERS'</span> <span class="op">:</span> <span class="st">'land_matrix:deals'</span> }<span class="op">,</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">serverType</span><span class="op">:</span> <span class="st">'geoserver'</span><span class="op">,</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> layerDeals <span class="op">=</span> <span class="kw">new</span> <span class="fu">ImageLayer</span>({</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">source</span><span class="op">:</span> sourceDeals</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Je commence donc par ex√©cuter une fonction lorsque je clique sur la carte&nbsp;:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>map<span class="op">.</span><span class="fu">on</span>(<span class="st">'singleclick'</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"J‚Äôai cliqu√© sur la carte&nbsp;!"</span>)<span class="op">;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Sauvegardez, gardez la console de votre navigateur ouverte et cliquez sur la carte pour v√©rifier que le message appara√Æt bien. Si c‚Äôest bon, on vient d‚Äôapprendre comment ex√©cuter des fonctions en cliquant sur la carte&nbsp;! On sait ensuite que dans l‚Äôexemple ils utilisent la m√©thode <code>getFeatureInfoUrl()</code> de leur source de donn√©es pour r√©cup√©rer les informations des features. Ouvrez la <a href="https://openlayers.org/en/latest/apidoc/module-ol_source_ImageWMS-ImageWMS.html#getFeatureInfoUrl">documentation de ImageWMS</a> on va en avoir besoin. Voil√† ce qu‚Äôelle nous dit au sujet de la m√©thode <code>fetFeatureInfoUrl()</code>&nbsp;:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="media/get_feature_info_url_ol.png" class="img-fluid quarto-figure quarto-figure-center figure-img" alt="Documentation getFeatureInfoUrl() d‚ÄôOpenLayers"></p>
</figure>
</div>
<p>La m√©thode prend plusieurs param√®tres&nbsp;:</p>
<ul>
<li><p><code>coordinate</code>, les coordonn√©es vis√©es par le clic de l‚Äôutilisateur</p></li>
<li><p><code>resolution</code>, la r√©solution de la carte (li√©e √† la <code>view</code> de ma carte)</p></li>
<li><p><code>projection</code>, le syst√®me de projection de la carte&nbsp;: ‚ÄúEPSG:3857‚Äô‚Äù</p></li>
<li><p><code>params</code>, un objet contenant plusieurs param√®tres comme le format d√©sir√© du r√©sultat ou encore les couches qu‚Äôon souhaite interroger</p></li>
</ul>
<p>R√©cup√©rons ces √©l√©ments dans l‚Äôordre en commen√ßant par les coordonn√©es. Dans l‚Äôexemple, ils r√©f√©rencent directement la source de coordonn√©es <code>evt.coordinate</code> dans la fonction mais √ßa va un peu vite. Pour mieux comprendre, on va stocker les coordonn√©es de notre √©v√®nement (= notre clic) dans une constante.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>map<span class="op">.</span><span class="fu">on</span>(<span class="st">'singleclick'</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"J‚Äôai cliqu√© sur la carte&nbsp;!"</span>)<span class="op">;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> coord <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">coordinate</span><span class="op">;</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>En fait, l‚Äô√©v√®nement ‚Äòsingleclick‚Äô de la carte <code>map</code> permet de r√©cup√©rer les coordonn√©es du clic en acc√©dant √† sa propri√©t√© <code>coordinate</code>. On √©crit donc <code>event.coordinate</code>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Pourquoi on a ‚Äúevent‚Äù et pas ‚Äúevt‚Äù&nbsp;?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>J‚Äôai fait expr√®s de changer le nom du param√®tre pour appeler tous les √©v√®nements ‚Äúevent‚Äù dans notre code et pour ajouter cette petite note. En fait, quand on cr√©e une fonction, on peut nommer notre param√®tre comme on veut. Par exemple, dans le code suivant&nbsp;:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>map<span class="op">.</span><span class="fu">on</span>(<span class="st">'singleclick'</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> coord <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">coordinate</span><span class="op">;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>‚Ä¶ la variable <code>coordinates</code> a la m√™me valeur que si j‚Äô√©cris&nbsp;:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>map<span class="op">.</span><span class="fu">on</span>(<span class="st">'singleclick'</span><span class="op">,</span> (evt) <span class="kw">=&gt;</span> {</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> coord <span class="op">=</span> evt<span class="op">.</span><span class="at">coordinate</span><span class="op">;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>‚Ä¶ ou encore&nbsp;:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>map<span class="op">.</span><span class="fu">on</span>(<span class="st">'singleclick'</span><span class="op">,</span> (mon_evenement_qui_vient_de_ma_carte_avec_mon_clic) <span class="kw">=&gt;</span> {</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> coord <span class="op">=</span> mon_evenement_qui_vient_de_ma_carte_avec_mon_clic<span class="op">.</span><span class="at">coordinate</span><span class="op">;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Bien s√ªr, si vous ne vous sentez pas encore trop en confiance, inutile de renommer ce genre d‚Äô√©l√©ments pour uniformiser le code. Vous pouvez garder ce que vous voyez dans le code OpenLayers.</p>
</div>
</div>
</div>
<p>Apr√®s les coordonn√©es, on r√©cup√®re la r√©solution. On sait qu‚Äôon lit la r√©solution depuis la vue de la carte, donc on peut d‚Äôabord r√©cup√©rer cette vue PUIS lire sa r√©solution (toujours dans notre fonction, pas √† l‚Äôext√©rieur&nbsp;!)&nbsp;:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> view <span class="op">=</span> map<span class="op">.</span><span class="fu">getView</span>()<span class="op">;</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> res <span class="op">=</span> view<span class="op">.</span><span class="fu">getResolution</span>()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>On peut aussi encha√Æner les m√©thodes comme ceci&nbsp;:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> res <span class="op">=</span> map<span class="op">.</span><span class="fu">getView</span>()<span class="op">.</span><span class="fu">getResolution</span>()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Pourquoi on ne reprend pas le /** @type */ du code original&nbsp;?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Parce qu‚Äôon n‚Äôen est pas √† faire du TypeScript&nbsp;! Ils ont fait un exc√®s de z√®le dans cet exemple. Cette syntaxe √©trange signifique que le type de la constante est de type ‚Äúnumber‚Äù, donc un nombre. Mais √ßa on le sait d√©j√† de toute fa√ßon, on a lu la documentation.</p>
</div>
</div>
</div>
<p>On est √† mi-chemin et le reste est tr√®s simple. La projection doit √™tre indiqu√©e par une cha√Æne de caract√®res&nbsp;:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> proj <span class="op">=</span> <span class="st">'EPSG:3857'</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Et on reprend les param√®tres de l‚Äôexemple pour indiquer qu‚Äôon veut r√©cup√©rer notre r√©ponse au format HTML. Par d√©faut, GeoServer renverra la table attributaire de l‚Äô√©l√©ment sous forme d‚Äôun tableau en HTML.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> parametres <span class="op">=</span> {<span class="st">'INFO_FORMAT'</span><span class="op">:</span> <span class="st">'text/html'</span>}<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>On a tous nos √©l√©ments, il ne nous reste qu‚Äô√† appeler la m√©thode <code>getFeatureInfoUrl()</code> sur notre <strong>source</strong> de donn√©es (attention, pas la couche&nbsp;!) pour g√©n√©rer l‚Äôurl qui nous permettra de r√©cup√©rer la r√©ponse. La documentation nous indique que les param√®tres doivent √™tre renseign√©s dans l‚Äôordre suivant&nbsp;:</p>
<ul>
<li><p>coordinate</p></li>
<li><p>resolution</p></li>
<li><p>projection</p></li>
<li><p>params</p></li>
</ul>
<div class="sourceCode" id="cb25"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> url <span class="op">=</span> sourceDeals<span class="op">.</span><span class="fu">getFeatureInfoUrl</span>(coord<span class="op">,</span> res<span class="op">,</span> proj<span class="op">,</span> parametres)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Ou encore, pour ressembler √† l‚Äôexemple&nbsp;:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> url <span class="op">=</span> sourceDeals<span class="op">.</span><span class="fu">getFeatureInfoUrl</span>(</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  coord<span class="op">,</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  res<span class="op">,</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  proj<span class="op">,</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  parametres</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Pour r√©capituler, voil√† √† quoi ressemble ma fonction pour le moment. J‚Äôai ajout√© un <code>console.log()</code> pour voir l‚Äôurl s‚Äôafficher dans ma console et donc bien v√©rifier que j‚Äôarrive √† g√©n√©rer cette adresse.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>map<span class="op">.</span><span class="fu">on</span>(<span class="st">'singleclick'</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"J‚Äôai cliqu√© sur la carte&nbsp;!"</span>)<span class="op">;</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> coord <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">coordinate</span><span class="op">;</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> res <span class="op">=</span> map<span class="op">.</span><span class="fu">getView</span>()<span class="op">.</span><span class="fu">getResolution</span>()<span class="op">;</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> proj <span class="op">=</span> <span class="st">'EPSG:3857'</span><span class="op">;</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> parametres <span class="op">=</span> {<span class="st">'INFO_FORMAT'</span><span class="op">:</span> <span class="st">'text/html'</span>}<span class="op">;</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> url <span class="op">=</span> sourceDeals<span class="op">.</span><span class="fu">getFeatureInfoUrl</span>(coord<span class="op">,</span> res<span class="op">,</span> proj<span class="op">,</span> parametres)<span class="op">;</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(url)<span class="op">;</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Attention, voil√† la partie plus compliqu√©e&nbsp;: maintenant qu‚Äôon a une addresse, on doit utilier la fonction <code>fetch()</code> pour r√©cup√©rer la donn√©e. C‚Äôest une fonction bien particuli√®re. Elle est dite ‚Äúasynchrone‚Äù car elle ne bloque pas le reste du code lorsqu‚Äôelle tourne, contrairement aux autres fonctions ‚Äúsynchrones‚Äù. Si j‚Äô√©cris une fonction <code>reboursSynchrone()</code>, l‚Äôex√©cution de mon code et donc mon application est bloqu√©e pendant que la fonction s‚Äôex√©cute. Si c‚Äôest une petite fonction rapide √ßa ne pose pas de probl√®me. Si c‚Äôest quelque chose de plus lent, par exemple qui demande d‚Äôattendre la r√©ponse d‚Äôun serveur dans le cas de notre fetch, notre application est bloqu√©e et on est bien emb√™t√©s. Au contraire, si j‚Äô√©cris une fonction <code>reboursAsynchrone()</code> l‚Äôapplication n‚Äôattendra pas que la fonction ait termin√© de s‚Äôex√©cuter pour pouvoir continuer de fonctionner.</p>
<p>Du coup, l‚Äôasynchrone, c‚Äôest tr√®s pratique&nbsp;! Par contre, comme c‚Äôest particulier et qu‚Äôil est plus difficile de pr√©voir quand elle va terminer son ex√©cution et si elle va rencontrer des erreurs ou non, on va devoir lui r√©server un traitement particulier. Reprenons le code de l‚Äôexemple pour l‚Äôexpliquer petit √† petit.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fetch</span>(url)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">then</span>((response) <span class="kw">=&gt;</span> response<span class="op">.</span><span class="fu">text</span>())</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">then</span>((html) <span class="kw">=&gt;</span> {</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// J‚Äôai modifi√© la ligne suivante pour simplifier, on s‚Äôint√©ressera √† elle un peu plus tard</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"C‚Äôest une r√©ussite&nbsp;!"</span>)<span class="op">;</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Vous noterez l‚Äôutilisation de m√©thodes <code>.then()</code> qui contiennent des fonctions. Ce sont les fonctions √† ex√©cuter quand le maillon pr√©c√©dent de la cha√Æne a fini de se r√©soudre. Si on devait √©crire en langage courant ce que signifie ce code, voil√† ce que √ßa donnerait&nbsp;:</p>
<ul>
<li><p><code>fetch(url)</code> ‚Üí ‚ÄúR√©cup√®re les informations qui sont disponibles √† cette adresse‚Äù</p></li>
<li><p><code>.then((response) =&gt; response.text())</code> ‚Üí ‚ÄúEnsuite (‚Äù<em>then</em>‚Äù), quand tu as <strong>r√©ussi</strong> √† r√©cup√©rer la r√©ponse, stocke-la dans une variable que j‚Äôappelle ‚Äúresponse‚Äù puis utilise sa m√©thode <code>.text()</code> pour r√©cup√©rer du texte au format HTML‚Äù</p></li>
<li><p><code>.then((html) =&gt; { console.log("C‚Äôest une r√©ussite&nbsp;!"); })</code> ‚Üí ‚ÄúEnsuite, quand tu as <strong>r√©ussi</strong> l‚Äô√©tape pr√©c√©dente, stocke le texte au format HTML de l‚Äô√©tape pr√©c√©dente dans une variable que j‚Äôappelle‚Äùhtml‚Äù et affiche un message dans ma console‚Äù</p></li>
</ul>
<p>Vous noterez que j‚Äôai pr√©cis√© que <code>.then()</code> s‚Äôex√©cute si l‚Äô√©tape pr√©c√©dente a r√©ussi. Si ce n‚Äôest pas le cas, l‚Äôex√©cution de notre cha√Æne de m√©thodes <code>fetch()</code> s‚Äôarr√™te et un message d‚Äôerreur s‚Äôaffiche dans la console. Comme on a plut√¥t confiance en notre GeoServer, on peut se lancer et ex√©cuter ce <code>fetch()</code> mais attention, seulement si on a bien une addresse √† interroger&nbsp;! Si la variable <code>url</code> est <code>undefined</code>, notre application risque de p√©ter les plombs. On ajoute une condition autour du <code>fetch()</code> pour √©viter les erreurs&nbsp;:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (url) {</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fetch</span>(url)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">then</span>((response) <span class="kw">=&gt;</span> response<span class="op">.</span><span class="fu">text</span>())</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">then</span>((html) <span class="kw">=&gt;</span> {</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"C‚Äôest une r√©ussite&nbsp;!"</span>)<span class="op">;</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(html)<span class="op">;</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Vous pouvez tester les <code>console.log()</code>. Le HTML qu‚Äôon obtient n‚Äôest pas tr√®s gracieux tel quel, il vaudrait mieux l‚Äôafficher dans l‚Äôinterface de l‚Äôapplication&nbsp;!</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Au secours, je n‚Äôai toujours pas compris fetch()
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://media0.giphy.com/media/v1.Y2lkPTc5MGI3NjExYm5odGpnZTVnY3V4ZGZyNHQ2aDhqZjFqMGVlNnhpZXZ5Yjgxa3gxaiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/9iBIdXITr6LoVf8XgY/giphy.webp" class="img-fluid quarto-figure quarto-figure-center figure-img" alt="GIF : Kermit qui n‚Äôen peut plus"></p>
</figure>
</div>
<p>Si votre cerveau est un peu comme √ßa quand on parle de <code>fetch()</code>, n‚Äôh√©sitez pas √† m‚Äôappeler pour avoir une nouvelle explication. J‚Äôai peur de ne pas pouvoir faire mieux par √©crit. La notion de fonction asynchrone est complexe et j‚Äôai mis pas mal de temps √† la comprendre, donc en deux minutes en plein milieu d‚Äôun TP c‚Äôest encore pire.</p>
<p>Sinon, vous pouvez continuer le TP, on aura d‚Äôautres occasion d‚Äôutiliser <code>fetch()</code>. Peut-√™tre que les autres exemples seront plus clairs&nbsp;!</p>
</div>
</div>
</div>
<p>Quand on doit afficher un nouvel √©l√©ment dans l‚Äôinterface, il faut toujours penser √† cr√©er une nouvelle balise HTML (souvent une <code>&lt;div&gt;</code>) pour le mettre √† l‚Äôint√©rieur. Comme pour l‚Äôexemple pr√©c√©dent, on cr√©e une div dans le HTML. Je place la mienne apr√®s <code>&lt;div id="layers"&gt;</code> et je remets n‚Äôimporte quoi dedans juste pour la voir dans mon interface.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> id</span><span class="op">=</span><span class="st">"attributes"</span><span class="ot"> class</span><span class="op">=</span><span class="st">"menu"</span><span class="dt">&gt;</span>cthulhu ftaghn<span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Sauvegardez et regardez l‚Äôapplication. Et l√†, horreur&nbsp;! Notre menu de couches est remplac√© par la nouvelle div qu‚Äôon vient de cr√©er&nbsp;! C‚Äôest normal, elles ont le m√™me style car on a aussi appel√© <code>class="menu"</code> dans la div. Le probl√®me, c‚Äôest que dans <code>styles.css</code>, on voit que tous nos menus sont positionn√©s au m√™me endroit&nbsp;: regardez <code>top</code> et <code>right</code>.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">.menu</span> {</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Positionnement dans le body */</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">position</span><span class="ch">:</span> <span class="dv">absolute</span><span class="op">;</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">top</span><span class="ch">:</span> <span class="dv">20</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">right</span><span class="ch">:</span> <span class="dv">20</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Padding */</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">padding</span><span class="ch">:</span> <span class="dv">8</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Dimensions minimales */</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">min-height</span><span class="ch">:</span> <span class="dv">80</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">min-width</span><span class="ch">:</span> <span class="dv">160</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Rectangle blanc avec coins arrondis */</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">background-color</span><span class="ch">:</span> <span class="cn">white</span><span class="op">;</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">border-radius</span><span class="ch">:</span> <span class="dv">8</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>On va donc devoir positionner nos deux <code>&lt;div&gt;</code> ind√©pendamment l‚Äôune de l‚Äôautre. Pour les s√©lectionner individuellement, on peut utiliser le s√©lecteur <code>#</code> qui permet de chercher par <code>id</code>. Voil√† mon code&nbsp;:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">.menu</span> {</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Padding */</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">padding</span><span class="ch">:</span> <span class="dv">8</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Dimensions minimales */</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">min-height</span><span class="ch">:</span> <span class="dv">80</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">min-width</span><span class="ch">:</span> <span class="dv">160</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Rectangle blanc avec coins arrondis */</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">background-color</span><span class="ch">:</span> <span class="cn">white</span><span class="op">;</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">border-radius</span><span class="ch">:</span> <span class="dv">8</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="pp">#layers</span> {</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Positionnement dans le body */</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">position</span><span class="ch">:</span> <span class="dv">absolute</span><span class="op">;</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">top</span><span class="ch">:</span> <span class="dv">20</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>  <span class="kw">right</span><span class="ch">:</span> <span class="dv">20</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a><span class="pp">#attributes</span> {</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Positionnement dans le body */</span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>  <span class="kw">position</span><span class="ch">:</span> <span class="dv">absolute</span><span class="op">;</span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>  <span class="kw">top</span><span class="ch">:</span> <span class="dv">20</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>  <span class="kw">left</span><span class="ch">:</span> <span class="dv">20</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Voil√†, maintenant <code>.menu</code> me permet de d√©finir un padding, des dimensions minimales, une couleur de background et des coins arrondis pour tous mes √©l√©ments avec la classe <code>class="menu"</code>, mais par contre j‚Äôai bien positionn√© ind√©pendamment mon menu de layers et ma nouvelle div <code>attributes</code>.</p>
<p>Maintenant, modifiez le style de <code>#attributes</code> pour l‚Äôafficher en bas de la carte et sur toute la largeur de l‚Äô√©cran. Il nous faut beaucoup d‚Äôespace pour afficher notre table.</p>
<p>C‚Äôest bon, vous avez une <code>&lt;div id="attributes"&gt;</code> qui vous pla√Æt&nbsp;? Vous pouvez supprimer le texte qui √©tait dans la div, on n‚Äôen aura plus besoin. Maintenant, on cherche √† dire √† notre application&nbsp;: ‚ÄúPrends le texte HTML que je r√©cup√®re gr√¢ce √† ma fonction et mets-le dans ma div Attributes‚Äù. On a formul√© notre id√©e en langage naturel, on va maintenant pouvoir l‚Äô√©crire en JavaScript. D‚Äôabord, on se demande √† quel endroit dans notre code on r√©cup√®re ce HTML. Souvenez-vous&nbsp;:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Interroger la couche deals et afficher les r√©sultats</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>map<span class="op">.</span><span class="fu">on</span>(<span class="st">'singleclick'</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"J‚Äôai cliqu√© sur la carte&nbsp;!"</span>)<span class="op">;</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> coord <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">coordinate</span><span class="op">;</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> res <span class="op">=</span> map<span class="op">.</span><span class="fu">getView</span>()<span class="op">.</span><span class="fu">getResolution</span>()<span class="op">;</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> proj <span class="op">=</span> <span class="st">'EPSG:3857'</span><span class="op">;</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> parametres <span class="op">=</span> {<span class="st">'INFO_FORMAT'</span><span class="op">:</span> <span class="st">'text/html'</span>}<span class="op">;</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> url <span class="op">=</span> sourceDeals<span class="op">.</span><span class="fu">getFeatureInfoUrl</span>(coord<span class="op">,</span> res<span class="op">,</span> proj<span class="op">,</span> parametres)<span class="op">;</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (url) {</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fetch</span>(url)</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">then</span>((response) <span class="kw">=&gt;</span> response<span class="op">.</span><span class="fu">text</span>())</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">then</span>((html) <span class="kw">=&gt;</span> {</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Dans cette fonction, on a acc√®s √† notre "html" !</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>        <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"C‚Äôest une r√©ussite&nbsp;!"</span>)<span class="op">;</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>        <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(html)<span class="op">;</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Vous voyez mon commentaire&nbsp;? C‚Äôest dans cette fonction qu‚Äôon va √©crire notre code. Zoomons sur cette petite partie&nbsp;:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">then</span>((html) <span class="kw">=&gt;</span> {</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Dans cette fonction, on a acc√®s √† notre "html" !</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>        <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"C‚Äôest une r√©ussite&nbsp;!"</span>)<span class="op">;</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(html)<span class="op">;</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Si je traduis le texte pr√©c√©dent en langage naturel, pour rappel, √ßa fait&nbsp;:</p>
<ul>
<li><p>Quand tu as <strong>r√©ussi</strong> l‚Äô√©tape pr√©c√©dente (souvenez-vous de <em>then</em>), alors stocke le r√©sultat dans une variable <code>html</code> et&nbsp;:</p></li>
<li><p>Affiche ‚ÄúC‚Äôest une r√©ussite&nbsp;!‚Äù dans ma console</p></li>
<li><p>Affiche le contenu du HTML dans ma console</p></li>
</ul>
<p>On aimerait remplacer les deux derni√®res √©tapes par ‚Äúaffiche le HTML dans mon interface‚Äù. Pour cela, on utilise la ligne de code suivante (√† ajouter au bon endroit dans la fonction)&nbsp;:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">'attributes'</span>)<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> html<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Super, vous savez maintenant requ√™ter une couche WMS&nbsp;! Le r√©sultat est un peu moche pour le moment mais vous pourrez revenir plus tard pour l‚Äôaffiner. Si vous finissez le TP en avance, revenez sur les sections ‚ÄúPour aller plus loin‚Ä¶‚Äù.</p>
</section>
<section id="filtrer-des-couches-wms" class="level3">
<h3 class="anchored" data-anchor-id="filtrer-des-couches-wms">Filtrer des couches WMS</h3>
<p>On a vu dans l‚Äô√©tape pr√©c√©dente qu‚Äôil √©tait possible de requ√™ter une couche WMS. Vous ne serez donc pas surpris d‚Äôapprendre qu‚Äôil est aussi possible de filtrer ces couches&nbsp;! Les flux WMS ont beau retourner une image, on constate maintenant qu‚Äôelles ne manquent pas d‚Äôinteractivit√©.</p>
<p>GeoServer permet d‚Äôajouter des filtres √©crits au format cql √† la requ√™te pour lui dire ‚Äúapplique ce filtre √† ma couche avant de m‚Äôenvoyer le r√©sultat‚Äù. Le filtrage se fait donc <strong>du c√¥t√© du serveur</strong>. Vous pouvez trouver les sp√©cifications WMS avec <code>cql_filter</code> <a href="https://docs.geoserver.org/main/en/user/services/wms/vendor.html#cql-filter">ici</a> et le tutoriel de filtrage <a href="https://docs.geoserver.org/2.24.x/en/user/tutorials/cql/cql_tutorial.html">l√†</a> mais comme c‚Äôest une notion un peu complexe √† appliquer seul, on va une fois de plus proc√©der √©tape par √©tape ensemble.</p>
<p>Dans votre GeoServer, pr√©visualisez la couche <code>deals</code> et cliquez sur les <code>...</code> bleus en haut √† gauche de la carte. Vous devriez voir plusieurs nouvelles options appara√Ætre dont une qui s‚Äôappelle ‚ÄúFilter:‚Äù. L‚Äôoption ‚ÄúCQL‚Äù devrait d√©j√† √™tre s√©lectionn√©e, gardez-la. C‚Äôest ce qu‚Äôon va utiliser pour la suite.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="media/geoserver_cql_filter.png" class="img-fluid quarto-figure quarto-figure-center figure-img" alt="Capture d‚Äô√©cran de la preview de ma couche deals avec les options affich√©es"></p>
</figure>
</div>
<p>Collez le texte suivant dans le champ CQL et cliquez sur ‚ÄúAppliquer‚Äù&nbsp;:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode html cql code-with-copy"><code class="sourceCode html"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>deal_size &gt; 10000</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Normalement, vous avez vu certains points dispara√Ætre. Il ne vous reste plus que les deals de plus de 10&nbsp;000 hectares. Si vous avez un doute, vous pouvez v√©rifier en cliquant sur les points pour afficher leurs attributs. C‚Äôest facile, non&nbsp;? Essayez les filtres suivant et essayez de comprendre √† quoi ils peuvent servir&nbsp;:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>silver = true</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb38"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>target_country = 'Argentina'</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb39"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>target_country = 'Argentina' OR target_country = 'Philippines'</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Quand vous √©crivez des cha√Ænes de caract√®res dans un filtre CQL (‚Äú<em>string</em>‚Äù), il faut <strong>imp√©rativement</strong> utiliser les guillemets simples <code>'my_string'</code> et pas les doubles <code>"my_string"</code>.</p>
<p><em>Ne me demandez pas pourquoi, ce n‚Äôest pas expliqu√©, il faut juste l‚Äôaccepter et vivre avec.</em></p>
</div>
</div>
<p>Bien, vous savez maintenant √©crire un filtre simple en CQL, mais comment est-ce qu‚Äôon fait pour filtrer la couche depuis notre application OpenLayers&nbsp;? Voici mon code pour appliquer √† ma couche <code>deals</code> un filtre qui va uniquement r√©cup√©rer les mines qui se trouvent en Argentine (<em>Argentina</em>) ou aux Philippines (<em>Philippines</em>). Comparez ce snippet avec votre code pour comprendre o√π mettre ce code et ce qu‚Äôil fait&nbsp;:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> sourceDeals <span class="op">=</span> <span class="kw">new</span> <span class="fu">ImageWMS</span>({</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">url</span><span class="op">:</span> geoserverWms<span class="op">,</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">params</span><span class="op">:</span> {</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'LAYERS'</span> <span class="op">:</span> <span class="st">'land_matrix:deals'</span><span class="op">,</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CQL_FILTER"</span> <span class="op">:</span> <span class="st">"target_country = 'Argentina' OR target_country = 'Philippines'"</span><span class="op">,</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">serverType</span><span class="op">:</span> <span class="st">'geoserver'</span><span class="op">,</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Si vous vous √™tes content√© de copier-coller tout √ßa dans votre code, c‚Äôest rat√©&nbsp;! Il faut regarder mon snippet de code pour comprendre ce que <strong>vous devez ajouter √† votre code existant</strong>&nbsp;!</p>
</div>
</div>
<p>Sauvegardez et regardez votre carte. Si vous avez compris ce que fait mon CQL, vous devriez rapidement √™tre capables de dire si le filtre a fonctionn√© ou non. Vous voyez, filtrer un flux WMS, c‚Äôest facile&nbsp;!</p>
<p><strong>Maintenant, modifiez votre code pour afficher uniquement des mines qui produisent de l‚Äôor.</strong> Je vous donne deux indices&nbsp;: regardez la table attributaire de la couche <code>deals</code> et souvenez vous que ‚Äúor‚Äù se dit ‚Äú<em>Gold</em>‚Äù en anglais. Pour ceux qui ont eu des consoles portables, il y a une licence vid√©oludique bien pratique pour retenir des noms de min√©raux en anglais&nbsp;:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://media0.giphy.com/media/v1.Y2lkPTc5MGI3NjExbXlmbngwNmNlM3FwZWkzank0N3J2YndnMG43em43enp1bW1ta2MwdyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/Pn21gQZ3CHzFhL8uep/giphy.webp" class="img-fluid quarto-figure quarto-figure-center figure-img" alt="GIF : Pok√©mon Gold" width="220"></p>
</figure>
</div>
<p><em>(Si vous √™tes capable d‚Äôentendre ce GIF juste en le regardant, vous commencez √† √™tre vieux aussi, d√©sol√©e. Quoi qu‚Äôil en soit, j‚Äôesp√®re que les interruptions GIFs vous font un peu d√©compresser.)</em></p>
<p>Maintenant que vous savez filtrer la couche, vous pouvez ajouter un peu plus d‚Äôinteractivit√© √† votre carte. On va afficher un menu avec des boutons de type ‚Äúradio‚Äù pour s√©lectionner des filtres. Je vous fais un sch√©ma moche √† la main pour vous aider √† comprendre.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="media/map_select_produce.png" class="img-fluid quarto-figure quarto-figure-center figure-img" alt="Sch√©ma du menu &quot;Production&quot; √† ajouter √† la carte"></p>
</figure>
</div>
<p>Vous voyez o√π on veut en venir&nbsp;? Comme on commence √† avoir l‚Äôhabitude de faire des menus, je vous laisse cr√©er et positionner celui-ci avec un peu de HTML et de CSS et on passe directement √† l‚Äôajout des boutons. On va devoir mettre dans notre √©l√©ment <code>&lt;div&gt;</code> plusieurs boutons radio avec la balise <code>&lt;input type="radio"&gt;</code>. Voil√† le code pour les √©l√©ments ‚ÄúOr‚Äù et ‚ÄúArgent‚Äù&nbsp;:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">&lt;!-- Radio button menu - production --&gt;</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> id</span><span class="op">=</span><span class="st">"production"</span><span class="ot"> class</span><span class="op">=</span><span class="st">"menu"</span><span class="dt">&gt;</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&lt;</span><span class="kw">input</span><span class="ot"> type</span><span class="op">=</span><span class="st">"radio"</span><span class="ot"> id</span><span class="op">=</span><span class="st">"button-gold"</span><span class="ot"> name</span><span class="op">=</span><span class="st">"produce"</span><span class="ot"> value</span><span class="op">=</span><span class="st">"gold"</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&lt;</span><span class="kw">label</span><span class="ot"> for</span><span class="op">=</span><span class="st">"gold"</span><span class="dt">&gt;</span>Or<span class="dt">&lt;/</span><span class="kw">label</span><span class="dt">&gt;</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&lt;</span><span class="kw">input</span><span class="ot"> type</span><span class="op">=</span><span class="st">"radio"</span><span class="ot"> id</span><span class="op">=</span><span class="st">"button-silver"</span><span class="ot"> name</span><span class="op">=</span><span class="st">"produce"</span><span class="ot"> value</span><span class="op">=</span><span class="st">"silver"</span><span class="ot"> </span><span class="dt">/&gt;</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&lt;</span><span class="kw">label</span><span class="ot"> for</span><span class="op">=</span><span class="st">"silver"</span><span class="dt">&gt;</span>Argent<span class="dt">&lt;/</span><span class="kw">label</span><span class="dt">&gt;</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Vous noterez plusieurs choses&nbsp;:</p>
<ul>
<li><p><code>&lt;input&gt;</code> et <code>&lt;label&gt;</code> vont par paires</p></li>
<li><p>la balise <code>&lt;label&gt;</code> contient le nom en fran√ßais de mon √©l√©ment, c‚Äôest ce qui s‚Äôaffiche dans l‚Äôapplication</p></li>
<li><p>toutes les balises <code>&lt;input&gt;</code> on la m√™me propri√©t√© <code>name="produce"</code>, on dirait donc qu‚Äôil vaut mieux continuer dans ce sens</p></li>
<li><p>on a une propri√©t√© <code>id</code> unique √† chaque <code>&lt;input&gt;</code> qui nous permettra, au besoin, d‚Äôaller les chercher avec du JavaScript</p></li>
<li><p>la propri√©t√© <code>value</code> de mes <code>&lt;input&gt;</code> semble correspondre √† des colonnes de la table attributaire de ma couche</p></li>
</ul>
<p>Avec ces √©l√©ments, ajoutez les boutons pour Charbon, Lithium et Cobalt comme indiqu√©s sur mon sch√©ma plus haut. <strong>Attention √† bien mettre Charbon en haut&nbsp;!</strong> Quand c‚Äôest termin√©, allez sur votre carte et cliquez un peu sur ces boutons radio. Normalement, vous ne pouvez pas s√©lectionner plus d‚Äôun seul √©l√©ment √† la fois au sein du groupe. Votre application sait que tous ces boutons font partie du m√™me groupe car vous leur avez tous donn√© la m√™me valeur <code>name="produce"</code>. Si vous commencez √† modifier cette valeur, vous verrez appara√Ætre un comportement ind√©sirable.</p>
<p>Une fois que votre menu est pr√™t, bien positionn√© sur la carte et que vos cinq boutons radio fonctionnent, on va pouvoir passer au JavaScript. Comme d‚Äôhabitude, on va exprimer notre besoin en langage naturel&nbsp;: <strong>‚ÄúLorsque je s√©lectionne un min√©ral, je souhaite modifier le filtre de ma couche <code>deals</code> pour r√©cup√©rer uniquement les deals qui produisent les min√©raux s√©lectionn√©s‚Äù</strong>.</p>
<p>Pour rappel, voici les √©l√©ments dont on dispose&nbsp;:</p>
<ul>
<li><p>on a des boutons radio avec une valeur <code>value</code> qui correspond √† une colonne de la table attributaire</p></li>
<li><p>vous avez d√©j√† une couche qui filtre les deals qui produisent de l‚Äôor avec un filtre CQL</p></li>
<li><p>le filtre CQL est tout simplement une cha√Æne de caract√®res (<em>string</em>)</p></li>
</ul>
<p>Le r√©sultat auquel on voudrait arriver, c‚Äôest donc&nbsp;: <strong>‚ÄúMon CQL dans les <code>params</code> de la source de ma couche <code>deals</code> change d√®s que je s√©lectionne un nouveau min√©ral‚Äù</strong>.</p>
<p>√áa tombe bien&nbsp;! La <a href="https://openlayers.org/en/latest/apidoc/module-ol_source_ImageWMS-ImageWMS.html#updateParams">documentation de la source ImageWMS</a> (celle qu‚Äôon utilise pour notre couche) nous apprend qu‚Äôil existe une m√©thode <code>.updateParams()</code> qui permet de mettre √† jour les param√®tres d‚Äôune couche.</p>
<p>Commencez par ajouter ces deux √©l√©ments en bas de <code>main.js</code>. Souvenez-vous de la mani√®re dont on a ‚Äú√©cout√©‚Äù notre checkbox du premier exercice de ce TP. Le code ressemble beaucoup, non&nbsp;?</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> buttonGold <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">'button-gold'</span>)<span class="op">;</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>buttonGold<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">'change'</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"Test"</span>)<span class="op">;</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Voici ce que font les deux √©l√©ments du code&nbsp;:</p>
<ul>
<li><p>la premi√®re ligne r√©cup√®re mon bouton radio qui gr√¢ce √† son identifiant en utilisant la m√©thode <code>.getElementById()</code> que vous avons d√©j√† vue pr√©c√©demment</p></li>
<li><p>les trois lignes suivantes nous permettent d‚Äô√©couter notre bouton radio gr√¢ce √† <code>.addEventListener()</code> et d‚Äôex√©cuter une fonction quand le bouton radio est coch√©, et la fonction affiche ‚ÄúTest‚Äù dans la console de d√©veloppement</p></li>
</ul>
<p>On y est presque. On arrive √† ex√©cuter quelque chose quand on s√©lectionne ‚ÄúOr‚Äù dans notre carte, mais √ßa ne nous permet pas de filtrer la couche. On va retirer notre <code>console.log()</code> et demander √† JavaScript de modifier les param√®tres de la source de notre couche deals gr√¢ce √† la ligne suivante&nbsp;:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>sourceDeals<span class="op">.</span><span class="fu">updateParams</span>({ <span class="st">'CQL_FILTER'</span> <span class="op">:</span> <span class="st">'gold=true'</span> })<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Pour rappel, la source de mes deals est stock√©e dans la variable <code>sourceDeals</code> mais attention, il est possible que la votre porte un autre nom. Pensez √† v√©rifier&nbsp;!</p>
<p>Histoire de pouvoir tester au moins avec les boutons ‚ÄúOr‚Äù et ‚ÄúArgent‚Äù, je vous donne un snippet de code plus complet. Inspirez-vous aussi des commentaires que je laisse, je rappelle que j‚Äôattends un code comment√© pour l‚Äô√©valuation&nbsp;!</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Or</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> buttonGold <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">'button-gold'</span>)<span class="op">;</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>buttonGold<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">'change'</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Quand l‚Äôutilisateur clique sur le bouton "Or", je mets √† jour mon filtre CQL</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  sourceDeals<span class="op">.</span><span class="fu">updateParams</span>({ <span class="st">'CQL_FILTER'</span> <span class="op">:</span> <span class="st">'gold=true'</span> })<span class="op">;</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Argent</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> buttonSilver <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">'button-silver'</span>)<span class="op">;</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>buttonSilver<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">'change'</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>  sourceDeals<span class="op">.</span><span class="fu">updateParams</span>({ <span class="st">'CQL_FILTER'</span> <span class="op">:</span> <span class="st">'silver=true'</span> })<span class="op">;</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Testez l‚Äôapplication en cliquant alternativement sur les boutons radio de Or et Argent. Si les deux couches sont diff√©rentes, super, √ßa fonctionne&nbsp;!</p>
<p>Maintenant que vous avez compris comment faire, faites les √©tapes suivantes (et souvenez-vous que c‚Äôest √† vous que je demande, pas √† Chat-GPT, je vous ai quand m√™me d√©j√† bien m√¢ch√© le travail avec l‚Äôexemple ci-dessus&nbsp;!).</p>
<ul>
<li><p>on a cr√©√© un filtre fonctionnel pour Or et Argent, maintenant <strong>faites la m√™me chose pour toutes les autres options</strong></p></li>
<li><p>quand vous avez termin√©, rajoutez une option ‚ÄúTous‚Äù avec la valeur <code>value="all"</code> et faites en sorte qu‚Äôil affiche tous les deals (je vous ai mis des indices ci-dessous si vous avez du mal mais essayez d‚Äôabord de r√©fl√©chir sans)</p></li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Indice 1 - ajouter l‚Äôoption ‚ÄúTous‚Äù
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Souvenez vous&nbsp;: si vous voulez ajouter un √©l√©ment √† l‚Äôinterface, commencez par <code>index.html</code>.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Indice 2 - filtrer ‚ÄúTous‚Äù
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Comme on √©crit du code JavaScript, on doit le faire dans <code>main.js</code>. Comme pour les autres options, vous pouvez r√©cup√©rer le bouton radio avec <code>.getElementById()</code> puis l‚Äô√©couter avec <code>.addEventListener()</code>.</p>
<p>Pour ce qui est du filtre CQL&nbsp;: si on veut tous les deals, il suffit que notre filtre soit <strong>vide</strong>. Donc vous devriez avoir quelque part une cha√Æne de caract√®res (<em>string</em>) vide.</p>
</div>
</div>
</div>
<p>Une fois que c‚Äôest termin√© et que vous avez un beau menu fonctionnel pour filtrer vos couches, on peut passer √† la suite&nbsp;!</p>
</section>
<section id="des-cercles-proportionnels-avec-un-flux-wfs" class="level3">
<h3 class="anchored" data-anchor-id="des-cercles-proportionnels-avec-un-flux-wfs">Des cercles proportionnels avec un flux WFS</h3>
<p>On commence √† avoir fait le tour des interactions basiques avec les flux WMS, qui pour rappel nous envoient des images. Mais, si vous vous souvenez bien, on a aussi √©voqu√© dans le premier cours la possibilit√© de r√©cup√©rer non pas une image mais des <strong>vecteurs gr√¢ce aux flux WFS</strong>. C‚Äôest ce qui va nous int√©resser maintenant&nbsp;: notre objectif va √™tre d‚Äôafficher notre couche <code>deals_by_country_centroid</code> et de la styliser pour afficher des cercles proportionnels. Et vous allez voir que r√©cup√©rer une couche WFS avec OpenLayers, c‚Äôest du g√¢teau.</p>
<p>Je vous donne la structure du code √† √©crire dans <code>main.js</code>. N‚Äôoubliez pas que les √©l√©ments encadr√©s par des chevrons <code>"&lt;un_truc&gt;"</code> doivent √™tre remplac√©s par une vraie valeur. Par exemple, si je vous √©cris <code>const formation = "&lt;ma_formation&gt;"</code>, vous devrez mettre dans votre code <code>const formation = "geonum"</code>. Facile&nbsp;! Voil√† donc le snippet de base&nbsp;:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co">// N‚Äôoubliez pas de mettre un commentaire pour m‚Äôexpliquer ce que vous faites</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> sourceCentroid <span class="op">=</span> <span class="kw">new</span> <span class="fu">VectorSource</span>({</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">format</span><span class="op">:</span> <span class="kw">new</span> <span class="fu">GeoJSON</span>()<span class="op">,</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">url</span><span class="op">:</span> <span class="st">'&lt;mon_flux_wfs&gt;'</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> layerCentroid <span class="op">=</span> <span class="kw">new</span> <span class="fu">VectorLayer</span>({</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">source</span><span class="op">:</span> sourceCentroid<span class="op">,</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>‚Ä¶ et les imports √† ajouter tout en haut du fichier&nbsp;:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> VectorSource <span class="im">from</span> <span class="st">'ol/source/Vector'</span><span class="op">;</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> GeoJSON <span class="im">from</span> <span class="st">'ol/format/GeoJSON.js'</span><span class="op">;</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> VectorLayer <span class="im">from</span> <span class="st">'ol/layer/Vector'</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Vous remarquez que vous avons un √©l√©ment <code>&lt;mon_flux_wms&gt;</code> √† remplacer. Pour trouver l‚ÄôURL de ce flux, allez dans votre interface GeoServer, s√©lectionnez ‚ÄúPr√©visualisation de la couche‚Äù. Cette fois, au lieu de choisir ‚ÄúOpenLayers‚Äù (qui nous donne le flux WMS), allez dans la colonne ‚ÄúTous les formats‚Äù et s√©lectionnez GeoJSON. <strong>Je rappelle qu‚Äôon ne travaille plus sur la couche <code>deals</code> mais bien sur la couche <code>deals_by_country_centroid</code>.</strong> Il ne vous reste plus qu‚Äô√† copier l‚ÄôURL dans votre navigateur&nbsp;: c‚Äôest la valeur de <code>url</code> dans votre <code>VectorSource()</code>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Oups, j‚Äôai oubli√© de retirer les chevrons ‚Äú&lt;‚Äù en collant mon url
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://media1.giphy.com/media/v1.Y2lkPTc5MGI3NjExbm84eWJjMWNlNnF4d2lxdjFhYnJoYmRkM3RweWZ5M2Q3ZWlya3hidSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/eUrE2DuMKOE0g/giphy.webp" class="img-fluid quarto-figure quarto-figure-center figure-img" alt="GIF : Justine Timberlake blas√©"></p>
</figure>
</div>
</div>
</div>
</div>
<p>Il ne reste plus qu‚Äôune seule √©tape pour afficher la couche sur la carte. Je vous laisse trouver laquelle&nbsp;!</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-14-contents" aria-controls="callout-14" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Allez, un petit indice&nbsp;?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-14" class="callout-14-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Vous l‚Äôavez d√©j√† fait plusieurs fois dans le TP pr√©c√©dent et celui-ci, et c‚Äôest souvent une √©tape qu‚Äôon oublie.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://media2.giphy.com/media/v1.Y2lkPTc5MGI3NjExNmN4NWdqczB6enZtdzJwZW5wazBwbjducTA2aDhnMm1qNWF1dm10eiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/MZ9nZGQn1nqBG/200.webp" class="img-fluid quarto-figure quarto-figure-center figure-img" alt="GIF : Mr Bean malicieux"></p>
</figure>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Je ne trouve vraiment pas‚Ä¶
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExZHl0dHJvajQ2cm9ldGxhcWtvaXRobmhtZGpmeWZlNjBxM3V3bjBwciZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/w89ak63KNl0nJl80ig/giphy.webp" class="img-fluid quarto-figure quarto-figure-center figure-img" alt="GIF : The Office, agent sous couverture" width="240"></p>
</figure>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Promis, j‚Äôai vraiment cherch√©&nbsp;!
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Bon, d‚Äôaccord. Dites-moi, comment se porte l‚Äôattribut <code>layers</code> de votre objet <code>map</code>&nbsp;?</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://media1.giphy.com/media/v1.Y2lkPTc5MGI3NjExNTMxd2h6aDBvczhuandzdzRnNTYwYzRhOW14NW53OXo5Y2tqYmk1aiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/i7WbuFkyAZ8HUAIn8E/giphy.webp" class="img-fluid quarto-figure quarto-figure-center figure-img" alt="GIF : Gollum donne la r√©ponse de l‚Äô√©nigme" width="200"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Une fois cette √©tape compl√©t√©e, la couche devrait appara√Ætre sur votre carte. Super&nbsp;! Par contre, √ßa ressemble certainement √† des cercles blancs, un peu transparents, avec un contour bleu. Et surtout, ce ne sont pas des cercles proportionnels&nbsp;!</p>
<p>Heureusement, vous avez √©t√© bien attentifs pendant vos cours de Leaflet et vous avez d√©j√† stylis√© des couches √† partir de donn√©e GeoJSON, √ßa devrait √™tre super facile pour vous. Comme la documentation GeoServer n‚Äôest pas tr√®s claire sur ce point, je vous donne un snippet et je vais vous demander de l‚Äôajuster un peu pour v√©rifier que vous comprendez bien qui fait quoi.</p>
<p>D‚Äôabord, on importe les √©l√©ments de style dont on va avoir besoin&nbsp;:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> {Circle<span class="op">,</span> Fill<span class="op">,</span> Stroke<span class="op">,</span> Style} <span class="im">from</span> <span class="st">'ol/style.js'</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>On commence par cr√©er un style ‚Äúpas proportionnel‚Äù qu‚Äôon stocke dans la constante <code>styleCentroid</code>.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> styleCentroid <span class="op">=</span> <span class="kw">new</span> <span class="fu">Style</span>({</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">image</span><span class="op">:</span> <span class="kw">new</span> <span class="fu">Circle</span>({</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">radius</span><span class="op">:</span> <span class="dv">40</span><span class="op">,</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">fill</span><span class="op">:</span> <span class="kw">new</span> <span class="fu">Fill</span>({ <span class="dt">color</span><span class="op">:</span> <span class="st">'white'</span> })<span class="op">,</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">stroke</span><span class="op">:</span> <span class="kw">new</span> <span class="fu">Stroke</span>({ <span class="dt">color</span><span class="op">:</span> <span class="st">'blue'</span><span class="op">,</span> <span class="dt">width</span><span class="op">:</span> <span class="dv">5</span> })<span class="op">,</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  })<span class="op">,</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>N‚Äôoubliez pas d‚Äôappeler votre style dans la propri√©t√© <code>style</code> de votre <code>VectorLayer</code> ou bien la couche ne changera pas.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> layerCentroid <span class="op">=</span> <span class="kw">new</span> <span class="fu">VectorLayer</span>({</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">source</span><span class="op">:</span> sourceCentroid<span class="op">,</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">style</span><span class="op">:</span> styleCentroid    <span class="co">// On a rajout√© cette ligne</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Attention √† l‚Äôordre dans lequel vous ajoutez les √©l√©ments dans le code. N‚Äôoubliez pas que pour appeler une constante (ou une variable) comme <code>styleCentroid</code>, il faut avoir d√©fini celle-ci avant&nbsp;!</p>
<p>Regardez √† quoi ressemble la couche maintenant qu‚Äôon lui a donn√© un style. C‚Äôest moche, hein&nbsp;? Et bien c‚Äôest √† vous de la rendre belle. Modifiez le code pour obtenir quelque chose qui ressemble √† √ßa&nbsp;:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="media/ol_styling_circles.png" class="img-fluid quarto-figure quarto-figure-center figure-img" alt="Couche de cercles oranges sur OpenLayers"></p>
</figure>
</div>
<p>Notez que les cercles ne sont pas enti√®rement opaques. Prenez le temps de vous appliquer, cela vous servira de base pour la suite. <strong>Quand vous avez termin√©</strong>, vous pourrez utiliser ce snippet pour afficher des cercles proportionnels.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">getStyleCentroid</span>(feature) {</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> nDeals <span class="op">=</span> feature<span class="op">.</span><span class="fu">get</span>(<span class="st">'n_deals'</span>)<span class="op">;</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> rayon <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(nDeals) <span class="op">*</span> <span class="fl">0.01</span><span class="op">;</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> style <span class="op">=</span> <span class="kw">new</span> <span class="fu">Style</span>({</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">image</span><span class="op">:</span> <span class="kw">new</span> <span class="fu">Circle</span>({</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">radius</span><span class="op">:</span> rayon<span class="op">,</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="kw">new</span> <span class="fu">Fill</span>({ <span class="dt">color</span><span class="op">:</span> <span class="st">'white'</span> })<span class="op">,</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="kw">new</span> <span class="fu">Stroke</span>({ <span class="dt">color</span><span class="op">:</span> <span class="st">'blue'</span><span class="op">,</span> <span class="dt">width</span><span class="op">:</span> <span class="dv">5</span> })<span class="op">,</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> style<span class="op">;</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> layerCentroid <span class="op">=</span> <span class="kw">new</span> <span class="fu">VectorLayer</span>({</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>  <span class="dt">source</span><span class="op">:</span> sourceCentroid<span class="op">,</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>  <span class="dt">style</span><span class="op">:</span> getStyleCentroid<span class="op">,</span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Vous noterez que la diff√©rence principale ici est qu‚Äôon appelle une <strong>fonction</strong> et non une constante, et que cette fonction prend <code>feature</code> en argument. En fait, ce qu‚Äôil se passe, c‚Äôest que la fonction va regarder chaque objet de ma couche (chaque <em>feature</em>) et appliquer les √©tapes qu‚Äôon a d√©finies √† l‚Äôint√©rieur.</p>
<ul>
<li><p>on lit un attribut de notre <code>feature</code> avec la m√©thode <code>.get()</code></p></li>
<li><p>on calcule un rayon</p></li>
<li><p>on d√©finit notre style comme pr√©c√©demment, mais au lieu d‚Äô√™tre une valeur fixe, notre propri√©t√© <code>radius</code> prend la valeur de notre rayon</p></li>
</ul>
<p>Je suis rest√©e volontairement vague dans ce cas pour ne pas vous souffler toutes les r√©ponses. Comme pr√©c√©demment, vous allez devoir modifier le snippet de code pour rendre la couche un peu plus √©l√©gante. Je vous montre mon exemple, essayez de le reproduire le plus fid√®lement possible&nbsp;:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="media/ol_styling_proportional.png" class="img-fluid quarto-figure quarto-figure-center figure-img" alt="Couche de cercles proportionnels dans OpenLayers"></p>
</figure>
</div>
<p>Une fois que c‚Äôest termin√©, il reste un dernier exercice √† faire avec ces cercles proportionnels. Vous aurez compris qu‚Äôici, nos cercles sont proportionnels au nombre de deals qui sont enregistr√©s dans le pays. <strong>Maintenant, cr√©ez une couche de cercles proportionnels en vous basant sur la surface total couverte par les deals dans chaque pays.</strong></p>
<p>On arrive sur la fin du TP et vous commencez (j‚Äôesp√®re) √† bien comprendre comment fonctionne notre application donc je ne vous donne pas d‚Äôindices. Faites juste attention √† bien faire varier la taille des cercles petit √† petit&nbsp;: si jamais votre navigateur essaie de dessiner des cercles trop grands, vous avez des chances de faire crasher votre ordinateur (√ßa m‚Äôest <em>peut-√™tre</em> arriv√© pendant mes tests et ce serait dommage que √ßa vous arrive aussi).</p>
</section>
</section>
<section id="l√©tape-finale" class="level2">
<h2 class="anchored" data-anchor-id="l√©tape-finale">L‚Äô√©tape finale&nbsp;!</h2>
<p>Enfin l‚Äô√©tape finale du TP&nbsp;! Une fois que votre application fonctionne et qu‚Äôelle vous convient, n‚Äôoubliez <strong>SURTOUT PAS</strong> de la build&nbsp;! Pour le moment, vous travaillez dans ce qu‚Äôon appelle un environnement de d√©veloppement mais quand vous √™tes pr√™ts √† pousser une application en production, il faut la build. On l‚Äôa d√©j√† fait au d√©but du TP pr√©c√©dent mais je vous remets les instructions ici parce que je suis bien sympa (et que vous avez s√ªrement le cerveau en compote apr√®s tout √ßa)&nbsp;:</p>
<ul>
<li><p>ouvrez un terminal √† la racine de votre projet</p></li>
<li><p>utilisez la commande <code>cd app</code> pour vous d√©placer dans le dossier de votre application</p></li>
<li><p>utilisez la commande <code>npm run build</code> pour build votre application, le r√©sultat sera mis dans le dossier <code>/dist</code></p></li>
<li><p>allez sur <a href="http://localhost/" class="uri">http://localhost/</a> et v√©rifiez que vous voyez bien la derni√®re version de votre application</p></li>
</ul>
<p>Et voil√†, bien jou√©&nbsp;! Vous n‚Äôavez plus qu‚Äô√† m‚Äôappeler pour me montrer le r√©sultat.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://media3.giphy.com/media/v1.Y2lkPTc5MGI3NjExcDJ1Nzd4b2tkbzZicmZ5eXBycG1wOGZ1ZzZncW5obzh2MTcwMDc1ZSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/AQRapWCgC7dThyVEYb/giphy.webp" class="img-fluid quarto-figure quarto-figure-center figure-img" alt="GIF : Solaire, Praise the Sun"></p>
</figure>
</div>
</section>
<section id="jai-fini-en-avance-quest-ce-que-je-fais" class="level2">
<h2 class="anchored" data-anchor-id="jai-fini-en-avance-quest-ce-que-je-fais">J‚Äôai fini en avance, qu‚Äôest-ce que je fais&nbsp;?</h2>
<p>D√©j√†, bravo, c‚Äô√©tait un gros TP. S‚Äôil reste du temps, je vais rajouter ici petit √† petit des t√¢ches pendant le TP qui vous permettront d‚Äôaller un peu plus loin et de pr√©parer votre code pour l‚Äô√©valuation. En attendant&nbsp;:</p>
<ul>
<li><p>v√©rifiez bien l‚Äôintendation de votre code</p></li>
<li><p>v√©rifiez aussi qu‚Äôil soit bien comment√©</p></li>
<li><p>am√©liorez le style des couches WMS comme WFS pour avoir une carte harmonieuse et un peu styl√©e</p></li>
<li><p>ajoutez un titre √† votre page</p></li>
<li><p>ajoutez une √©chelle (avec OpenLayers)</p></li>
</ul>
</section>
<section id="rajout√©-√†-la-fin-mais-√†-faire-quand-m√™me-une-table-attributaire-personnalis√©e" class="level2">
<h2 class="anchored" data-anchor-id="rajout√©-√†-la-fin-mais-√†-faire-quand-m√™me-une-table-attributaire-personnalis√©e">Rajout√© √† la fin MAIS √Ä FAIRE QUAND M√äME&nbsp;: une table attributaire personnalis√©e</h2>
<p>On va se r√©int√©resser √† notre couche WMS ‚Äúdeals‚Äù et √† sa table attributaire (souvenez-vous&nbsp;: <a href="#interroger-une-couche-wms-et-afficher-les-r√©sultats">Interroger une couche WMS et afficher les r√©sultats</a>). Je vous remets notre code ici pour vous rappeler quels √©l√©ments permettent de r√©cup√©rer la table attributaire. Attention au nom de vos couches et de vos sources, ce ne sont peut-√™tre pas les m√™mes que les miens&nbsp;!</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>map<span class="op">.</span><span class="fu">on</span>(<span class="st">'singleclick'</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> coord <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">coordinate</span><span class="op">;</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> res <span class="op">=</span> map<span class="op">.</span><span class="fu">getView</span>()<span class="op">.</span><span class="fu">getResolution</span>()<span class="op">;</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> proj <span class="op">=</span> <span class="st">'EPSG:3857'</span><span class="op">;</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> parametres <span class="op">=</span> {<span class="st">'INFO_FORMAT'</span><span class="op">:</span> <span class="st">'text/html'</span>}<span class="op">;</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> url <span class="op">=</span> sourceDeals<span class="op">.</span><span class="fu">getFeatureInfoUrl</span>(coord<span class="op">,</span> res<span class="op">,</span> proj<span class="op">,</span> parametres)<span class="op">;</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (url) {</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fetch</span>(url)</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">then</span>((response) <span class="kw">=&gt;</span> response<span class="op">.</span><span class="fu">text</span>())</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">then</span>((html) <span class="kw">=&gt;</span> {</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>        <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">'attributes'</span>)<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> html<span class="op">;</span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>       })<span class="op">;</span></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Faites attention √† cet √©l√©ment&nbsp;:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> parametres <span class="op">=</span> {<span class="st">'INFO_FORMAT'</span><span class="op">:</span> <span class="st">'text/html'</span>}<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Notez qu‚Äôon demande en fait √† notre GeoServer de nous donner la <strong>r√©ponse</strong> de notre <strong>requ√™te</strong> au format <strong>text/html</strong>. C‚Äôest sympathique, mais difficile √† customiser et surtout pas super pratique quand la table attribuaire est LONGUE. Heureusement, on peut r√©cup√©rer le r√©sultat au format JSON qui sera bien pratique pour customiser notre table.</p>
<p>Comme toujours, quand on souhaite ajouter un nouvel √©l√©ment √† notre carte, il faut qu‚Äôon commence par √©crire du HTML. On va modifier notre div <code>id="attributes"</code> pour y ajouter une table. R√©cup√©rez le code ci-dessous et regardez la diff√©rence, vous allez comprendre.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>div id<span class="op">=</span><span class="st">"attributes"</span> <span class="kw">class</span><span class="op">=</span><span class="st">"menu"</span><span class="op">&gt;</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="op">&lt;!--</span> Je cr√©e une table <span class="op">--&gt;</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">&lt;</span>table<span class="op">&gt;</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;!--</span> On utilise l‚Äô√©l√©ment tr pour cr√©er une ligne <span class="op">:</span> tr <span class="op">=</span> table row <span class="op">--&gt;</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>tr<span class="op">&gt;</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;!--</span> On utilise les √©l√©ments <span class="fu">th</span> (table header) pour cr√©er les headers de nos trois colonnes <span class="op">--&gt;</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>th<span class="op">&gt;</span>Deal ID<span class="op">&lt;/</span>th<span class="op">&gt;</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>th<span class="op">&gt;</span>Creation date<span class="op">&lt;/</span>th<span class="op">&gt;</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>th<span class="op">&gt;</span>Country<span class="op">&lt;/</span>th<span class="op">&gt;</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;/</span>tr<span class="op">&gt;</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;!--</span> On utilise l‚Äô√©l√©ment tr pour cr√©er une AUTRE ligne <span class="op">:</span> tr <span class="op">=</span> table row <span class="op">--&gt;</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>tr<span class="op">&gt;</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;!--</span> On cr√©e trois colonnes vides avec td <span class="op">--&gt;</span></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>td<span class="op">&gt;</span>‚Ä¶<span class="op">&lt;/</span>td<span class="op">&gt;</span></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>td<span class="op">&gt;</span>‚Ä¶<span class="op">&lt;/</span>td<span class="op">&gt;</span></span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>td<span class="op">&gt;</span>‚Ä¶<span class="op">&lt;/</span>td<span class="op">&gt;</span></span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;/</span>tr<span class="op">&gt;</span></span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;/</span>table<span class="op">&gt;</span></span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;/</span>div<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Vous devriez maintenant voir appara√Ætre une table dans votre <code>div</code>. Elle est aust√®re, d‚Äôaccord, mais vous pourrez la styliser apr√®s. Pour le moment, on va faire avec. Regardez bien mes commentaires pour comprendre comment est structur√© le code. Regardez bien ces trois √©l√©ments&nbsp;:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">td</span><span class="dt">&gt;</span>‚Ä¶<span class="dt">&lt;/</span><span class="kw">td</span><span class="dt">&gt;</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">td</span><span class="dt">&gt;</span>‚Ä¶<span class="dt">&lt;/</span><span class="kw">td</span><span class="dt">&gt;</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">td</span><span class="dt">&gt;</span>‚Ä¶<span class="dt">&lt;/</span><span class="kw">td</span><span class="dt">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Vous comprenez s√ªrement qu‚Äôon souhaite remplacer ces ‚Äú‚Ä¶‚Äù par des valeurs lorsqu‚Äôon clique sur un point de la couche. Il va donc falloir modifier cet √©l√©ment HTML avec nos fonctions JavaScript. Souvenez-vous qu‚Äôon utilise les identifiants pour retrouver les √©l√©ments HTML avec <code>.getElementById()</code>. Donc&nbsp;:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">td</span><span class="ot"> id</span><span class="op">=</span><span class="st">"table-deal-id"</span><span class="dt">&gt;</span>‚Ä¶<span class="dt">&lt;/</span><span class="kw">td</span><span class="dt">&gt;</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">td</span><span class="ot"> id</span><span class="op">=</span><span class="st">"table-creation-date"</span><span class="dt">&gt;</span>‚Ä¶<span class="dt">&lt;/</span><span class="kw">td</span><span class="dt">&gt;</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">td</span><span class="ot"> id</span><span class="op">=</span><span class="st">"table-country"</span><span class="dt">&gt;</span>‚Ä¶<span class="dt">&lt;/</span><span class="kw">td</span><span class="dt">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Maintenant qu‚Äôon a nos √©l√©ments, il va falloir les remplir. Retournez chercher votre m√©thode <code>map.on()</code> dans votre code, on va devoir l‚Äôam√©liorer un peu.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>map<span class="op">.</span><span class="fu">on</span>(<span class="st">'singleclick'</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> coord <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">coordinate</span><span class="op">;</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> res <span class="op">=</span> map<span class="op">.</span><span class="fu">getView</span>()<span class="op">.</span><span class="fu">getResolution</span>()<span class="op">;</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> proj <span class="op">=</span> <span class="st">'EPSG:3857'</span><span class="op">;</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> parametres <span class="op">=</span> { <span class="st">'INFO_FORMAT'</span><span class="op">:</span> <span class="st">'application/json'</span> } <span class="co">// On a chang√© un truc ici</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> url <span class="op">=</span> sourceDeals<span class="op">.</span><span class="fu">getFeatureInfoUrl</span>(coord<span class="op">,</span> res<span class="op">,</span> proj<span class="op">,</span> parametres)<span class="op">;</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (url) {</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fetch</span>(url)</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">then</span>((response) <span class="kw">=&gt;</span> response<span class="op">.</span><span class="fu">text</span>())</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">then</span>((json) <span class="kw">=&gt;</span> { <span class="co">// On a aussi chang√© un truc ici et dans la fonction</span></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> obj <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">parse</span>(json)<span class="op">;</span></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>        <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(obj)<span class="op">;</span></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Testez votre couche et regardez le r√©sultat dans la console. Si tout a fonctionn√©, vous devriez voir un objet JavaScript&nbsp;! D√©pliez-le et prenez le temps de l‚Äôexplorer dans votre console pour comprendre ce que vous regardez. L‚Äòinformation qui nous int√©resse est quelque part dans <code>features</code>. Voil√† ce qu‚Äôon doit faire avec la donn√©e&nbsp;:</p>
<ul>
<li><p>v√©rifier qu‚Äôon a bien cliqu√© sur une feature sur la carte (en JavaScript, √ßa demande de v√©rifier qu‚Äôon a bien de la donn√©e dans <code>features</code>)</p></li>
<li><p>r√©cup√©rer la <code>feature</code> sur laquelle j‚Äôai cliqu√© pour pouvoir acc√©der √† ses <code>properties</code></p></li>
<li><p>r√©cup√©rer mes cellules pour remplacer leur contenu</p></li>
<li><p>remplacer le contenu des cellules de ma table avec les <code>properties</code></p></li>
</ul>
<p>On va proc√©der petit √† petit. D‚Äôabord, on <strong>v√©rifie qu‚Äôon a bien une feature dans <code>feature</code></strong>&nbsp;:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (url) {</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fetch</span>(url)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">then</span>((response) <span class="kw">=&gt;</span> response<span class="op">.</span><span class="fu">text</span>())</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">then</span>((json) <span class="kw">=&gt;</span> { <span class="co">// On a aussi chang√© un truc ici et dans la fonction</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> obj <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">parse</span>(json)<span class="op">;</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (obj<span class="op">.</span><span class="at">features</span>[<span class="dv">0</span>]) {</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>          <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"J‚Äôai cliqu√© sur une feature&nbsp;!"</span>)<span class="op">;</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>          <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"J‚Äôai cliqu√© √† c√¥t√©‚Ä¶"</span>)<span class="op">;</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>  }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>On utilise une condition <code>if</code> pour tester la pr√©sence d‚Äôune feature dans <code>obj</code>. <code>obj.features[0]</code> peut se traduire par&nbsp;: ‚ÄúR√©cup√®re mon tableau <code>feature</code> de mon <code>obj</code> et prends le premier √©l√©ment‚Äù. La condition regarde simplement si <code>feature[0]</code> est vide ou non. Si ce n‚Äôest pas vide, on a re√ßu quelque chose, on a donc cliqu√© sur une feature. Au contraire, si c‚Äôest vide, c‚Äôest qu‚Äôon a cliqu√© √† c√¥t√©. Testez la fonction avant de passer √† la suite.</p>
<p>Si on a bien r√©cup√©r√© une <code>feature</code>, cela veut dire qu‚Äôon peut r√©cup√©rer ses <code>properties</code>. Il suffit d‚Äôajouter au bon endroit de la fonction les deux lignes suivantes&nbsp;:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> properties <span class="op">=</span> obj<span class="op">.</span><span class="at">features</span>[<span class="dv">0</span>]<span class="op">.</span><span class="at">properties</span><span class="op">;</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(properties)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Vous commencez √† comprendre comment on acc√®de √† un √©l√©ment dans un objet JavaScript. Il suffit d‚Äôappeler la propri√©t√© qu‚Äôon veut avec <code>.&lt;propri√©t√©&gt;</code>. Regardez comment est structur√© votre objet <code>properties</code> dans la console du navigateur. Maintenant, modifiez la ligne <code>console.log(properties);</code> pour afficher la propri√©t√© <code>target_country</code>. Quand c‚Äôest r√©ussi, passez √† la suite&nbsp;!</p>
<p>Tr√®s bien, on sait maintenant r√©cup√©rer des propri√©t√©s. Il ne nous reste plus qu‚Äô√† modifier le HTML de notre document en cons√©quence en utilisant <code>.innerHTML</code>&nbsp;! Je vous donne le code pour la colonne <code>deal_id</code> et je vous laisse compl√©ter le code pour les deux autres colonnes.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (url) {</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fetch</span>(url)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">then</span>((response) <span class="kw">=&gt;</span> response<span class="op">.</span><span class="fu">text</span>())</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">then</span>((json) <span class="kw">=&gt;</span> {</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> obj <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">parse</span>(json)<span class="op">;</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (obj<span class="op">.</span><span class="at">features</span>[<span class="dv">0</span>]) {</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>          <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"J‚Äôai cliqu√© sur une feature&nbsp;!"</span>)<span class="op">;</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>          <span class="kw">const</span> properties <span class="op">=</span> obj<span class="op">.</span><span class="at">features</span>[<span class="dv">0</span>]<span class="op">.</span><span class="at">properties</span><span class="op">;</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>          <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(properties)<span class="op">;</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>          <span class="co">// On affiche deal_id dans notre table</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>          <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">'table-deal-id'</span>)<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> properties<span class="op">.</span><span class="at">deal_id</span><span class="op">;</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>          <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"J‚Äôai cliqu√© √† c√¥t√©‚Ä¶"</span>)<span class="op">;</span></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>          <span class="co">// On a cliqu√© "nulle part" donc on remet des ‚Ä¶ dans la colonne "deal_id"</span></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>          <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">'table-deal-id'</span>)<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>  }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Testez votre application. Normalement, √ßa marche&nbsp;! Quand vous cliquez sur une feature, vous devriez r√©cup√©rer son ID. Voil√† comment on cr√©e une table customis√©e pour interroger une couche&nbsp;! <strong>Maintenant, √† vous de compl√©ter les deux autres colonnes.</strong> Une fois que vous avez r√©ussi, ajoutez une colonne qui montre la valeur de <code>mineral_resources</code> pour le deal sur lequel vous cliquez. Et quand √ßa aussi √ßa fonctionne, prenez quelques minutes pour styliser votre table&nbsp;! Google est votre ami (et ok, pourquoi pas ChatGPT si vous y tenez vraiiiiment, √ßa ne me d√©range pas si c‚Äôest pour du CSS comme <code>&lt;table&gt;</code> commence √† √™tre complexe, mais on utilise l‚ÄôIA intelligemment svp).</p>
</section>
<section id="jai-fini-√ßa-aussi" class="level2">
<h2 class="anchored" data-anchor-id="jai-fini-√ßa-aussi">J‚Äôai fini √ßa aussi&nbsp;!</h2>
<p>Fantastique&nbsp;! Eh bien maintenant, d√©brouillez-vous pour ajouter une √©chelle √† votre carte. √áa devrait vous occuper un moment, j‚Äôesp√®re. Je vous donne √ßa, √† vous de le mettre au bon endroit&nbsp;:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ScaleLine <span class="im">from</span> <span class="st">'ol/control/ScaleLine.js'</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Un autre morceau, pour cr√©er l‚Äôobjet ‚Äú√©chelle‚Äù&nbsp;:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> scaleline <span class="op">=</span> <span class="kw">new</span> <span class="fu">ScaleLine</span>()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Et enfin, trouvez comment ajouter √ßa √† votre code existant&nbsp;:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> map <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>({</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">controls</span><span class="op">:</span> [scaleline]<span class="op">,</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Et voil√†&nbsp;!</p>
</section>
<section id="bon-ben-jai-aussi-une-√©chelle-sur-ma-carte" class="level2">
<h2 class="anchored" data-anchor-id="bon-ben-jai-aussi-une-√©chelle-sur-ma-carte">Bon, ben j‚Äôai AUSSI une √©chelle sur ma carte‚Ä¶</h2>
<p>Bravo&nbsp;! Vous pouvez r√©p√©ter <a href="#l√©tape-finale">L‚Äô√©tape finale&nbsp;!</a> pour build votre application. Ensuite, je vous conseille de commencer √† ajouter √† votre carte des √©l√©ments dont vous avez besoin pour vos projets GeoNum. Vous pourriez vouloir par exemple un curseur temporel, des tooltips, etc. Commencez par faire des recherches parmi les <a href="https://openlayers.org/en/latest/examples/">exemples d‚ÄôOpenLayers</a> mais aussi dans les extensions disponibles sur <a href="https://viglino.github.io/ol-ext/">ol-ext</a> histoire de faire un tour des possibilit√©s.</p>
<p>Et suivant le temps qu‚Äôon a, on peut √©ventuellement commencez √† regardez QGIS Server ensemble pendant le TP, sinon je vous ajouterai une petite note sur le site si jamais vous pr√©f√©rez l‚Äôutiliser pour vos projets. Quoi qu‚Äôil en soit, vous ne serez pas not√©s dessus&nbsp;!</p>
</section>
<section id="cette-fois-cest-vraiment-fini" class="level2">
<h2 class="anchored" data-anchor-id="cette-fois-cest-vraiment-fini">Cette fois, c‚Äôest vraiment fini&nbsp;!</h2>
<p>Merci pour votre attention&nbsp;!</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://media1.giphy.com/media/v1.Y2lkPTc5MGI3NjExMjlteWxjN3JjYzU4aXBmY3huODRxYmk4ZGg5MWdza216MDdhNzlyNyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/ZfK4cXKJTTay1Ava29/giphy.webp" class="img-fluid quarto-figure quarto-figure-center figure-img" alt="GIF : The Office Thank You"></p>
</figure>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/GradelerM">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://fr.linkedin.com/in/marie-gradeler">
      <i class="bi bi-linkedin" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>