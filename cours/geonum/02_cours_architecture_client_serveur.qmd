---
title: "Architecture web"
format: html
---

## Objectifs de la session

-   Comprendre comment fonctionne une architecture web basique
-   DÃ©ployer une architecture web de dÃ©veloppement en utilisant Docker

*DurÃ©eÂ : 1h*

## Supports

[CoursÂ : Architecture client-server](./02_diapos_architecture_client_serveur.qmd){target="_blank"}

## TP â€“ DÃ©ploiement de notre GeoServer

::: callout-important
Ce TP suppose que Git, NodeJS et Docker sont installÃ©s sur la machine. Il a Ã©tÃ© Ã©crit pour une machine Linux, certains chemins et lignes de commande peuvent donc Ãªtre diffÃ©rents sur une machine Windows ou Mac.
:::

### Avant de commencer

Avant de commencer, on doit vÃ©rifier que Git, NodeJS et Docker sont bien installÃ©s et Ã  jour.

#### Git

Ouvrez le terminal de votre choix (pour les utilisateurs Windows, je recommande Powershell) et tapez la commande suivanteÂ :

``` bash
git version
```

Vous devriez obtenir la rÃ©ponse suivanteÂ : `git version 2.43.0`

Si la version est plus ancienne, il faut la mettre Ã  jour. Si vous avez un message dâ€™erreur, git nâ€™est pas installÃ©. Dans les deux cas, rendez-vous sur la page dâ€™installation de git pour tÃ©lÃ©charger et installer la nouvelle versionÂ : [https://git-scm.com/install/windows](#0)

Vous pouvez vÃ©rifier que git est installÃ© et Ã  jour en re-tapant la commande `git version`.

*NoteÂ : il faut parfois redÃ©marrer lâ€™ordinateur pour quâ€™il reconnaisse bien lâ€™installation de Git.*

#### NodeJS

Dans le terminal, tapez la commande suivanteÂ :

``` bash
node -v
```

Vous devriez obtenir la rÃ©ponse suivanteÂ : `v24.11.1`

Si Node nâ€™est pas installÃ©â€¦ on peut essayer mais on a peu de chances dâ€™avoir les droits sur les ordis de la fac. VoilÃ  quand mÃªme le lien officielÂ : <https://nodejs.org/en/download>

Si Node est installÃ© mais la version trop ancienne, essayez la commande suivanteÂ :

``` bash
nvm install 24
```

Puis vÃ©rifier la mise Ã  jour avec la commande suivanteÂ :

``` bash
node -v
```

#### Docker

Pour vÃ©rifier que Docker est installÃ©, vous avez plusieurs optionsÂ : cherchez le logiciel "Docker Desktop" sur votre ordinateur ou bien tapez la commande suivanteÂ :

``` bash
docker run hello-world
```

*NoteÂ : si vous utilisez votre propre machine Linux, essayez `sudo`. Quoi quâ€™il en soit, il vaut mieux Ã©viter dâ€™utiliser Docker en tant que super utilisateur, rÃ©fÃ©rez-vous aux instructions post-installation officiellesÂ : <https://docs.docker.com/engine/install/linux-postinstall>*

Vous devriez obtenir dans votre terminal le message suivantÂ :

``` bash
Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 1. The Docker client contacted the Docker daemon.
 2. The Docker daemon pulled the "hello-world" image from the Docker Hub.
    (amd64)
 3. The Docker daemon created a new container from that image which runs the
    executable that produces the output you are currently reading.
 4. The Docker daemon streamed that output to the Docker client, which sent it
    to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
 $ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker ID:
 https://hub.docker.com/

For more examples and ideas, visit:
 https://docs.docker.com/get-started/
```

Si câ€™est le cas, docker est installÃ© est fonctionne. Sinonâ€¦ si vous Ãªtes sur les ordinateurs de la fac, on est fichus. On nâ€™a pas les droits pour lâ€™installer. Doncâ€¦ on croise les doigts ğŸ¤

### RÃ©cupÃ©ration du code sur GitHub

Rendez-vous sur le GitHub du projet pour rÃ©cupÃ©rer le codeÂ : <https://github.com/GradelerM/geonum_docker>

CrÃ©ez un dossier dans lequel vous voulez travailler. Il nous servira pour le cours de GeoServer et le cours dâ€™OpenLayers. Vous pouvez lâ€™appeler comme vous voulez, mais Ã©vitez les espaces et autres caractÃ¨res difficiles Ã  prendre en charge quand on doit dÃ©finir un chemin dâ€™accÃ¨s.

Ensuite, ouvrez ce dossier dans votre terminal (le clic droit devrait vous donner lâ€™option sous Linux comme Windows). VÃ©rfiez que le chemin pointe bien vers votre nom de dossier. Par exemple, si jâ€™ai crÃ©Ã© un dossier qui sâ€™appelle "Cours_Geoserver_Openlayers" dans Documents, le chemin doit ressembler Ã  Ã§aÂ : `~/Documents/Cours_Geoserver_Openlayers`

Quand câ€™est bon, on va utiliser Git pour cloner mon dÃ©pÃ´t. En langage courant, Ã§a veut dire quâ€™on utilise Git pour crÃ©er une copie de mon code sur votre ordinateur.

``` bash
git clone https://github.com/GradelerM/geonum_docker.git
```

VÃ©rifiez votre dossier. Vous devriez avec un nouveau rÃ©pertoire `geonum_docker`. Ouvrez ce rÃ©pertoire dans VSCode pour quâ€™on puisse regarder le code ensemble.

::: callout-important
## Point diapos sur le contenu du rÃ©pertoire
:::

### DÃ©ploiement de la *stack*

Maintenant quâ€™on a compris le contenu du fichier `docker_compose.yml`, on peut dÃ©ployer notre GeoServer et commencer Ã  lâ€™utiliser. Pour Ã§a, ouvrez un terminal dans VSCode et vÃ©rifiez que le chemin correspond bien au rÃ©pertoire quâ€™on vient de rÃ©cupÃ©rer. Si on reprend lâ€™exemple, prÃ©cÃ©dent, au lieu dâ€™avoir `~/Documents/Cours_Geoserver_Openlayers` vous devriez maintenant avoir `~/Documents/Cours_Geoserver_Openlayers/geonum_docker` . Câ€™est ce quâ€™on va appeler Ã  partir de maintenant la **racine** de notre projet.

Une fois que votre terminal est ouvert Ã  la racine de votre projet, taper la commande suivanteÂ :

``` bash
docker compose up -d
```

Cette commande demande Ã  Docker de lire notre recette de `docker_compose.yml` pour crÃ©er notre GeoServer (et une autre application web quâ€™on utilisera plus tard, mais pas aujourdâ€™hui).

Si vous avez Docker Desktop dâ€™installÃ©, vous pouvez lâ€™ouvrir pour vÃ©rifier quâ€™il se passe bien quelque chose.

**Si Ã§a prend du temps la premiÃ¨re fois, câ€™est normal.** Docker doit dâ€™abord aller rÃ©cupÃ©rer les "recettes" (images) en ligne pour GeoServer et Caddy (quâ€™on prÃ©sentera pendant les cours OpenLayers). Normalement, les prochaines fois, Ã§a ira vite.

Quand le container est prÃªt, rendez-vous sur <http://localhost:8080/geoserver/web/?0>. Si vous voyez lâ€™interface de GeoServer, hourraÂ ! On peut passer au prochain cours.

Sinon, appelez-moi, on va dÃ©bugger tout Ã§a ensemble.

## MÃ©mo

Dans cette section, jâ€™ajoute quelques Ã©lÃ©ments dâ€™aide Ã  la comprÃ©hension du cours comme des **explications supplÃ©mentaires** ou des **pistes pour aller plus loin**.

::: {.callout-note collapse="true"}
## Containers, images, servicesâ€¦

![](https://media3.giphy.com/media/v1.Y2lkPTc5MGI3NjExN2xjZWIxY3gxeXZlZXdqeGZ1b3d6ZDRoaWQ3amtjMmd1dmcxdGVndSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/WRQBXSCnEFJIuxktnw/giphy.webp){fig-alt="GIF: Confused math" fig-align="center"}

Pas de paniqueÂ ! On nâ€™a pas besoin de savoir exactement comment fonctionne Docker pour ce TP. Si on veut simplifierÂ :

-   Docker permet de faire tourner des **services** dans des **containers** crÃ©Ã©s Ã  partir dâ€™**images**.

-   Une **image** est une recette Ã  suivre pour crÃ©er mon container. Elle demande Ã  Docker de crÃ©er un container basÃ© sur Debian, dâ€™y installer GeoServer ou bien une base PostgreSQL avec lâ€™extension postGIS, etc.

-   Un **container** est le produit dâ€™une image. Câ€™est un peu le plat cuisinÃ© Ã  partir de la recette. Câ€™est Ã  lâ€™intÃ©rieur du container que tourne mon **service** comme ma base de donnÃ©es ou mon serveur web. On peut connecter plusieurs containers entre eux, pratique si on veut un site web et une base de donnÃ©es qui fonctionnent ensembleÂ !

-   Un **service** est gÃ©nÃ©ralement une base de donnÃ©es (ex. PostgreSQL), un serveur de site web (ex. Apache), un serveur cartographique (ex. GeoServer), etc. Comme les bonnes pratiques demandent dâ€™avoir un seul service par container, on va parler du "container GeoServer" pour dire "le container qui contient mon service GeoServer", Ã§a va plus vite.

Si ce nâ€™est encore pas clair et que Ã§a vous gÃªne pour la comprÃ©hension de la suite du TP, hop, on lÃ¨ve la main et on demande des explications, je suis lÃ  pour Ã§aÂ ! Et si vous voulez aller plus loin, rendez-vous sur la [documentation officelle de Docker](https://docs.docker.com/).
:::
