---
title: "OpenLayers & GeoServer"
subtitle: "Utiliser GeoServer et OpenLayers pour crÃ©er une cartographie web."
---

## Objectifs

-   Savoir ce que sont Node JS, OpenLayers et Docker.

-   Comprendre la diffÃ©rence entre une machine virtuelle et un container.

-   DÃ©ployer une stack de dÃ©veloppement avec un serveur GeoServer et un serveur Caddy pour servir une application sous Node JS en utilisant Docker Compose.

-   CrÃ©er une application OpenLayers avec Node JS.

-   Comprendre le contenu de lâ€™application de base de OpenLayers et oÃ¹ doit vivre mon code.

-   Apprendre Ã  utiliser la documentation et les exemples dâ€™OpenLayers pour ajouter des Ã©lÃ©ments Ã  ma carte.

-   Afficher des couches WMS dans une application OpenLayers.

## Cours - Le point technique

[SlidesÂ : Le point technique](./slides_le_point_technique.qmd){target="_blank"}

## TP - DÃ©marrage de la stack

![](https://media1.tenor.com/m/VKd0_h7LgkcAAAAd/asdfmovie-internet.gif){fig-alt="GIF : asdf movie I'm gonna do an internet" fig-align="center"}

::: callout-important
Ce TP suppose que Docker et Docker Compose sont installÃ©s sur la machine. Il a Ã©tÃ© Ã©crit pour une machine Linux, certains chemins et lignes de commande peuvent donc Ãªtre diffÃ©rents sur une machine Windows ou Mac.

Lâ€™Ã©diteur de code utilisÃ© pour lâ€™Ã©criture de ce TP est VSCode mais nâ€™importe quel autre Ã©diteur fait lâ€™affaire.
:::

### Initialiser mon dossier

Commencez par crÃ©er un nouveau dossier dans lequel nous allons dÃ©velopper notre app. Vous pouvez le mettre oÃ¹ vous voulez - par exemple dans `Mes Documents`. Jâ€™ai appelÃ© mon dossier `app_openlayers_geoserver` mais le nom importe peu.

Ouvez-ce dossier dans VSCode (par exemple avec un clic-droit \> Ouvrir avec VSCode). **Vous vous trouvez Ã  la racine du dossier.** Pour la suite du TP, Ã  chaque fois que jâ€™Ã©voquerais la **racine du projet**, il sâ€™agita de ce dossier.

CrÃ©ez un nouveau fichier et appelez-le `README.md`. Il sâ€™agit dâ€™un simple fichier texte au format markdown qui nous servira de mÃ©mo. Lâ€™application pourrait tout Ã  fait fonctionner sans.

Copiez dans `README.md` le texte suivant et sauvegardez le documentÂ :

``` md
Pour dÃ©marrer les containersÂ :
`docker compose up -d`

Pour arrÃªter les containersÂ :
`docker compose down`
```

Si jamais vous oubliez les commandes pour utiliser docker compose, vous pourrez les retrouver dans ce fichier.

Ensuite, toujours Ã  la racine du projet, crÃ©er un nouveau fichier et appelez-le `Caddyfile` (la majuscule est importanteÂ !). Collez le contenu suivant Ã  lâ€™intÃ©rieur et sauvegardez.

``` bash
:80 {
    root * /srv
    file_server
}
```

::: {.callout-note collapse="true"}
## Câ€™est quoi, ce CaddyfileÂ ?

Il sâ€™agit du fichier de configuration du serveur [Caddy](https://caddyserver.com/) que nous allons utiliser pour servir notre application OpenLayers. On aurait pu choisir dâ€™utiliser Apache ou Nginx, mais jâ€™aime bien Caddy, je le trouve plus clair Ã  prendre en main.

On lui indique simplement trois Ã©lÃ©mentsÂ :

-   On sert notre application sur le port `80` (le `localhost` par dÃ©faut). Il faudra donc aller sur `localhost` pour voir notre application OpenLayers.

-   Caddy doit chercher les fichiers de notre site web dans le dossier `/srv` (configuration par dÃ©faut).

-   Caddy sait quâ€™on va utiliser des fichiers statiques.
:::

### CrÃ©er (et comprendre) mon docker-compose.yml

Normalement, si vous avez bien suivi les Ã©tapes prÃ©cÃ©dentes, le contenu de votre dossier devrait ressembler Ã  Ã§aÂ :

```         
- Caddyfile
- README.md
```

Ã€ la racine du projet, crÃ©ez un nouveau fichier et appelez-le `docker-compose.yml`. Collez le contenu suivant dans ce fichier et sauvegardez.

``` yml
services:

  geoserver:
    container_name: geonum_geoserver
    image: docker.osgeo.org/geoserver:2.26.0
    environment:
      - RUN_UNPRIVILEGED=true
      - CHANGE_OWNERSHIP_ON_FOLDERS="/opt /opt/geoserver_data/ /mnt/geoserver_geodata"
      - CORS_ENABLED=true
      - SKIP_DEMO_DATA=true
    ports:
      - "8080:8080"
    volumes:
      - ./geoserver/opt:/opt/geoserver_data
  
  web:
    container_name: geonum_web
    image: caddy:latest
    ports:
      - "80:80"
    volumes:
      - ./Caddyfile:/etc/caddy/Caddyfile
      - ./app/dist/:/srv
```

::: {.callout-note collapse="true"}
## Et Ã§a, Ã§a veut dire quoiÂ ?

Si tout sâ€™est bien passÃ©, on a dÃ©jÃ  vu ensemble comment fonctionne le docker-compose.yml en cours, mais voici un petit rappelÂ :

-   on crÃ©e deux "services", qui sont en fait deux containers, un `geoserver` et un `web` .

-   pour chaque service, on indiqueÂ :

    -   le nom quâ€™on donne au container (pour Ã©viter les noms gÃ©nÃ©rÃ©s alÃ©atoirement comme lors du prÃ©cÃ©dent TP, qui ne sont pas super clairs)

    -   le nom de lâ€™image Docker (pour rappel, image = recette pour construire un container) quâ€™on souhaite utiliser

    -   les ports quâ€™on souhaite connecter, sous la forme `HOST_PORT:CONTAINER_PORT` . Exemple pour GeoServerÂ : je sais quâ€™il est toujours servi sur le port 8080, donc si jâ€™Ã©cris `3000:8080`, Ã§a veut dire que sur mon ordinateur je dois aller sur `localhost:3000` pour pouvoir regarder le port `8080` de mon container et voir mon GeoServer.\
        *Si ce nâ€™est pas clair et que Ã§a vous travaille de comprendre comment Ã§a fonctionne, on mâ€™appelleÂ !*

    -   des volumes dans lesquels on stocke de la donnÃ©e, ici on va connecter les volumes docker Ã  des dossier dans notre ordinateur (comme au TP prÃ©cÃ©dent) en utilisant la syntaxe `HOST_DIRECTORY:CONTAINER_DIRECTORY` . Pour reprendre lâ€™exemple de GeoServer, je sais que par dÃ©faut la donnÃ©e est stockÃ©e dans `/opt/geoserver_data/` dans le serveur. Je dis donc Ã  mon container de se connecter Ã  un dossier sur ma machine dans `$PWD/geoserver/opt` , un dossier qui sera crÃ©Ã© au premier lancement de la stack. Comme on lâ€™a expÃ©rimentÃ© au TP prÃ©cÃ©dent, **monter des volumes depuis les containers sur mon ordinateur** **est le moyen le plus simple dâ€™y transfÃ©rer de la donnÃ©e**. Ce nâ€™est pas toujours aussi simple dâ€™accÃ©der Ã  lâ€™intÃ©rieur dâ€™un serveur - câ€™est toute la puissance de Docker, et câ€™est pour Ã§a quâ€™on sâ€™en sertÂ !

Ce nâ€™est encore pas super clairÂ ? Attendez de commencer Ã  manipuler le TP, Ã§a viendra tout seul. Si câ€™est toujours flou au bout de quelques exercices, appelez-moi et on refait une explicationÂ !
:::

### Initialiser mon application OpenLayers

[Documentation OpenLayers](https://openlayers.org/doc/quickstart.html)

Avant de pouvoir lancer tous nos services, on doit encore crÃ©er notre application OpenLayers. Ouvrez un terminal Ã  la racine du projet. Vous avez deux optionsÂ :

-   la simpleÂ : ouvrez un Terminal dans votre editeur de Code (par exemple, dans VSCode, allez dans le menu en haut et cliquez sur "Terminal")

-   la moins simpleÂ : ouvez un terminal et dÃ©placez-vous jusquâ€™Ã  votre projet en utilisant la commande `cd /chemin/de/mon/projet`

Une fois que le terminal est ouvert dans le projet (vÃ©rifiez bien deux foisÂ !), tapez la commande suivante pour crÃ©er un projet OpenLayers quâ€™on appelle "app"Â :

``` bash
npm create ol-app app
```

::: {.callout-important collapse="true"}
## Jâ€™ai un message dâ€™erreur "could not find commit hash for HEAD"

Cela doit vouloir dire que git nâ€™est pas installÃ© sur la machine. Pour savoir comment installer Git pour Linux, Windows et MacOS, rendez-vous sur le site officiel de GitÂ : <https://git-scm.com/book/en/v2/Getting-Started-Installing-Git>

Pour gagner du temps, voilÃ  la page pour WindowsÂ : <https://git-scm.com/downloads/win>

Quand git est installÃ©, recommencez lâ€™Ã©tape prÃ©cÃ©dente. Si Ã§a ne fonctionne toujours pas, essayez deÂ :

-   fermer et ouvrir de nouveau VS Code

-   redÃ©marrer lâ€™ordinateur

Pour moi Ã§a a fonctionnÃ© dans la salle de TP ðŸ¤ž
:::

Vous devriez voir un nouveau dossier appelÃ© "app". Tapez la commande suivante pour vous "dÃ©placer" dans le dossier "app".

``` bash
cd app
```

On va dÃ©marrer notre application avec la commande suivanteÂ :

``` bash
npm start
```

Vous devriez avoir quelque chose comme Ã§a dans votre terminalÂ :

``` bash
  VITE v5.4.11  ready in 137 ms

  âžœ  Local:   http://localhost:5173/
  âžœ  Network: use --host to expose
  âžœ  press h + enter to show help
```

Super, le serveur de dÃ©veloppement de lâ€™application fonctionneÂ ! On va pouvoir y accÃ©der en entrant dans le navigateur lâ€™adresse indiquÃ©e dans `Local`. Allez-y et vÃ©rifiez que vous voyez bien une carte.

::: {.callout-note collapse="true"}
## Un serveur de dÃ©veloppementÂ ?

Comme on lâ€™a vu en cours, lâ€™un des intÃ©rÃªts de Node JS est quâ€™il permet dâ€™avoir un serveur de dÃ©veloppement pour servir notre application facilement et la mettre Ã  jour au fur et Ã  mesure des changements. Pour lancer ce serveur de dÃ©veloppement, on utilise la commande `npm start` depuis le dossier `app`.

Par contre, câ€™est un serveur de **dÃ©veloppement** et non pas de **production**. On apprendra donc pendant le dernier cours Ã  mettre en production une application - ce sera dans le rendu de votre Ã©valuation, mais pas de pression ðŸ˜ˆ
:::

Si vous voyez bien une carte, il ne reste que deux toutes petites Ã©tapes et on va enfin pouvoir passer Ã  la suite.

Dâ€™abord, quittez le serveur de dÃ©veloppement (`ctrl` + `c` dans le terminal). Tapez ensuite la commande suivanteÂ :

``` bash
npm run build
```

Node JS va crÃ©er un build, une version **pour la production** de notre site. Câ€™est ce build qui va Ãªtre servi par notre fameux serveur Caddy quâ€™on a vu dans le docker-compose.yml. Les fichiers de cette application se trouvent dans le dossier `./app/dist/`.

Pour vÃ©rifier que tout a fonctionnÃ©, tapez les commandes suivantes dans votre terminalÂ :

``` bash
cd ..
docker compose up
```

La premiÃ¨re commande permet de retourner Ã  la racine du projet. La seconde demande Ã  Docker de crÃ©er nos containers Ã  partir des instructions de docker-compose.yml. Le dÃ©marrage peut prendre un peu de temps, profitez-en pour vous reposer un peu le cerveau.

Quand câ€™est terminÃ©, le contenu de votre projet devrait ressembler Ã  Ã§aÂ :

```         
- app/
- geoserver/
- Caddyfile
- docker-compose.yml
- README.md
```

Si câ€™est le cas, il reste une derniÃ¨re chose Ã  vÃ©rifier.

-   allez sur <http://localhost/> et confirmez que vous voyez bien une carte

-   allez sur <http://localhost:8080/geoserver/> et confirmez que vous voyez bien une interface de GeoServer

Si tout est OK, fÃ©licitationsÂ ! Vous venez de crÃ©er une stack avec un serveur pour votre application en Node JS et un GeoServer.

![](https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExMW5scDl2dnd6eXltdHljMnR4YXg1YXA4Z2hvcHNzcG1qcDQ0dDR4MCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/g9582DNuQppxC/giphy.webp){fig-alt="GIF: Leonardo Di Caprio Champagne" fig-align="center"}

## Cours - Les bases dâ€™OpenLayers

[SlidesÂ : Les bases dâ€™OpenLayers](./slides_openlayers_td1.qmd){target="_blank"}

## TP - Cartographie web avec GeoServer et OpenLayers

### Importer la couche de lâ€™exemple OpenLayers

En vous basant sur lâ€™exemple OpenLayers "[Single Image WMS](https://openlayers.org/en/latest/examples/wms-image.html)", importez la couche de cet exemple dans votre application.

::: {.callout-note collapse="true"}
## Rappels pour dÃ©marrer mon application

-   Ouvrir le fichier du projet (si vous avez suivi le premier TP il devrait sâ€™appeler `app_openlayers_geoserver`) dans votre Ã©diteur de code, par exemple VS Code

-   Ouvrir un terminal et taper `cd app` pour vous dÃ©placer dans le dossier de votre application

-   Tapez `npm start` pour dÃ©marrer le serveur de dÃ©veloppement

-   Ouvrez le `localhost` indiquÃ© dans votre terminal pour voir votre application
:::

**Essayez un peu par vous-mÃªme avant de simplement copier-coller ma solution depuis les diaposÂ !** Nâ€™oubliez pas que tant que votre code fonctionne, câ€™est bon. Il nâ€™y a pas une seule et unique maniÃ¨re dâ€™Ã©crire votre application. Souvent, dans mes solutions, je vais Ã©crire du code un peu plus long que la moyenne pour bien dÃ©cortiquer ce quâ€™on fait avec OpenLayers. Plus on va avancer dans les TPs et plus vous devrez comparer votre code au mien plutÃ´t que copier-coller (on ne va sÃ»rement pas appeler toutes les variables pareil).

::: {.callout-note collapse="true"}
## Ma solution (code montrÃ© dans les diapos)

``` javascript
import './style.css';
import {Map, View} from 'ol';
import { ImageWMS } from 'ol/source';
import TileLayer from 'ol/layer/Tile';
import ImageLayer from 'ol/layer/Image';
import OSM from 'ol/source/OSM';

// Je sors la couche OSM de lâ€™objet Map pour la stocker dans une variable
const couche_osm = new TileLayer({ source: new OSM() });

// CrÃ©ation de la source et la couche
const ma_source = new ImageWMS({
  url: 'https://ahocevar.com/geoserver/wms',
  params: { 'LAYERS' : 'topp:states' },
  serverType: 'geoserver',
});

const ma_couche = new ImageLayer({
  source: ma_source,
});

// CrÃ©ation de lâ€™objet map avec appel de mes deux couches "couche_osm" et "ma_couche" dans layers
const map = new Map({
  target: 'map',
  layers: [ couche_osm, ma_couche ],
  view: new View({
    center: [0, 0],
    zoom: 2
  })
});
```
:::

Maintenant, modifiez le code pour crÃ©er directement `ma_couche` sans passer par une source `ma_source`. Pour rappel, voici le morceau de code que jâ€™avais mis dans mes diaposÂ :

``` javascript
const ma_couche = new ImageLayer({
  source: new ImageWMS({
    url: '<lien_vers_mon_serveur>',
    params: {'LAYERS': '<espace>:<couche>'},
    serverType: 'geoserver',
  }),
});
```

::: callout-tip
Attention Ã  la diffÃ©rence entre les virgules et les points-virgulesÂ !
:::

Pour cet exercice, pas de solution, Ã§a devrait couler de source. Si vous bloquez, appelez-moiÂ ! Je le dis et le re-dis, mais **on ne reste pas dans son coin Ã  sâ€™arracher les cheveux**. Câ€™est contre productif et en plus si on ne me demande pas de lâ€™aide je sers juste Ã  tourner en rond dans la salle. Câ€™est un peu ennuyeux.

Quand Ã§a fonctionne, on passe Ã  la suiteÂ !

### Importer une couche depuis mon GeoServer

**Commencez par vÃ©rifier que vos containers Docker tournent toujours.** Pour Ã§a, rendez-vous sur <http://localhost:8080/geoserver/> et vÃ©rifiez que vous voyez bien lâ€™interface de GeoServer. Sinon, dÃ©marrez la stack depuis Docker Desktop ou bien ouvrez un terminal Ã  la racine de votre projet et tapez `docker compose up`.

**On souhaite maintenant ajouter une couche OpenLayers depuis notre GeoServer.**

Vous avez une impression de dÃ©jÃ -vuÂ ? NormalÂ ! Si vous avez bien suivi le TP prÃ©cÃ©dent, ce sera un jeu dâ€™enfant pour vous. Si vous voulez retourner au TP pour Ãªtre guidÃ©s parce que vous avez un trou de mÃ©moire, câ€™est [par ici](./serveurs_carto.qmd). Pour vous aider, je vous remets ici quelques Ã©lÃ©mentsÂ :

-   Le jeu de donnÃ©es [land_matrix_mines](/data/land_matrix/land_matrix_mines.gpkg) Ã  tÃ©lÃ©charger

-   Le fichier de style SLD des couches Ã  copier ci-dessous (vous nâ€™Ãªtes pas obligÃ©s dâ€™utiliser ceux-ciÂ !)

::: {.callout-note collapse="true"}
## SLD pour "deals"

``` xml
<?xml version="1.0" encoding="UTF-8"?>
<StyledLayerDescriptor xmlns="http://www.opengis.net/sld" xmlns:se="http://www.opengis.net/se" xmlns:ogc="http://www.opengis.net/ogc" xsi:schemaLocation="http://www.opengis.net/sld http://schemas.opengis.net/sld/1.1.0/StyledLayerDescriptor.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1.0">
  <NamedLayer>
    <se:Name>gpkg_land_matrix â€” deals</se:Name>
    <UserStyle>
      <se:Name>gpkg_land_matrix â€” deals</se:Name>
      <se:FeatureTypeStyle>
        <se:Rule>
          <se:Name>Deal</se:Name>
          <se:PointSymbolizer>
            <se:Graphic>
              <se:Mark>
                <se:WellKnownName>circle</se:WellKnownName>
                <se:Fill>
                  <se:SvgParameter name="fill">#ffd157</se:SvgParameter>
                </se:Fill>
                <se:Stroke>
                  <se:SvgParameter name="stroke">#232323</se:SvgParameter>
                  <se:SvgParameter name="stroke-width">0.5</se:SvgParameter>
                </se:Stroke>
              </se:Mark>
              <se:Size>7</se:Size>
            </se:Graphic>
          </se:PointSymbolizer>
        </se:Rule>
      </se:FeatureTypeStyle>
    </UserStyle>
  </NamedLayer>
</StyledLayerDescriptor>
```
:::

::: {.callout-note collapse="true"}
## SLD pour "deals_by_country"

``` xml
<?xml version="1.0" encoding="UTF-8"?>
<StyledLayerDescriptor xmlns="http://www.opengis.net/sld" xmlns:se="http://www.opengis.net/se" xmlns:ogc="http://www.opengis.net/ogc" xsi:schemaLocation="http://www.opengis.net/sld http://schemas.opengis.net/sld/1.1.0/StyledLayerDescriptor.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1.0">
  <NamedLayer>
    <se:Name>gpkg_land_matrix â€” deals_by_country</se:Name>
    <UserStyle>
      <se:Name>gpkg_land_matrix â€” deals_by_country</se:Name>
      <se:FeatureTypeStyle>
        <se:Rule>
          <se:Name>Single symbol</se:Name>
          <se:PolygonSymbolizer>
            <se:Fill>
              <se:SvgParameter name="fill">#fdbf6f</se:SvgParameter>
              <se:SvgParameter name="fill-opacity">0.35</se:SvgParameter>
            </se:Fill>
            <se:Stroke>
              <se:SvgParameter name="stroke">#232323</se:SvgParameter>
              <se:SvgParameter name="stroke-width">1</se:SvgParameter>
              <se:SvgParameter name="stroke-linejoin">bevel</se:SvgParameter>
            </se:Stroke>
          </se:PolygonSymbolizer>
        </se:Rule>
      </se:FeatureTypeStyle>
    </UserStyle>
  </NamedLayer>
</StyledLayerDescriptor>
```
:::

::: {.callout-note collapse="true"}
## SLD pour "deals_by_country_centroid"

``` xml
<?xml version="1.0" encoding="UTF-8"?>
<StyledLayerDescriptor xmlns="http://www.opengis.net/sld" xmlns:se="http://www.opengis.net/se" xmlns:ogc="http://www.opengis.net/ogc" xsi:schemaLocation="http://www.opengis.net/sld http://schemas.opengis.net/sld/1.1.0/StyledLayerDescriptor.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1.0">
  <NamedLayer>
    <se:Name>gpkg_land_matrix â€” deals_by_country_centroid</se:Name>
    <UserStyle>
      <se:Name>gpkg_land_matrix â€” deals_by_country_centroid</se:Name>
      <se:FeatureTypeStyle>
        <se:Rule>
          <se:Name>201 - 5466</se:Name>
          <se:Description>
            <se:Title>201 - 5466</se:Title>
          </se:Description>
          <ogc:Filter xmlns:ogc="http://www.opengis.net/ogc">
            <ogc:And>
              <ogc:PropertyIsGreaterThanOrEqualTo>
                <ogc:PropertyName>suface_ha</ogc:PropertyName>
                <ogc:Literal>200.81000000000000227</ogc:Literal>
              </ogc:PropertyIsGreaterThanOrEqualTo>
              <ogc:PropertyIsLessThanOrEqualTo>
                <ogc:PropertyName>suface_ha</ogc:PropertyName>
                <ogc:Literal>5466.3999999999996362</ogc:Literal>
              </ogc:PropertyIsLessThanOrEqualTo>
            </ogc:And>
          </ogc:Filter>
          <se:PointSymbolizer>
            <se:Graphic>
              <se:Mark>
                <se:WellKnownName>circle</se:WellKnownName>
                <se:Fill>
                  <se:SvgParameter name="fill">#e5b636</se:SvgParameter>
                </se:Fill>
                <se:Stroke>
                  <se:SvgParameter name="stroke">#232323</se:SvgParameter>
                  <se:SvgParameter name="stroke-width">0.5</se:SvgParameter>
                </se:Stroke>
              </se:Mark>
              <se:Size>4</se:Size>
            </se:Graphic>
          </se:PointSymbolizer>
        </se:Rule>
        <se:Rule>
          <se:Name>5466 - 20413</se:Name>
          <se:Description>
            <se:Title>5466 - 20413</se:Title>
          </se:Description>
          <ogc:Filter xmlns:ogc="http://www.opengis.net/ogc">
            <ogc:And>
              <ogc:PropertyIsGreaterThan>
                <ogc:PropertyName>suface_ha</ogc:PropertyName>
                <ogc:Literal>5466.3999999999996362</ogc:Literal>
              </ogc:PropertyIsGreaterThan>
              <ogc:PropertyIsLessThanOrEqualTo>
                <ogc:PropertyName>suface_ha</ogc:PropertyName>
                <ogc:Literal>20412.80000000001018634</ogc:Literal>
              </ogc:PropertyIsLessThanOrEqualTo>
            </ogc:And>
          </ogc:Filter>
          <se:PointSymbolizer>
            <se:Graphic>
              <se:Mark>
                <se:WellKnownName>circle</se:WellKnownName>
                <se:Fill>
                  <se:SvgParameter name="fill">#e5b636</se:SvgParameter>
                </se:Fill>
                <se:Stroke>
                  <se:SvgParameter name="stroke">#232323</se:SvgParameter>
                  <se:SvgParameter name="stroke-width">0.5</se:SvgParameter>
                </se:Stroke>
              </se:Mark>
              <se:Size>10</se:Size>
            </se:Graphic>
          </se:PointSymbolizer>
        </se:Rule>
        <se:Rule>
          <se:Name>20413 - 61376</se:Name>
          <se:Description>
            <se:Title>20413 - 61376</se:Title>
          </se:Description>
          <ogc:Filter xmlns:ogc="http://www.opengis.net/ogc">
            <ogc:And>
              <ogc:PropertyIsGreaterThan>
                <ogc:PropertyName>suface_ha</ogc:PropertyName>
                <ogc:Literal>20412.80000000001018634</ogc:Literal>
              </ogc:PropertyIsGreaterThan>
              <ogc:PropertyIsLessThanOrEqualTo>
                <ogc:PropertyName>suface_ha</ogc:PropertyName>
                <ogc:Literal>61375.88199999996868428</ogc:Literal>
              </ogc:PropertyIsLessThanOrEqualTo>
            </ogc:And>
          </ogc:Filter>
          <se:PointSymbolizer>
            <se:Graphic>
              <se:Mark>
                <se:WellKnownName>circle</se:WellKnownName>
                <se:Fill>
                  <se:SvgParameter name="fill">#e5b636</se:SvgParameter>
                </se:Fill>
                <se:Stroke>
                  <se:SvgParameter name="stroke">#232323</se:SvgParameter>
                  <se:SvgParameter name="stroke-width">0.5</se:SvgParameter>
                </se:Stroke>
              </se:Mark>
              <se:Size>16</se:Size>
            </se:Graphic>
          </se:PointSymbolizer>
        </se:Rule>
        <se:Rule>
          <se:Name>61376 - 160220</se:Name>
          <se:Description>
            <se:Title>61376 - 160220</se:Title>
          </se:Description>
          <ogc:Filter xmlns:ogc="http://www.opengis.net/ogc">
            <ogc:And>
              <ogc:PropertyIsGreaterThan>
                <ogc:PropertyName>suface_ha</ogc:PropertyName>
                <ogc:Literal>61375.88199999996868428</ogc:Literal>
              </ogc:PropertyIsGreaterThan>
              <ogc:PropertyIsLessThanOrEqualTo>
                <ogc:PropertyName>suface_ha</ogc:PropertyName>
                <ogc:Literal>160220.00000000005820766</ogc:Literal>
              </ogc:PropertyIsLessThanOrEqualTo>
            </ogc:And>
          </ogc:Filter>
          <se:PointSymbolizer>
            <se:Graphic>
              <se:Mark>
                <se:WellKnownName>circle</se:WellKnownName>
                <se:Fill>
                  <se:SvgParameter name="fill">#e5b636</se:SvgParameter>
                </se:Fill>
                <se:Stroke>
                  <se:SvgParameter name="stroke">#232323</se:SvgParameter>
                  <se:SvgParameter name="stroke-width">0.5</se:SvgParameter>
                </se:Stroke>
              </se:Mark>
              <se:Size>22</se:Size>
            </se:Graphic>
          </se:PointSymbolizer>
        </se:Rule>
        <se:Rule>
          <se:Name>160220 - 1509612</se:Name>
          <se:Description>
            <se:Title>160220 - 1509612</se:Title>
          </se:Description>
          <ogc:Filter xmlns:ogc="http://www.opengis.net/ogc">
            <ogc:And>
              <ogc:PropertyIsGreaterThan>
                <ogc:PropertyName>suface_ha</ogc:PropertyName>
                <ogc:Literal>160220.00000000005820766</ogc:Literal>
              </ogc:PropertyIsGreaterThan>
              <ogc:PropertyIsLessThanOrEqualTo>
                <ogc:PropertyName>suface_ha</ogc:PropertyName>
                <ogc:Literal>1509612</ogc:Literal>
              </ogc:PropertyIsLessThanOrEqualTo>
            </ogc:And>
          </ogc:Filter>
          <se:PointSymbolizer>
            <se:Graphic>
              <se:Mark>
                <se:WellKnownName>circle</se:WellKnownName>
                <se:Fill>
                  <se:SvgParameter name="fill">#e5b636</se:SvgParameter>
                </se:Fill>
                <se:Stroke>
                  <se:SvgParameter name="stroke">#232323</se:SvgParameter>
                  <se:SvgParameter name="stroke-width">0.5</se:SvgParameter>
                </se:Stroke>
              </se:Mark>
              <se:Size>29</se:Size>
            </se:Graphic>
          </se:PointSymbolizer>
        </se:Rule>
      </se:FeatureTypeStyle>
    </UserStyle>
  </NamedLayer>
</StyledLayerDescriptor>
```
:::

Une fois que vos couches sont (Ã  nouveau) importÃ©es dans votre GeoServer et que vous parvenez Ã  les visualiser correctement, **importez la couche "deals" dans votre application OpenLayers.** Il doit sâ€™agir dâ€™une **nouvelle couche**Â : ne remplacez pas celle de lâ€™exemple que nous venons dâ€™afficherÂ ! En utilisant le TP prÃ©cÃ©dent et ce quâ€™on vient de voir, vous ne devriez pas avoir trop de difficultÃ©s.

Pour rappel, vous pouvez ouvrir lâ€™outil de dÃ©veloppement de votre navigateur avec la touche `F12` et vous verrez les messages dâ€™erreur dans lâ€™onglet `Console`. Câ€™est eux qui vous diront ce qui ne va pas dans le codeÂ !

Au besoin, vous pouvez utiliser une fusÃ©e de dÃ©tresse, mais comme pour les vraies, câ€™est mieux de les allumer **quand on en a besoin** et pas juste parce quâ€™on est curieux.

::: {.callout-important collapse="true"}
## FusÃ©e de dÃ©tresse : comment trouver lâ€™url qui pointe vers mon service wmsÂ ?

![](https://media1.tenor.com/m/nuBTC0Fcb0kAAAAC/periculum-harry-potter.gif){fig-alt="GIF: Harry Potter flare" fig-align="center" width="593"}

-   PrÃ©visualisez votre couche dans GeoServer

-   Copiez lâ€™URL qui est dans la barre de votre navigateur

-   Supprimez tout ce qui est aprÃ¨s le "?" et votre URL devrait se terminer par "wms", par exempleÂ : "[http://localhost/geoserver/land_matrix/wms](http://localhost/geoserver/land_matrix/wms')"
:::

::: {.callout-important collapse="true"}
## FusÃ©e de dÃ©tresseÂ : comment trouver le nom de mon espace et de ma coucheÂ ?

![](https://media1.tenor.com/m/YpGQDIBC5YYAAAAd/arcane-jinx.gif){fig-alt="GIF : Arcane Jinx flare" fig-align="center"}

-   Allez dans "Couches" ou "PrÃ©visualisation de la couche" dans GeoServer

-   Trouvez votre couche dans la liste et regardez la colonne "Nom"

-   La premiÃ¨re partie du nom (avant les ":") correspond Ã  lâ€™espace et la seconde partie au nom de la couche, par exempleÂ : "land_matrix:deals"
:::

::: {.callout-important collapse="true"}
## FusÃ©e de dÃ©tresseÂ : Jâ€™ai crÃ©Ã© ma couche mais elle nâ€™apparaÃ®t pas sur la carte

![](https://media1.giphy.com/media/v1.Y2lkPTc5MGI3NjExbmI3cTV3ODN2ZmRhbTM4MDc1M2dobTRiaTl2Y2w2Z2I5Y3hsbXNvZiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/AsfJT1vNXYyBWlPe4S/giphy.webp){fig-alt="GIF: Monster Hunter Wild flare" fig-align="center"}

Vous pensez avoir bien crÃ©Ã© votre source `ImageWMS` et votre couche `ImageLayer` mais il nâ€™y a rien sur la carte et pas de message dâ€™erreurÂ ?

VÃ©rifiez que vous avez bien ajoutÃ© votre couche dans la propriÃ©tÃ© `layers:` de votre objet `map`Â ! Pour rappel, pour ajouter un Ã©lÃ©ment Ã  un tableau ("*array*") en JavaScript, il faut sÃ©parer ces Ã©lÃ©ments par des virgules.
:::

Si vous avez atteint cette ligne, bravoÂ ! **Si vous coincez, appelez-moi.** Il faudrait que tout le monde parvienne Ã  atteindre au moins cette Ã©tape avant la fin du TP.

Sâ€™il aprÃ¨s Ã§a vous reste un peu de temps, ajoutez les couches "deals_by_country" et "deals_by_country_centroid" Ã  la carte.

### Je suis en avanceÂ !

Pas de panique, on nâ€™a pas le temps de sâ€™ennuyer iciÂ ! On va faire un peu de HTML et de CSS. Trouvez comment gagner de lâ€™espace en haut de la page web pour ajouter un titre (avec la balise `<h1>`) et donnez un joli nom Ã  votre pageÂ !

Si vous avez encore un peu de temps, expÃ©rimentez avec le style de la carte. Vous pouvez arrondir les coins, changer la police du titre, ou pourquoi pas commencer Ã  dÃ©gager une zone pour mettre la lÃ©gende et les options dâ€™affichage des couches.

Vous pourriez aussi relire votre code JavaScript. Est-ce que certaines informations se rÃ©pÃ¨tent, est-ce que vous pourriez les mettre dans des variablesÂ ?

## Câ€™est fini pour aujourdâ€™huiÂ !

**Merci Ã  vous dâ€™avoir tenu le coup, je sais que câ€™Ã©tait dense.** Pendant les deux premiers cours, on a appris tout ce quâ€™il nous fallait pour les prochaines sÃ©ances. Maintenant, adieu la thÃ©orie, on va pouvoir passer Ã  la pratique et ENFIN pouvoir enrichir notre super carte interactiveÂ !

![](media/jojo_to_be_continued.png){fig-alt="Jojo's to be continued" fig-align="center"}
