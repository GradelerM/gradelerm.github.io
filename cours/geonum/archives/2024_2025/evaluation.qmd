---
title: "Ã‰valuation"
subtitle: "ModalitÃ©s dâ€™Ã©valuation pour le cours GeoServer + OpenLayers, ou comment faire une super appli carto en binÃ´me."
---

::: callout-tip
Les consignes suivantes sâ€™adressent Ã  la promo du M2 GeoNum 2024-2025.
:::

## Consignes

![](https://media1.giphy.com/media/v1.Y2lkPTc5MGI3NjExN2lrb3g4NGV5Y3l2ejMxZXp3dnM1OHUzZmtiZHpqaHI1NW13anZ2ciZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/NQ1YNmyVdaFH8KK6zu/giphy.webp){fig-alt="GIF : Miguel et Tulio ont peur des consignes" fig-align="center"}

-   Le rendu se fait seul ou en **binÃ´me**, mais pas plusÂ !

-   Le dÃ©tail de tout ce que vous avez Ã  mâ€™envoyer se trouve dans la section [Ã€ rendre](#Ã -rendre).

-   Je vous demande quelques nouveaux Ã©lÃ©ments (normal, on ne va pas juste faire un copier-coller du TP) mais **TOUT peut Ãªtre fait en se basant sur le code que vous avez dÃ©jÃ **. Si je vous demande de crÃ©er des "radio buttons" quelque part, souvenez-vous quâ€™on avait dÃ©jÃ  des "radio buttons" pour dâ€™autres fonctionnalitÃ©s dans lâ€™application. Il suffit dâ€™appliquer la mÃªme mÃ©thode que celle quâ€™on a vue ensemble. Je vous ai mis quelques snippets de code lÃ  oÃ¹ je jugeais un coup de pouce nÃ©cessaire.

-   Vous pouvez utiliser Chat-GPT pour vous aiguiller mais pensez Ã  bien retravailler le code et ne pas juste accepter ce quâ€™il vous donne Ã  manger sans broncher. Si la structure de votre code est trÃ¨s diffÃ©rence de celle du TP et me paraÃ®t un peu trop "propre", je le saurai ğŸ˜‰

-   Attention, il y a peu de texte. Jâ€™attends donc que vous preniez le temps de vous relire et que vous Ã©vitiez les fautes au maximum (et ce mÃªme si moi jâ€™ai laissÃ© des fautes de frappe dans mon TP, oui oui, faites ce que je dis pas ce que je fais). Chat-GPT peut aussi vous aider pour Ã§a, Ã©videmment.

-   Je prends en compte dans lâ€™Ã©valuation **lâ€™indentation du code ainsi que les commentaires**. Faites en sorte de me donner un code propre et facile Ã  lireÂ !

-   Au sujet du nom des variables / constantesÂ : je les prÃ©fÃ¨re en camelCase mais comme jâ€™ai fait un peu des deux dans le TP je ne vous pÃ©naliserai pas si vous les Ã©crivez en snake_case. Vous ne serez pas non plus pÃ©nalisÃ©s si vous dÃ©clarez des variables lÃ  oÃ¹ on pourrait dÃ©clarer une constante. **Par contre, vous serez pÃ©nalisÃ©s si vous leur donnez des noms incomprÃ©hensibles** et que jâ€™ai besoin de dÃ©chiffrer tout votre code pour comprendre Ã  quoi sert telle ou telle variable / constanteÂ !

-   **Je ne vous pÃ©naliserai pas pour du code redondant.** On nâ€™en est pas Ã  ce niveau dâ€™optimisation. Au contraire, si je vois des Ã©tapes bien dÃ©taillÃ©es (et donc pas forcÃ©ment trÃ¨s optimisÃ©es), je me dirais que vous avez plutÃ´t fait Ã§a vous-mÃªme et que vous avez bien compris votre code.

-   Vous verrez que je donne surtout des consignes pour vous guider sur lâ€™ajout de HTML et JS, mais pas beaucoup en CSS. Vous Ãªtes libres de styliser votre application comme vous le voulez, je vous demande simplement de **ne pas vous en tenir au minimum vital** et de faire un petit effort sur les visuels. Ã‡a me montrera Ã  la fois que vous nâ€™en avez pas rien Ã  faire de lâ€™Ã©valuation (ou alors que vous faites des efforts pour me faire croire le contraire) et Ã§a fera du bien Ã  ma rÃ©tine.

-   Faire tout ce qui se trouve dans la section **ce qui est demandÃ©** ne suffit pas Ã  avoir la note maximale, mÃªme si Ã§a permet dâ€™atteindre une trÃ¨s bonne note quand mÃªmeÂ ! Si vous vous en sentez capable, poussez votre application plus loin en suivant la section "aller plus loin" et montrez moi quâ€™en plus dâ€™adapter du code existant, vous arrivez Ã  rajouter de nouveaux Ã©lÃ©ments.

## Ma carte finale {data-link="Ma carte finale"}

![](https://media1.giphy.com/media/v1.Y2lkPTc5MGI3NjExNXF2anZ3dXdpZXFmMXU3dzdud2w4MjMxdHU3Nzg1eWozenFvcnphYyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/1mgpw7QGirOAmHurZY/200.webp){fig-alt="GIF : Miguel et Tulio lisent une carte" fig-align="center"}

Pour vous guider, voici deux captures dâ€™Ã©cran de ma carte Ã  la fin de la prÃ©paration du TP. Notez que je nâ€™ai pas ajoutÃ© mon nom, mais le votre devra apparaÃ®tre quelque partÂ !

![](media/eval_result_3.png){fig-alt="Capture dâ€™Ã©cran de ma carte, 1" fig-align="center"}

![](media/eval_result_4.png){fig-alt="Capture dâ€™Ã©cran de ma carte, 2" fig-align="center"}

Vous verrez que certains Ã©lÃ©ments sont demandÃ©s dans la section [Aller plus loin] et ne figureront donc pas nÃ©cessairement sur votre carte (mais vous en Ãªtes tous capables, promis).

Allez, câ€™est Ã  vousÂ !

![](https://media1.tenor.com/m/aT7kl0dCEjcAAAAd/you-drank.gif){fig-alt="GIF : Tulio et Miguel, et encore une carte" fig-align="center" width="400"}

## Ce qui est demandÃ©

::: callout-important
## Attention

Pour les instructions du rendu dâ€™Ã©valuation, toutes les couches de donnÃ©es ici proviennent bien du jeu de donnÃ©es Land Matrix Agri de lâ€™Ã©valuation et non pas du jeu Land Matrix Mines utilisÃ© pour rÃ©aliser les TP.

**Les couches Land Matrix Mines ne seront pas prises en compte dans lâ€™Ã©valuation** et nâ€™ont mÃªme pas besoin de figurer dans votre GeoServer. Si vous le souhaitez, vous pouvez les supprimer.
:::

::: callout-tip
## Infos additionnelles

-   Vous pouvez **toujours** aller plus loin que ce que je demande, vous ne serez jamais pÃ©nalisÃ©s pour avoir fait quelque chose de mieux que ce qui est demandÃ©. Si je demande de crÃ©er un menu pour filtrer une couche selon deux paramÃ¨tres, vous pouvez filtrer selon tous les paramÃ¨tres. Si je demande des boutons radio mais que dans votre interface vous trouvez un menu de type dropdown plus logique, Ã§a me va aussi.

-   **Vous pouvez styliser la carte comme vous le voulez, du moment que vous respectez les rÃ¨gles basiques de sÃ©miologie graphique.** Si le orange "Land Matrix" nâ€™est pas votre truc, que vous prÃ©fÃ©rez utiliser des triangles ou des pictogrammes plutÃ´t que des points, pas de problÃ¨me. Vous nâ€™aimez pas les menus avec des coins arrondisÂ ? Vous voulez plutÃ´t faire une application en "mode sombre" avec un fond noir et du texte blancÂ ? Allez-yÂ ! Lâ€™important, câ€™est dâ€™Ãªtre fiers de votre rendu. Câ€™est aussi plus intÃ©ressant pour moi de ne pas voir dix fois le mÃªme rendu mais des applications avec un peu de personnalitÃ©.
:::

### Architecture web

Je ne vous demande rien de plus que ce quâ€™on a vu en TP. Vous nâ€™Ãªtes pas Ã©valuÃ© sur Docker, vous pouvez donc reprendre lâ€™architecture serveur crÃ©Ã©e ensemble. Nâ€™oubliez pas de mâ€™envoyer vos fichiers `docker-compose.yml` et `Caddyfile`, surtout si vous les avez modifiÃ©sÂ ! Je vous ai mis la liste de tous les fichiers Ã  mâ€™envoyer en bas de la page.

### GeoServer

Votre instance de GeoServer doit comprendreÂ :

-   Un espace de travail qui contient la donnÃ©e [Land Matrix Agri](/data/land_matrix/gpkg_land_matrix_agri.gpkg) (cliquez pour tÃ©lÃ©charger le jeu de donnÃ©es).

-   Toutes les couches du jeu de donnÃ©es publiÃ©es et requÃªtables dans la prÃ©visualisation type "OpenLayers" de GeoServer.

-   Les couches de la donnÃ©e `deals` et `deals_by_country` doivent Ãªtre stylisÃ©es. Vous nâ€™Ãªtes pas obligÃ©s de respecter lâ€™exemple (voir [Ma carte finale]) mais attention Ã  la sÃ©mio quand mÃªme.

### OpenLayers - base

Lâ€™application doit contenir Ã  minimaÂ :

-   Une carte (qui prend ou non toute la taille de lâ€™Ã©cran, Ã  vous de dÃ©cider).

-   Un fond de carte au choix.

-   La couche `deals` affichÃ©e en passant par un flux WMS (points simples).

-   La couche `deals_by_country` affichÃ©e en passant par un flux WMS (polygones simples).

-   La couche `deals_by_country_centroids` affichÃ©e en passant par un flux WFS (cercles proportionnels en fonction du nombre de deals, AVEC UNE TAILLE RAISONNABLE).

-   La couche `deals_by_country` doit Ãªtre en-dessous des autres. Pour rappel, OpenLayers ajoute les couches sur la carte dans lâ€™ordre dans lequel vous les ajoutez Ã  votre objet `map`. La derniÃ¨re couche est donc au-dessus des autres.

-   Un titre (oÃ¹ vous voulez sur la page).

-   Votre ou vos noms (oÃ¹ vous voulez sur la page).

Vous pouvez strcturer le reste de votre page web comme vous le voulez tant quâ€™elle contient tous les Ã©lÃ©ments demandÃ©s ensuite.

### Menu dâ€™affichage des couches

CrÃ©ez un menu dâ€™affichage de couches qui doit contenirÂ :

-   Une "checkbox" qui permet dâ€™afficher / masquer la couche `deals_by_country`.

-   Un groupe de deux "radio buttons" qui permet dâ€™afficher SOIT la couche `deals` SOIT la couche `deals_by_country` (on ne doit pas pouvoir afficher les deux couches en mÃªme temps).

::: callout-important
## Attention

On ne demande pas dâ€™afficher le tableau au format HTML gÃ©nÃ©rÃ© par GeoServer mais bien de rÃ©cupÃ©rer un objet au format JSON et de lâ€™afficher dans le tableau que vous avez crÃ©Ã©.
:::

### Filtrage

CrÃ©ez un menu de filtrage avec des "radio buttons" qui permettent de filtrer la couche `deals` en fonction des types de production "Oil Palm", "Soya Beans" et un autre au choix. Nâ€™oubliez pas lâ€™option pour afficher tous les deals sans filtrage.

::: callout-tip
Il sâ€™agit de la mÃªme chose que pour Land Matrix Mines mais au lieu de filtrer par "Gold", "Silver", etc. vous filtrez par des Ã©lÃ©ments comme "Oil Palm", etc.
:::

### RequÃªtes

CrÃ©ez oÃ¹ vous le souhaitez un tableau dâ€™affichage des attributsÂ :

-   Le tableau comprend les colonnes "Deal ID", "Creation date", "Country" et "Crops".

-   Cliquer sur un point de la couche `deals` remplit la ligne du tableau avec les attributs du point.

-   Cliquer ailleurs sur la carte vide la ligne du tableau (ou la remplit avec des "â€¦").

### LÃ©gende

Affichez la lÃ©gende des deux couches WMS quelque part dans votre interface. Le code dâ€™affichage de la lÃ©gende Ã©tait prÃ©sent dans le document `.html` du tout premier TP. Je vous conseille de regarder ce code ou lâ€™exemple officiel dâ€™OpenLayers, et je vous guide un peu pour rÃ©diger une version plus simple (parce que souvent, lâ€™exemple officiel en fait un peu trop)Â :

-   Vous devez crÃ©er quelque part dans votre interface une balise `<img>`. Câ€™est elle qui contiendra lâ€™image de la lÃ©gende.

-   Vous avez besoin de rÃ©cupÃ©rer la rÃ©solution de la carte pour pouvoir demander la lÃ©gende Ã  GeoServer. Si votre objet sâ€™appelle `map`, câ€™est comme Ã§a quâ€™il faut vous y prendreÂ :

    ``` javascript
    const resolution = map.getView().getResolution();
    ```

-   Vous devez ensuite rÃ©cupÃ©rer lâ€™URL de lâ€™image de la lÃ©gende. Câ€™est ce que `<img>` a besoin de lire pour afficher lâ€™image dans lâ€™interface. En imaginant que la source de ma couche sâ€™appelle `source` et que jâ€™ai bien stockÃ© la rÃ©solution de ma carte dans `resolution` Â :

    ``` javascript
    const url = source.getLegendUrl(initResolution);
    ```

-   Pour dÃ©finir la source `src` dâ€™un tag `<img>` dont lâ€™id est "legend", on sâ€™y prend de la maniÃ¨re suivanteÂ :

    ``` javascript
    document.getElementById('legend').src = url;
    ```

Avec ces Ã©lÃ©ments, il est facile dâ€™afficher une lÃ©gende sur sa carteÂ !

### Ã‰chelle

Affichez une Ã©chelle dans votre applicationÂ ! La solution est quelque part dans un des TPs donc je nâ€™en dis pas plus ici.

::: callout-tip
Inutile de reproduire lâ€™exemple officiel dâ€™OpenLayers qui est super complexe, beaucoup trop pour notre carte. Vraiment, jâ€™insiste, il y a la rÃ©ponse dans un des TPs.
:::

## Aller plus loin

![](https://media1.giphy.com/media/v1.Y2lkPTc5MGI3NjExb3A2Mm81d2gxeGtteXpwZXdya3F3OGw4N3Jha21hNG54bXQxNjJ5YSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/taU6RaT2Aaxt6/giphy.webp){fig-alt="GIF : Miguel avec une carte" fig-align="center"}

Si vous avez tout fait jusquâ€™ici, bien jouÃ©, votre application contient le minimum attendu pour lâ€™Ã©valuation. Vous avez donc bien compris les bases de GeoServer et OpenLayers et vous avez tous les outils pour faire une carte basique.

Cependant, pour permettre de valoriser les Ã©tudiants qui sont suffisamment Ã  lâ€™aise pour ajouter de nouvelles features Ã  leur carte et pas "seulement" adapter du code existant, vous ne serez pas notÃ©s sur la note maximale si vous nâ€™ajoutez pas les Ã©lÃ©ments suivants.

### Deals et son contexte

Masquez le menu de filtrage et dâ€™affichage des attributs de `deals` lorsque la couche nâ€™est pas affichÃ©e. Je vous donne un indice en vous montrant comment ajouter du style CSS Ã  un Ã©lÃ©ment HTML depuis du code JavaScriptÂ :

``` javascript
// Je souhaite afficher mon Ã©lÃ©ment "element"
document.getElementById('element').setAttribute('style', 'visibility:visible');

// Je souhaite masquer mon Ã©lÃ©ment "element"
document.getElementById('element').setAttribute('style', 'visibility:hidden');
```

Bien sÃ»r, vous pouvez jouer avec dâ€™autres attributs que "visibility" si besoin.

### LÃ©gende pour la couche WFS

Il manque une lÃ©gende pour notre couche WFS. Comme on dÃ©finit un style en JavaScript, on va devoir "dessiner" nous-mÃªme notre lÃ©gende avec des cercles proportionnels. Comme câ€™est un exercice bonus je ne vais pas vous guider pas Ã  pas, mais voici tout de mÃªme quelques Ã©lÃ©ments pour vous guider.

::: {.callout-tip collapse="true"}
## Ã‰crire mon HTML

Vous devez commencer, comme toujours, par crÃ©er vos Ã©lÃ©ments en HTML. Ici, il vous faudra au minimum une `<div>` pour contenir tout le reste de votre lÃ©gende, et Ã  lâ€™intÃ©rieur une nouvelle `<div>` par cercle que vous souhaitez afficher. Par exemple, jâ€™ai choisi dâ€™afficher quatre cercles.
:::

::: {.callout-tip collapse="true"}
## Dessiner un cercle

Mes cercles sont en fait des `<div>` stylisÃ©es en CSS. Voici les propriÃ©tÃ©s importantesÂ :

-   `display`Â : utilisez `block` ou `inline-block` si vous trouvez que votre cercle ne rÃ©agit pas aux autres propriÃ©tÃ©s CSS.

-   `height` et `width`Â : si ces deux propriÃ©tÃ©s ne sont pas dÃ©finies, elles sont nulles lorsque votre div est vide et vous ne la verrez donc pas. Il faut donner une hauteur et une largeur Ã  notre futur cercle.

-   `border-radius`Â : câ€™est la propriÃ©tÃ© CSS qui permet dâ€™arrondir les coins dâ€™une div. Un cercle, en fait, câ€™est une div avec des coins trÃ¨s arrondis.

-   `background-color`Â : sans cette propriÃ©tÃ©, vous ne verrez pas votre cercle car il nâ€™a pas de couleur.
:::

::: {.callout-tip collapse="true"}
## Jâ€™ai des cercles, comment changer leur taille ?

Vous allez devoir vous baser sur la maniÃ¨re dont vous calculez le `rayon` de vos cercles proportionnels dans la lÃ©gende OpenLayers (donc votre `Style`).

Ã€ partir de lÃ , vous avez plusieurs possibilitÃ©sÂ :

-   Soit vous appliquez vous-mÃªme la formule Ã  des "paliers" pour trouver la taille correspondante. Par exemple, jâ€™utilise la formule du rayon pour calculer la hauteur et la largeur (= diamÃ¨tre) du cercle qui doit reprÃ©senter 50 deals et je dÃ©finis manuellement `height` et `width` en CSS.

-   Soit vous utilisez une formule en CSS pour ne pas avoir Ã  faire le calcul vous-mÃªme pour chaque palier. Par exemple, pour mon palier 50 deals jâ€™ai mis quelque part dans mon CSS cette propriÃ©tÃ© (attention, cette ligne de code correspond Ã  MA formule `rayon` dans mon objet `Style`, pensez Ã  bien utiliser la votreÂ !)Â :

    ``` css
    height: calc(sqrt(50) * 3px);
    ```

-   Soit vous Ãªtes super chaud et vous voulez automatiser le tout en JavaScript. Dans ce cas je vous laisse faire, vous savez dÃ©jÃ  utiliser `setAttribute()`.
:::

### Affichage dynamique des lÃ©gendes

En utilisant les deux points prÃ©cÃ©dents, faites en sorte que les lÃ©gendes ne sâ€™affichent que si la couche associÃ©e est affichÃ©e. Si la propriÃ©tÃ© CSS `visibility` ne donne pas des rÃ©sultats suffisants, vous pouvez regarder la propriÃ©tÃ© `display`.

## Ã€ rendre {#Ã -rendre}

Le travail dâ€™Ã©quipe a payÃ©, vous avez enfin une application Ã  me rendre pour lâ€™Ã©valuationÂ ! Vous pouvez Ãªtre fiers de vous.

![](https://media2.giphy.com/media/v1.Y2lkPTc5MGI3NjExbGs2c3RzMmxuamJlN2hqdDAzdnBvaDk1MmxmaDN0a201bzRnb3J6bSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/5zh4C2NKM1sGG9jro8/giphy.webp){fig-alt="GIF : Miguel et Tulio tope-la" fig-align="center"}

Vous pouvez au choix push votre code sur GitHub ou GitLab (nâ€™oubliez pas de retirer "dist" de `.gitignore` dans ce cas, jâ€™ai besoin de voir le contenu de ce dossier), ou alors mâ€™envoyer une archive `.zip` qui contient les fichiers et dossiers suivantsÂ :

-   `docker-compose.yml`

-   `Caddyfile`

-   `app/index.html` (+ tout autre fichier `.html` que vous avez crÃ©Ã©)

-   `app/style.css` (+ tout autre fichier `.css` que vous avez crÃ©Ã©)

-   `app/main.js` (+ tout autre fichier `.js` que vous avez crÃ©Ã©)

-   `app/dist`

-   `geoserver/opt/data`

-   `geoserver/opt/styles`

-   `geoserver/opt/workspaces`

Pour envoyer lâ€™archive, vous pouvez utiliser la mÃ©thode de votre choixÂ : Google Drive partagÃ©, WeTransfer, FileTransfer avec lâ€™universitÃ©â€¦ peut importe, mais nâ€™oubliez pas que je dois recevoir les Ã©lÃ©ments listÃ©s ci-dessus (ou le lien qui pointe vers ces Ã©lÃ©ments) Ã  lâ€™adresse **marie.gradeler\@gmail.com** **le 20 Janvier 2025 au plus tard**Â !

::: callout-important
## Attention

Sâ€™il manque un seul de ces fichiers / dossiers, je pourrais ne pas pouvoir dÃ©marrer votre application. VÃ©rifiez bien que vous avez tout envoyÃ©Â !

VÃ©rifier aussi que vous nâ€™avez pas oubliÃ© de build votre application (cf. TP 2).
:::

## Nâ€™oubliez pas de me faire un retourÂ !

Ce que vous avez suivi est une premiÃ¨re version de ce cours, une version qui est donc perfectible. Je vous ai normalement fait passer un questionnaire de feedback Ã  remplir pour mâ€™aider Ã  amÃ©liorer la forme et le contenu pour les annÃ©es suivantes. Pensez Ã  le remplir, Ã§a mâ€™aiderait beaucoupÂ !

Nâ€™hÃ©sitez pas non plus Ã  mâ€™envoyer des questions liÃ©es Ã  vos projets GeoNum, je serais ravie de vous aider. Promis, jâ€™essaie de passer pendant la semaine de dÃ©veloppement des projets.

Et pour ceux qui connaissent la source des GIF et qui trouvent quâ€™il manque quelque chose, non, je ne lâ€™ai pas oubliÃ©, le voilÃ Â :

![](https://media1.giphy.com/media/v1.Y2lkPTc5MGI3NjExdHd0bzZzczdpM2xpbnkxYXZpdGhnNGJkNjZ2Z29tYWttbWJpcmsyaSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/ee8nTInXzCjCNVUNNv/giphy.webp){fig-alt="GIF : Miguel qui joue de la guitare" fig-align="center"}

Bonne continuation et Ã  bientÃ´t peut-ÃªtreÂ ! Qui sait, le monde de la gÃ©omatique est petit ğŸ˜
