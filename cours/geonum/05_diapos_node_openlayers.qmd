---
title: "DÃ©velopper avec NodeJS et OpenLayers"
subtitle: "Cycle de dÃ©veloppement, structure de lâ€™application"
author: "Marie Gradeler"
date: 2 Dec 2025
format: 
  revealjs: 
    theme: [default, ../../styles/slides.scss]
    transition: slide
    controls: true
    controls-layout: edges
    footer: "Formation WebCarto GeoNum 2025-2026"
    logo: ../../static/logos/logo-geonum.webp
---

## Sommaire

-   Le cycle de dÃ©veloppement (web)

-   Structure de mon application OpenLayers

-   Se familiariser avec le code de lâ€™application

-   Conseils pour coder

-   (Une) MÃ©thode pour coder une application OpenLayers

-   On ajoute notre premiÃ¨re couche ensemble

## Avant toute choseâ€¦

Commencez par suivre la section "CrÃ©ation de lâ€™application en NodeJS" du TP avant de commencer le point sur le cycle de dÃ©veloppement.

## Le cycle du dÃ©veloppement web

### La version simpliste

Le dÃ©veloppement dâ€™une application est un cycle. Si on le simplifie, on a une boucle entre le dÃ©veloppement lui-mÃªme et la mise en production de lâ€™application.

```{mermaid}
flowchart LR
  dev("DÃ©veloppement") --> prod("Production")
  prod --> dev
```

-   **DÃ©veloppementÂ :** on ajoute de nouveaux Ã©lÃ©ments Ã  lâ€™application. Le dÃ©veloppement sâ€™effectue en local (sur mon ordinateur), grÃ¢ce Ã  un serveur de dÃ©veloppement (lancÃ© avec `npm start` dans notre cas).

-   **ProductionÂ :** on met en production ces nouveaux Ã©lÃ©ments. On *build* lâ€™application avec `npm run build` et on met le rÃ©sultat, le contenu du dossier `dist/`, dans notre serveur web. Dans notre cas, le Docker Compose sâ€™occupe de connecter `dist/` au serveur Caddy.

## Le cycle du dÃ©veloppement web

### Le *quality check* pour mettre une nouvelle version en productionÂ : les tests

Dans la rÃ©alitÃ©, et vous lâ€™avez dÃ©jÃ  certainement appliquÃ© sans vous en rendre compte, il faut vÃ©rifier que lâ€™application est prÃªte Ã  Ãªtre mise en productionÂ : en gros, que nos nouveaux Ã©lÃ©ments fonctionnent bien et quâ€™on ne rajoute pas de nouveaux bugs.

```{mermaid}
flowchart LR
    dev("DÃ©veloppement") --> tests
    tests("Tests") --> dev
    tests --> prod("Production")
    prod --> dev
```

-   **DÃ©veloppementÂ :** on ajoute de nouveaux Ã©lÃ©ments Ã  lâ€™application.

-   **TestsÂ :** on teste les nouvelles fonctionnalitÃ©s. Si on trouve des bugs ou des choses Ã  amÃ©liorer, on retourne Ã  la phase de dÃ©veloppement.

-   **ProductionÂ :** si notre application a passÃ© tous les tests, alors elle est prÃªte Ã  accueillir dÃ©finitivement les nouveaux Ã©lÃ©ments quâ€™on a dÃ©veloppÃ©s.

## Le cycle du dÃ©veloppement web

### IntÃ©gration de Git

Comme vous savez utiliser Git pour versionner votre code, on peut complexifier ce schÃ©ma en intÃ©grant la crÃ©ation de nouvelle branche, les commits et les fusions de branches (*merge*).

```{mermaid}
flowchart LR
  start{"Start"} --> branch{{"git branch"}}
  branch --> dev("DÃ©veloppement")
  dev --> build{{"npm run build"}}
  build --> tests("Tests")
  tests --> dev
  build --> commit{{"git commit"}}
  commit --> merge{{"git merge"}}
  merge --> prod("Production")
  prod --> stop{"End"}
  stop --> start
```

-   Je crÃ©e une **nouvelle branche** (`git branch`) pour ma nouvelle *feature* / ma correction de bug, par exemple `fond-carte-stamen`.

-   Quand je juge que le dÃ©veloppement est terminÃ©, je **build mon application** (`npm run build`) pour pouvoir tester la nouvelle version.

-   Si je trouve des bugs, je continue le dÃ©veloppement.

## Le cycle du dÃ©veloppement web

### IntÃ©gration de Git

Comme vous savez utiliser Git pour versionner votre code, on peut complexifier ce schÃ©ma en intÃ©grant la crÃ©ation de nouvelle branche, les commits et les fusions de branches (*merge*).

```{mermaid}
flowchart LR
  start{"Start"} --> branch{{"git branch"}}
  branch --> dev("DÃ©veloppement")
  dev --> build{{"npm run build"}}
  build --> tests("Tests")
  tests --> dev
  build --> commit{{"git commit"}}
  commit --> merge{{"git merge"}}
  merge --> prod("Production")
  prod --> stop{"End"}
  stop --> start
```

-   Si mon *build* est prÃªt, je peux *commit* mes changements (`git commit`) et jâ€™ajoute un message qui explique ce que fait le nouveau code que je viens commit. Si votre dÃ©veloppement vous fait ajouter beaucoup de code pour une seule feature, vous pouvez (devez) faire plusieurs *commits*. Vous pouvez les voir comme des *checkpoints* dans votre dÃ©veloppement â€” si vous cassez quelque chose, vous pouvez revenir au dernier *commit*, ou celui dâ€™avant, etc.

## Le cycle du dÃ©veloppement web

### IntÃ©gration de Git

```{mermaid}
flowchart LR
  start{"Start"} --> branch{{"git branch"}}
  branch --> dev("DÃ©veloppement")
  dev --> build{{"npm run build"}}
  build --> tests("Tests")
  tests --> dev
  build --> commit{{"git commit"}}
  commit --> merge{{"git merge"}}
  merge --> prod("Production")
  prod --> stop{"End"}
  stop --> start
```

-   Ensuite, je dois *merge* le code de ma branche avec la branche prinicipale de mon code (gÃ©nÃ©ralement *main*) avec `git merge`.

-   La derniÃ¨re Ã©tape est de mettre mon application en production. Câ€™est trÃ¨s complexe et ce ne sera pas Ã  vous de le faire. Le Docker Compose sâ€™en charge pour vous.

## Le cycle du dÃ©veloppement web

On a vu une version **trÃ¨s simplifiÃ©e** de ce cycle, mais suffisante pour nos TPs ensemble (et pour votre projet GeoNum). Vous pouvez poursuivre le TP jusquâ€™Ã  avoir rÃ©ussi Ã  hÃ©berger votre code sur GitHub. Ensuite, on reprendra les diapos pour apprendre Ã  ajouter notre premiÃ¨re couche Ã  lâ€™applicationÂ !

## Se familiariser avec le code de lâ€™application

Node JS crÃ©e beaucoup dâ€™Ã©lÃ©ments mais voici ceux quâ€™on utiliseraÂ :

-   `index.html`

-   `style.css`

-   `main.js`

Deux autres explications Ã  titre dâ€™informationÂ :

-   `node_modules/` contient notamment le code des librairies installÃ©es, **câ€™est ici que vit le code source dâ€™OpenLayers**

-   `dist/` contient lâ€™output du build du site, câ€™est les fichiers qui sont prÃªts Ã  Ãªtre servis par le serveur (pour nous, Caddy) pour mettre notre site en **production**

## Se familiariser avec le code de lâ€™application

### index.html

``` {.html code-line-numbers="|1|2,13|3,8|4,5,6,7|9,12|10|11"}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/x-icon" href="https://openlayers.org/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Using OpenLayers with Vite</title>
  </head>
  <body>
    <div id="map"></div>
    <script type="module" src="./main.js"></script>
  </body>
</html>
```

## Se familiariser avec le code de lâ€™application

### index.html

Une rÃ©fÃ©rence pratique pour les balises htmlÂ : [W3schools.com](https://www.w3schools.com/tags/ref_byfunc.asp)

## Se familiariser avec le code de lâ€™application

### style.css

``` {.css code-line-numbers="|1|3-6|7-12"}
@import "node_modules/ol/ol.css";

html, body {
  margin: 0;
  height: 100%;
}
#map {
  position: absolute;
  top: 0;
  bottom: 0;
  width: 100%;
}
```

## Se familiariser avec le code de lâ€™application

### style.css

Des rÃ©fÃ©rences pratiques pour Ã©crire du CSSÂ :

-   [cssreference.io](https://cssreference.io/) pour la plupart des propriÃ©tÃ©s CSS

-   [W3schools.com](https://www.w3schools.com/cssref/css_selectors.php) pour les sÃ©lÃ©cteurs

-   dâ€™excellents guides sur css-tricks.com pour utiliser [grid](https://css-tricks.com/snippets/css/complete-guide-grid/) ou [flexbox](https://css-tricks.com/snippets/css/a-guide-to-flexbox/)

## Se familiariser avec le code de lâ€™application

### main.js

``` {.javascript code-line-numbers="|1-4|6-17|6|7|8-12|9-10|13-16|1-17"}
import './style.css';
import {Map, View} from 'ol';
import TileLayer from 'ol/layer/Tile';
import OSM from 'ol/source/OSM';

const map = new Map({
  target: 'map',
  layers: [
    new TileLayer({
      source: new OSM()
    })
  ],
  view: new View({
    center: [0, 0],
    zoom: 2
  })
});
```

## Conseils pour coder

### ProblÃ©matiser

La premiÃ¨re chose Ã  faire est de dÃ©couper le problÃ¨me / la consigne en plus petits Ã©lÃ©ments Ã  rÃ©soudre.

> [CrÃ©ez une carte grÃ¢ce Ã  **OpenLayers** Ã  lâ€™Ã©chelle globale. Vous pouvez utiliser le **fond de carte** que vous voulez SAUF celui par dÃ©faut (si vous Ãªtes en manque dâ€™inspiration, je vous conseille un des fonds de [Stamen Maps](https://maps.stamen.com/#watercolor/12/37.7706/-122.3782)). Ensuite, en partant du jeu de donnÃ©es [land_matrix_mines](http://localhost:4471/data/land_matrix/land_matrix_mines.gpkg) quâ€™on a utilisÃ© la derniÃ¨re fois, **affichez la couche de votre choix sur la carte**. Si vous avez besoin de la couche au format GeoJSON vous pouvez lâ€™exporter comme telle depuis QGIS (pour rappel, on travaille en WGS84, il serait avisÃ© dâ€™exporter la couche dans ce systÃ¨me de projection). Enfin, si vous avez le temps, ajoutez **un titre** Ã  votre carte.]{.smaller}

::: {.incremental .smaller}
-   CrÃ©er une application OpenLayers (aucune mÃ©thode nâ€™est recommandÃ©e, jâ€™ai le choix parmi les options disponibles)

-   Changer le fond de carte (fonds Stamen recommandÃ©s)

-   Chercher comment importer un jeu de donnÃ©es au format vecteur dans une application OpenLayers (la consigne parle de GeoJSON)

-   Exporter une couche de land_matrix_mines en GeoJSON (WGS 84)

-   Importer la donnÃ©e dans mon application

-   Afficher la donnÃ©e sur la carte OpenLayers
:::

## Conseils pour coder

### RessourcesÂ : la documentation

**Dâ€™abord, la documentation.** Câ€™est la bible dâ€™OpenLayers et vous allez devoir apprendre Ã  la comprendre, au moins en partie, ou vous allez avoir beaucoup de mal Ã  comprendre ce que vous faites quand vous codez. Elle peut Ãªtre trouvÃ©e Ã  cette addresseÂ : <https://openlayers.org/en/latest/apidoc/>

## Conseils pour coder

### RessourcesÂ : la documentation

**Exemple dâ€™utilisation de la documentation pour lâ€™objet `Map` qui est crÃ©Ã© dans `main.js`Â :**

Tapez "Map" et cliquez sur le premier rÃ©sultat ([lien ici](https://openlayers.org/en/latest/apidoc/module-ol_Map-Map.html)). On voit en haut de la pageÂ :

-   Comment importer cet objet `Map`

-   Une description de ce quâ€™est cet objet `Map`

-   Un exemple ("*snippet*", petit morceau de code) qui montre comment utiliser `Map`

## Conseils pour coder

### RessourcesÂ : la documentation

**Quand on continue Ã  dÃ©filer vers le bas, on voit plusieurs autres sectionsÂ :**

-   La dÃ©finition de la fonction pour crÃ©er lâ€™objet `Map` et les options quâ€™il prend (`new Map(options)`)

-   Les Ã©vÃ¨nements qui peuvent Ãªtre dÃ©clenchÃ©s ("*fired*") par notre objet `Map` dans la section `Fires:`

-   Les `MÃ©thodes` de lâ€™objet `Map`, donc les fonctions qui peuvent Ãªtre dÃ©clenchÃ©es avec cet objet Map pour gÃ©nÃ©ralement le lire ou le modifier

## Conseils pour coder

### La documentation

```{mermaid}
classDiagram
    class Map{
        controls
        pixelRatio
        interactions
        keyboardEventTarget
        layers
        maxTilesLoading
        moveTolerance
        overlays
        target
        view
        +methodsâ€¦()
    }
```

OK câ€™est un peu compliquÃ©. Pour simplifier, on va prendre les Ã©lÃ©ments qui nous intÃ©ressent le plus.

## Conseils pour coder

### La documentation

::::::: columns
::: {.column width="30%"}
```{mermaid}
classDiagram
    class Map{
        target
        layers
        view
        +addLayer()
        +getlayers()
        +getView()
    }
```
:::

::::: {.column width="70%"}
**ClasseÂ :** Map

**AttributsÂ :**

::: incremental
-   `target` = lâ€™id de ma `<div>` qui va contenir ma carte

-   `layers` = les couches crÃ©Ã©es avec OpenLayers qui doivent Ãªtre ajoutÃ©es Ã  ma carte

-   `view` = les paramÃ¨tres de la vue (centre, niveau de zoom) de ma carte lorsquâ€™elle est initialisÃ©e
:::

**MÃ©thodesÂ :**

::: incremental
-   `addLayer()` = ajouter une couche crÃ©Ã©e avec OpenLayers Ã  ma carte

-   `getLayers()` = rÃ©cupÃ©rer les couches qui sont attachÃ©es Ã  ma carte

-   `getView()` = rÃ©cupÃ©rer les paramÃ¨tres de la vue actuelle (centre, niveau de zoom)
:::
:::::
:::::::

## Conseils pour coder

### La documentation

Pour crÃ©er une carte sous OpenLayers, le point dâ€™entrÃ©e principal est la [galerie dâ€™exemples](https://openlayers.org/en/latest/examples/). **Je vous conseille vivement de toujours commencer par lÃ ** avant dâ€™aller voir dâ€™autres ressources comme StackOverflow, etc. comme ce sont les exemples officiels qui sont maintenus Ã  jour et respectent les bonnes pratiques dâ€™utilisation du code OpenLayers.

Par exemple, si vous souhaitez ajouter un flux WMS Ã  votre carte, basez-vous sur le code de lâ€™exemple [Single Image WMS](https://openlayers.org/en/latest/examples/wms-image.html).

![](media/example_openlayers.png){fig-alt="Exemple dâ€™OpenLayers pour importer une couche WMS" fig-align="center"}

## Conseils pour coder

### Les extensions de lâ€™IDE

Les extensions prÃ©sentes dans votre IDE (comme VSCode) vous donnent des indications sur les fonctions que vous utilisez.

::: fragment
``` js
console.
```

VSCode devrait vous proposer la liste des mÃ©thodes de `console`. Si vous commencez Ã  taper la lettre l, il devrait vous proposer `log` en tÃªte de liste. Il vous suffit dâ€™appuyer sur "EntrÃ©e" pour valider lâ€™autocomplÃ©tion.
:::

::: fragment
``` js
console.log()
```

Ouvrez les parenthÃ¨ses et laissez votre curseur Ã  lâ€™intÃ©rieur. VSCode devrait vous afficher les arguments attendus (`message`), leur type (`any`), sâ€™il y a des arguments optionnels possibles (oui)â€¦ et quelques exemples.
:::

## Conseils pour coder

### La console de dÃ©veloppement

Les outils de dÃ©veloppeurs, et particuliÃ¨rement la console, sont indispensables pour dÃ©velopper une application web. Pour y accÃ©der, ouvrez votre application dans votre navigateur et appuyez sur la touche `F12`.

::: fragment
La console vous montre les messages dâ€™erreur et vous indique Ã  quel ligne lâ€™erreur a lieu. Apprenez Ã  lâ€™utiliser pour corriger plus facilement vos bugs.
:::

::: fragment
Utilisez la fonction `console.log()` pour afficher les Ã©lÃ©ments de votre choix dans votre application. EssayezÂ !

``` js
const a = 10;

console.log("=== AFFICHAGE VARIABLE a ===");
console.log(a);
```

```         
=== AFFICHAGE VARIABLE a ===
10
```
:::

## Conseils pour coder

Maintenant quâ€™on a vu les ressources officielles dâ€™OpenLayers et comment utiliser notre IDE, on va regarder ce quâ€™il y a dâ€™autre.

## Conseils pour coder

### Les tutoriels pour bien dÃ©marrer

Ã‡a fonctionne peut-Ãªtre moins bien en salle de classe, mais les **tutoriels vidÃ©o** restent un trÃ¨s bon moyen dâ€™apprendre Ã  utiliser une librairie. Pensez Ã  vÃ©rifier que la vidÃ©o est assez **rÃ©cente** (regardez la date de publication).

::: fragment
Vous pouvez aussi trouver des tutoriels au format Ã©crit comme des **articles de blog** â€” blogs privÃ©s, Medium, etc.

Comme pour les vidÃ©os, regardez la date de publication et essayez de choisir du **contenu rÃ©cent**. Il serait dommage de suivre un tutoriel datant dâ€™OpenLayers 5 en Ã©tait sous OpenLayers 7+.
:::

## Conseils pour coder

### Les forums pour rÃ©soudre ses problÃ¨mes

Les sources de discussion les plus connues pour parler de code sont [StackOverflow](https://stackoverflow.com/questions) et [StackExchange](https://gis.stackexchange.com/questions/tagged/qgis).

::: fragment
Les Stack sont des forums spÃ©cialisÃ©s oÃ¹ les utilisateurs posent des questions, gÃ©nÃ©ralement liÃ©es Ã  lâ€™utilisation dâ€™un logiciel, au dÃ©veloppement en se basant sur une certaine librairieâ€¦
:::

::: fragment
**Pas la peine de taper votre recherche dans StackOverflow ou StackExchange.** Si vous avez un bug, faites une recherche Googleâ€¦ ils sont gÃ©nÃ©ralement dans les premiers rÃ©sultats.

Essayez avecÂ : "openlayers layer not showing"
:::

::: fragment
*Il existe dâ€™autres ressources pour communiquer avec dâ€™autres utilisateurs et poser ses questions. Certains utilisent Reddit, dâ€™autres des forums spÃ©cialisÃ©s pour leur application, des serveurs Discordâ€¦*
:::

## Conseils pour coder

### Lâ€™IA gÃ©nÃ©rative pour mâ€™aider un peu partout

Normalement, on en a dÃ©jÃ  parlÃ© au cours prÃ©cÃ©dent. Lâ€™IA gÃ©nÃ©rative peut intervenir Ã  chaque Ã©tape du processus.

RÃ©fÃ©rez-vous au cours sur le sujet pour savoir comment optimiser vos prompts et vous en servir plus efficacement.

## (Une) MÃ©thode pour aborder les problÃ¨mes en dÃ©veloppement web

### MÃ©thode proposÃ©e

::: incremental
-   DÃ©couper le problÃ¨me (la consigne, la demande du clientâ€¦) en plusieurs **petites** Ã©tapes.

-   Chercher des **tutoriels**, des **exemples** pour chaque Ã©tape pour savoir oÃ¹ et comment commencer.

-   Commencer Ã  coder en se basant sur les tutoriels / exemples. Partir de quelque chose qui fonctionne et adapter le code **petit Ã  petit** Ã  notre problÃ¨me. Quand on a du mal Ã  comprendre ce quâ€™on Ã©crit, utiliser dâ€™abord lâ€™IDE et la documentation.

-   Aux premiers problÃ¨mes, bugs, etc. chercher la source avec **la console de dÃ©veloppement** en abusant des `console.log()`.

-   Une fois la source du bug identifiÃ©e, utiliser la **documentation**, les forums, les tutoriels, etc. pour corriger le bug.

-   Quand votre nouvelle *feature* fonctionne (par exemple une couche qui sâ€™affiche bien), recommencer la boucle pour la feature suivante.
:::

## On ajoute notre premiÃ¨re couche ensemble

Maintenant, on va ajouter notre premiÃ¨re couche WMS ensemble. **Ouvrez `geonum_docker` dans votre IDE prÃ©fÃ©rÃ© et câ€™est partiÂ !**

![](https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExMHRibDNrZ21pOHVwNmR6dGY2NzQzdTVxMjNndzNhYjFydWJub3h0cCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/gxAuyTiJzxyYWpxLOu/giphy.gif){fig-alt="Ariane 5 setup" fig-align="center"}

## On ajoute notre premiÃ¨re couche ensemble

### ProblÃ©matisation

PremiÃ¨re Ã©tapeÂ : on **problÃ©matise**.

> Ajoutez une couche de donnÃ©es Ã  votre application OpenLayers Ã  partir dâ€™un flux WMS.

::: incremental
-   Il me faut une application OpenLayers =\> *check*

-   Comment est-ce que OpenLayers peut lire les flux WMSÂ ? Est-ce que la librairie est Ã©quipÃ©e pour Ã§aÂ ? =\> *documentation, exemples officiels, recherches Google*

-   Trouver et importer un flux WMS

-   Lâ€™afficher sur la carte
:::

## On ajoute notre premiÃ¨re couche ensemble

### Ã€ la recherche dâ€™un exemple

::: incremental
-   Depuis le site officiel dâ€™OpenLayers, accÃ©dez Ã  la rÃ©fÃ©rence de lâ€™API (et choisissez la derniÃ¨re version). Essayez de voir si vous trouvez quelque chose en rapport avec des flux "WMS".
-   Super, on dirait quâ€™OpenLayers est prÃ©vu pour pouvoir lire des flux WMSÂ ! Pour voir comment Ã§a fonctionne, plutÃ´t que de sâ€™arracher les cheveux sur la documentation de lâ€™API, allez dans "Exemples" et tapez "WMS" dans la barre de recherche.
-   **ExerciceÂ : on sait quâ€™on a Ã  disposition un serveur GeoServer. Parmi les exemples OpenLayers, cherchez-en un qui lit de la donnÃ©e depuis un GeoServer.**
-   *Quand on a trouvÃ© notre exemple, on peut passer Ã  la suite.*
:::

## On ajoute notre premiÃ¨re couche ensemble

### PrÃ©parer mon environnement de dÃ©veloppement

Ouvrez votre projet dans VSCode (ou votre IDE prÃ©fÃ©rÃ©). Si votre serveur de dÃ©veloppement tourne encore, vous pouvez lâ€™arrÃªter pour le moment (`ctrl` + `C`).

**Comme on va dÃ©velopper un nouvel Ã©lÃ©ment pour notre application, on va crÃ©er une nouvelle branche sur Git.**

::: incremental
-   Regardez si vous avez des changements sur votre branche. Si câ€™est le cas, on va les *stage* (ajouter aux modifications) puis les *commit* (valider les modifications) et enfin les *push* (pour mettre la branche Ã  jour sur notre GitHub.

-   Ensuite, on va crÃ©er une nouvelle branche. On lui donne un nom clair, comme `couche-wms-exemple`â€¦ quelque chose qui permet de rapidement comprendre ce que vous ajoutez Ã  votre application.

-   On nâ€™oublie pas de se dÃ©placer sur cette nouvelle brancheÂ ! Quand vous codez, vÃ©rifiez que vous nâ€™Ãªtes pas sur "main" (ou "master").
:::

## On ajoute notre premiÃ¨re couche ensemble

Maintenant quâ€™on est prÃªts, on peut reprendre notre exemple et commencer Ã  coder. On utilisera donc lâ€™exemple **"[Single image WMS](https://openlayers.org/en/latest/examples/wms-image.html)"** dâ€™OpenLayers qui nous permet dâ€™ajouter une couche WMS depuis un GeoServer Ã  notre application.

Gardez cet exemple ouvert dans votre nagivateur, on va le dÃ©tailler ensemble.

## On ajoute notre premiÃ¨re couche ensemble

ðŸ¤” Quâ€™est-ce qui est diffÃ©rent dans `index.html`Â ?

. . .

-   le style nâ€™est pas dans `style.css` mais dans une balise de `<style>`. Nous on a dÃ©jÃ  un fichier de style qui fonctionne trÃ¨s bien et la carte en plein Ã©cran nous plait, on ne change rien.

. . .

-   la balise `<div id="map">` a aussi une classe de style `class = "map"`. Cela permet dâ€™appliquer le mÃªme style Ã  toutes les cartes avec la classe `map`. Nous on a une seule carte dans notre application, donc on sâ€™en moque.

. . .

En gros, on nâ€™a rien Ã  modifier dans `index.html` ni dans le fichier de style `style.css`. On peut passer au gros morceauÂ : le fichier de script `main.js`.

## On ajoute notre premiÃ¨re couche ensemble

ðŸ¤” Quâ€™est-ce qui est diffÃ©rent dans `main.js`Â ?

. . .

ðŸ‘† Mon conseilÂ : au dÃ©but, ignorez toute la section **import** qui peut sembler un peu floue et concentrez vous sur les **variables** qui sont dÃ©finies dans le code, puis sur les **objets OpenLayers**.

. . .

::::: columns
::: {.column width="50%"}
Notre codeÂ :

``` javascript
import './style.css';
import {Map, View} from 'ol';
import TileLayer from 'ol/layer/Tile';
import OSM from 'ol/source/OSM';

const map = new Map({
  target: 'map',
  layers: [
    new TileLayer({
      source: new OSM()
    })
  ],
  view: new View({
    center: [0, 0],
    zoom: 2
  })
});
```
:::

::: {.column width="50%"}
Le code de lâ€™exempleÂ :

``` javascript
import ImageWMS from 'ol/source/ImageWMS.js';
import Map from 'ol/Map.js';
import OSM from 'ol/source/OSM.js';
import View from 'ol/View.js';
import {Image as ImageLayer, Tile as TileLayer} from 'ol/layer.js';

const layers = [
  new TileLayer({
    source: new OSM(),
  }),
  new ImageLayer({
    extent: [-13884991, 2870341, -7455066, 6338219],
    source: new ImageWMS({
      url: 'https://ahocevar.com/geoserver/wms',
      params: {'LAYERS': 'topp:states'},
      ratio: 1,
      serverType: 'geoserver',
    }),
  }),
];
const map = new Map({
  layers: layers,
  target: 'map',
  view: new View({
    center: [-10997148, 4569099],
    zoom: 4,
  }),
});
```
:::
:::::

## On ajoute notre premiÃ¨re couche ensemble

::::: columns
::: {.column width="50%"}
Notre codeÂ :

``` {.javascript code-line-numbers="6-17"}
import './style.css';
import {Map, View} from 'ol';
import TileLayer from 'ol/layer/Tile';
import OSM from 'ol/source/OSM';

const map = new Map({
  target: 'map',
  layers: [
    new TileLayer({
      source: new OSM()
    })
  ],
  view: new View({
    center: [0, 0],
    zoom: 2
  })
});
```
:::

::: {.column width="50%"}
Le code de lâ€™exempleÂ :

``` {.javascript code-line-numbers="7-28|21-28"}
import ImageWMS from 'ol/source/ImageWMS.js';
import Map from 'ol/Map.js';
import OSM from 'ol/source/OSM.js';
import View from 'ol/View.js';
import {Image as ImageLayer, Tile as TileLayer} from 'ol/layer.js';

const layers = [
  new TileLayer({
    source: new OSM(),
  }),
  new ImageLayer({
    extent: [-13884991, 2870341, -7455066, 6338219],
    source: new ImageWMS({
      url: 'https://ahocevar.com/geoserver/wms',
      params: {'LAYERS': 'topp:states'},
      ratio: 1,
      serverType: 'geoserver',
    }),
  }),
];
const map = new Map({
  layers: layers,
  target: 'map',
  view: new View({
    center: [-10997148, 4569099],
    zoom: 4,
  }),
});
```
:::
:::::

## On ajoute notre premiÃ¨re couche ensemble

::::: columns
::: {.column width="50%"}
Notre codeÂ :

``` {.javascript code-line-numbers="7"}
import './style.css';
import {Map, View} from 'ol';
import TileLayer from 'ol/layer/Tile';
import OSM from 'ol/source/OSM';

const map = new Map({
  target: 'map',
  layers: [
    new TileLayer({
      source: new OSM()
    })
  ],
  view: new View({
    center: [0, 0],
    zoom: 2
  })
});
```
:::

::: {.column width="50%"}
Le code de lâ€™exempleÂ :

``` {.javascript code-line-numbers="23"}
import ImageWMS from 'ol/source/ImageWMS.js';
import Map from 'ol/Map.js';
import OSM from 'ol/source/OSM.js';
import View from 'ol/View.js';
import {Image as ImageLayer, Tile as TileLayer} from 'ol/layer.js';

const layers = [
  new TileLayer({
    source: new OSM(),
  }),
  new ImageLayer({
    extent: [-13884991, 2870341, -7455066, 6338219],
    source: new ImageWMS({
      url: 'https://ahocevar.com/geoserver/wms',
      params: {'LAYERS': 'topp:states'},
      ratio: 1,
      serverType: 'geoserver',
    }),
  }),
];
const map = new Map({
  layers: layers,
  target: 'map',
  view: new View({
    center: [-10997148, 4569099],
    zoom: 4,
  }),
});
```
:::
:::::

## On ajoute notre premiÃ¨re couche ensemble

::::: columns
::: {.column width="50%"}
Notre codeÂ :

``` {.javascript code-line-numbers="13-16"}
import './style.css';
import {Map, View} from 'ol';
import TileLayer from 'ol/layer/Tile';
import OSM from 'ol/source/OSM';

const map = new Map({
  target: 'map',
  layers: [
    new TileLayer({
      source: new OSM()
    })
  ],
  view: new View({
    center: [0, 0],
    zoom: 2
  })
});
```
:::

::: {.column width="50%"}
Le code de lâ€™exempleÂ :

``` {.javascript code-line-numbers="24-27"}
import ImageWMS from 'ol/source/ImageWMS.js';
import Map from 'ol/Map.js';
import OSM from 'ol/source/OSM.js';
import View from 'ol/View.js';
import {Image as ImageLayer, Tile as TileLayer} from 'ol/layer.js';

const layers = [
  new TileLayer({
    source: new OSM(),
  }),
  new ImageLayer({
    extent: [-13884991, 2870341, -7455066, 6338219],
    source: new ImageWMS({
      url: 'https://ahocevar.com/geoserver/wms',
      params: {'LAYERS': 'topp:states'},
      ratio: 1,
      serverType: 'geoserver',
    }),
  }),
];
const map = new Map({
  layers: layers,
  target: 'map',
  view: new View({
    center: [-10997148, 4569099],
    zoom: 4,
  }),
});
```
:::
:::::

## On ajoute notre premiÃ¨re couche ensemble

::::: columns
::: {.column width="50%"}
Notre codeÂ :

``` {.javascript code-line-numbers="8-12"}
import './style.css';
import {Map, View} from 'ol';
import TileLayer from 'ol/layer/Tile';
import OSM from 'ol/source/OSM';

const map = new Map({
  target: 'map',
  layers: [
    new TileLayer({
      source: new OSM()
    })
  ],
  view: new View({
    center: [0, 0],
    zoom: 2
  })
});
```
:::

::: {.column width="50%"}
Le code de lâ€™exempleÂ :

``` {.javascript code-line-numbers="22|22,7-20"}
import ImageWMS from 'ol/source/ImageWMS.js';
import Map from 'ol/Map.js';
import OSM from 'ol/source/OSM.js';
import View from 'ol/View.js';
import {Image as ImageLayer, Tile as TileLayer} from 'ol/layer.js';

const layers = [
  new TileLayer({
    source: new OSM(),
  }),
  new ImageLayer({
    extent: [-13884991, 2870341, -7455066, 6338219],
    source: new ImageWMS({
      url: 'https://ahocevar.com/geoserver/wms',
      params: {'LAYERS': 'topp:states'},
      ratio: 1,
      serverType: 'geoserver',
    }),
  }),
];
const map = new Map({
  layers: layers,
  target: 'map',
  view: new View({
    center: [-10997148, 4569099],
    zoom: 4,
  }),
});
```
:::
:::::

## On ajoute notre premiÃ¨re couche ensemble

Le code de lâ€™exemple :

``` {.javascript code-line-numbers="7-28|11-19|13-18"}
import ImageWMS from 'ol/source/ImageWMS.js';
import Map from 'ol/Map.js';
import OSM from 'ol/source/OSM.js';
import View from 'ol/View.js';
import {Image as ImageLayer, Tile as TileLayer} from 'ol/layer.js';

const layers = [
  new TileLayer({
    source: new OSM(),
  }),
  new ImageLayer({
    extent: [-13884991, 2870341, -7455066, 6338219],
    source: new ImageWMS({
      url: 'https://ahocevar.com/geoserver/wms',
      params: {'LAYERS': 'topp:states'},
      ratio: 1,
      serverType: 'geoserver',
    }),
  }),
];
const map = new Map({
  layers: layers,
  target: 'map',
  view: new View({
    center: [-10997148, 4569099],
    zoom: 4,
  }),
});
```

## On ajoute notre premiÃ¨re couche ensemble

De quoi jâ€™ai besoin pour ajouter une couche WMS Ã  ma carteÂ ?

::: incremental
-   Il nous faut une source pour le flux WMS quâ€™on crÃ©e avec lâ€™objet `ImageWMS` ([documentation](https://openlayers.org/en/latest/apidoc/module-ol_source_ImageWMS-ImageWMS.html))

-   Il nous faut un objet `ImageLayer` pour crÃ©er notre couche Ã  partir de notre source

-   Il nous faut un objet `Map` (dÃ©jÃ  crÃ©Ã© dans notre cas) auquel ajouter la couche
:::

. . .

Ma proposition de code pour crÃ©er une couche (en retirant les Ã©lÃ©ments superflus pour simplifier)Â :

``` javascript
const ma_source = new ImageWMS({
  url: '<lien_vers_mon_serveur>',
  params: {'LAYERS': '<espace>:<couche>'},
  serverType: 'geoserver',
});

const ma_couche = new ImageLayer({
  source: ma_source,
});
```

. . .

On pourrait aussi lâ€™Ã©crire en imbriquant tout comme dans lâ€™exemple, mais je prÃ©fÃ¨re sÃ©parer les Ã©lÃ©ments, je trouve Ã§a moins confus (surtout quand on apprend).

``` javascript
const ma_couche = new ImageLayer({
  source: new ImageWMS({
    url: '<lien_vers_mon_serveur>',
    params: {'LAYERS': '<espace>:<couche>'},
    serverType: 'geoserver',
  }),
});
```

## On ajoute notre premiÃ¨re couche ensemble

Il nous manque un dernier dÃ©tailÂ : les `imports`. Si vous utilisez le code tel quel, vous allez avoir des messages dâ€™erreur indiquant que les fonctions ne sont pas trouvÃ©es. Vous pouvez trouver les imports de trois maniÃ¨resÂ :

-   vous regardez les imports dans lâ€™exemple OpenLayers et vous rÃ©cupÃ©rez ceux dont vous avez besoin ([lien](https://openlayers.org/en/latest/examples/wms-image.html))

-   vous allez voir la documentation de `ImageWMS` par exemple et la premiÃ¨re ligne vous indique comment importer le module dans votre code ([lien](https://openlayers.org/en/latest/apidoc/module-ol_source_ImageWMS-ImageWMS.html))

-   si votre Ã©diteur de code est bien fichu, il peut lui-mÃªme ajouter un `import` quand vous appelez un constructeur ou une mÃ©thode dans votre code

ðŸ‘† Dâ€™ailleurs, nâ€™oubliez pas que les `import` **doivent toujours Ãªtre dÃ©clarÃ©s tout en haut du documentÂ !**

## On ajoute notre premiÃ¨re couche ensemble

Voici mon rÃ©sultat pour importer la couche de lâ€™exemple dâ€™OpenLayersÂ :

``` javascript
import './style.css';
import {Map, View} from 'ol';
import { ImageWMS } from 'ol/source';
import TileLayer from 'ol/layer/Tile';
import ImageLayer from 'ol/layer/Image';
import OSM from 'ol/source/OSM';

const couche_osm = new TileLayer({ source: new OSM() });

const ma_source = new ImageWMS({
  url: 'https://ahocevar.com/geoserver/wms',
  params: { 'LAYERS' : 'topp:states' },
  serverType: 'geoserver',
});

const ma_couche = new ImageLayer({
  source: ma_source,
});

const map = new Map({
  target: 'map',
  layers: [ couche_osm, ma_couche ],
  view: new View({
    center: [0, 0],
    zoom: 2
  })
});
```

## On ajoute notre premiÃ¨re couche ensemble

Ensuite, on doit tester notre application en conditions de dÃ©ploiement â€” autrement dit, on teste son *build*.

::: incremental
-   Ouvrez un terminal dans le rÃ©pertoire `geonum_docker/app` et lancez la commande `npm run build`

-   Si ce nâ€™est pas fait, lancez votre *stack* server `geonum_docker` (depuis Docker desktop ou avec `docker compose up -d` depuis la racine de votre projet `geonum_docker`)

-   Ouvrez votre localhost et vÃ©rifiez que vous voyez bien la nouvelle feature sur votre applicationÂ !
:::

::: fragment
**Quand vous estimez que votre nouvelle *feature* est prÃªte (tout fonctionne dans la version build, vous avez ajoutÃ© les Ã©lÃ©ments que vous vouliez, etc.), on va pouvoir la *merge* dans notre branche principale et la mettre en productionÂ !**
:::

## On ajoute notre premiÃ¨re couche ensemble

Vous commencez Ã  connaÃ®tre les Ã©tapes.

-   *stage* le nouveau code (dans lâ€™IDE ou avec `git add .`)

-   *commit* sans oublier votre message (dans lâ€™IDE ou avec `git commit -m "mon message"`)

-   *push* les changements sur votre GitHub (dans lâ€™IDE ou avec `git push`)

. . .

Ensuite, il faut quâ€™on *merge* le code de notre branche de dÃ©veloppement dans la branche principale. On pourrait le faire localement, mais on va utiliser GitHub pour Ã§a â€” vous allez sans doute lâ€™utiliser pour collaborer pendant le projet GÃ©oNum donc autant pratiquer maintenant.

## On ajoute notre premiÃ¨re couche ensemble

GitHub devrait vous indiquer que vous avez *push* une branche il y a quelques secondes et vous proposer de faire une *merge request*.

::: callout-tip
Pour rappel, une *merge request* et une "demande de merge une branche dans une autre". Ici, on veut ajouter notre nouvelle *feature* (branche `couche-WMS-exemple`) dans la branche principale de notre application (branche `main` ou `master`).
:::

. . .

Ensuite, vous pouvez affiner ce quâ€™il doit se passer pendant le *merge*. Par exemple, vous pouvez choisir de supprimer la branche `couche-WMS-exemple` Ã  la fin du merge. Je vous le dÃ©conseille pour le moment, on la supprimera manuellement.

**Maintenant, lancez le *merge*Â !**

## On ajoute notre premiÃ¨re couche ensemble

Ce quâ€™on vient de faire, câ€™est mettre Ã  jour le code de `main` (ou `master`) dans notre dÃ©pÃ´t GitHub en y intÃ©grant le code de notre nouvelle branche `couche-WMS-exemple`.

Il ne nous reste plus quâ€™Ã  rÃ©cupÃ©rer le code sur notre machine et vÃ©rifier que tout sâ€™affiche correctementÂ !

-   DÃ©placez-vous sur votre branche principale (dans lâ€™IDE ou avec un `git checkout main`)

-   Effectuez un `git pull` (dans lâ€™IDE ou avec `git pull`)

-   Allez dans `geonum_docker/app` et utiliser `npm run build` pour build votre application

-   Relancez votre *stack* Docker si jamais vous lâ€™aviez arrÃªtÃ©e

-   Ouvrez votre localhost et vÃ©rifiez que tout fonctionne

## On ajoute notre premiÃ¨re couche ensemble

**Et voilÃ Â ! Bravo, vous venez de complÃ©ter un cycle de dÃ©veloppement.**

![](https://media3.giphy.com/media/v1.Y2lkPTc5MGI3NjExNTJ6NjZ6djFwbjUzMmh5OXN2YWplcTRoeGxlY2E4NjZhMXRiOTQwMSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/TRFcNpyLTdo2kUmkwm/giphy.gif){fig-alt="GIFÂ : Ariane 5 dÃ©colleÂ !" fig-align="center"}

## On rÃ©capitule rapidementÂ ?

Vous savez maintenantÂ :

-   **ProblÃ©matiser** en dÃ©coupant vos besoins en petites Ã©tapesÂ ;

-   **Chercher par oÃ¹ commencer** chaque Ã©tape dans la documentation et les exemples officielsÂ ;

-   **Vous servir de votre IDE**, des forums et autres outils Ã  disposition pour vous appuyerÂ ;

-   **ComplÃ©ter un cycle de dÃ©veloppement** de votre nouvelle feature depuis la crÃ©ation de *branch*Â Ã  la *merge request* sans oublier de *build* votre application.

Maintenant, vous Ãªtes parÃ©s pour la suiteÂ !

## Ã€ vousÂ !

Vous allez pouvoir commencer le TP suivant pour commencer Ã  ajouter **vos** couches dans votre application OpenLayers.

Câ€™est partiÂ !

![](https://media2.giphy.com/media/v1.Y2lkPTc5MGI3NjExcjc5bGExdHQyaHJqN3E3ZXN4M3J6cWdpZ3EwZ3ZpOHdxcDlkc3psMyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/HVr4gFHYIqeti/giphy.webp){fig-alt="GIF : Bilbo part pour une aventureÂ !" fig-align="center"}